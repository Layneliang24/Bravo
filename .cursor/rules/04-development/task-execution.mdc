---
description: 任务执行阶段的规则和最佳实践
globs: backend/**/*.py, frontend/**/*.{ts,tsx,vue,js,jsx}
priority: 700
---

# 任务执行阶段规则

## 1. 角色自动切换机制
执行任务前，请根据任务属性切换角色（详细 Prompt 见 @09-roles/）：
- **开发专家**: 执行代码实现任务。
- **测试专家**: 执行测试编写与验证。
- **架构专家**: 验证 PRD 完整性或设计 API 契约。

## 2. 任务准备 (必备指令)
开始任何任务前，必须同步上下文：
```bash
# 1. 确认任务详情与依赖
task-master show <task_id>

# 2. 审阅真源文档
cat docs/00_product/requirements/<REQ-ID>/<REQ-ID>.md
cat docs/01_guideline/api-contracts/<REQ-ID>/<REQ-ID>-api.yaml
```

## 3. 执行闭环 (TDD 驱动)
- **最小单元**: 子任务是 TDD（红 → 绿 → 重构）的最小闭环单位。
- **依赖检查**: 严禁在依赖项未完成（`task-master list --status done`）前开始后续任务。

## 4. 任务完成与验收
任务提交前必须执行以下自核：
1. **全量测试**: 运行 `./test --quick` 并确保通过。
2. **合规审计**: 检查 REQ-ID 注释及代码质量。
3. **状态更新**: `task-master set-status --id <task_id> --status done`。

## 5. 原子禁令
- ❌ 严禁在 Task-ID 未分配的情况下开始编码。
- ❌ 严禁绕过任务依赖关系进行“并行开发”。
- ❌ 严禁手动篡改 PRD 中的任务状态（必须使用 CLI 工具）。

---

## 规则应用声明
当AI被路由到此规则时，必须在响应开头明确声明：

```
[应用规则：@.cursor/rules/04-development/task-execution.mdc]
[切换到开发专家角色]
```
