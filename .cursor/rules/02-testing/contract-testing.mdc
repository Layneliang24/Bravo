---
description: V4契约驱动开发规则
globs: docs/01_guideline/api-contracts/**/*.yaml, backend/apps/**/*.py, frontend/src/api/**/*.{ts,js}
priority: 850
---

# V4契约驱动开发规则

## 核心原则

**前后端通过API契约并行开发**

## 工作流程

1. **架构师设计API契约**: 根据PRD创建OpenAPI 3.0契约文档
2. **前端基于契约开发**: 使用Mock Server，不依赖后端
3. **后端按照契约实现**: 确保API符合契约定义
4. **契约测试验证**: 自动验证前后端是否符合契约

## API契约位置

**路径**: `docs/01_guideline/api-contracts/{REQ-ID}/{REQ-ID}-api.yaml`

**格式**: OpenAPI 3.0

**参考**: @docs/01_guideline/api-contracts/README.md

## 契约要求

### 实现必须遵循契约

- 请求参数必须符合Schema
- 响应格式必须符合Schema
- 状态码必须符合契约定义
- 错误响应格式必须符合契约

### 契约测试

- 使用`drf-spectacular`自动生成文档
- 对比生成的文档与契约文档
- 运行契约测试验证一致性

## Mock Server使用

**工具**: Prism

**命令**:
```bash
prism mock docs/01_guideline/api-contracts/{REQ-ID}/{REQ-ID}-api.yaml
```

**参考**: @docs/01_guideline/api-contracts/README.md

---

## 规则应用声明

**当AI被路由到此规则时，必须在响应开头明确声明**：

```
[应用规则：@.cursor/rules/02-testing/contract-testing.mdc]
[切换到架构专家角色]
```

**验证要求**：
- ✅ 必须明确声明应用了此规则
- ✅ 必须遵循本规则中的所有约束和流程
- ✅ 必须切换到架构专家角色
- ✅ 不能跳过声明步骤直接执行操作
