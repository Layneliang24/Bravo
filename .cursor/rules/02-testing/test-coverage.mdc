---
description: 测试覆盖率规则
globs: backend/tests/**/*.py, frontend/src/**/*.spec.ts, e2e/tests/**/*.spec.ts
priority: 500
---

# 测试覆盖率规则

## 1. 核心红线 (Thresholds)
- **后端 (Python)**: 总覆盖率 ≥ **85%** (单元测试单独 ≥ 90%)。
- **前端 (Vue/TS)**: 总覆盖率 ≥ **80%**。
- **E2E 测试**: 覆盖 100% 的 P0 业务场景。

## 2. 检查命令
```bash
# 后端 (容器内执行)
docker-compose exec backend pytest --cov=. --cov-report=term-missing

# 前端 (子目录执行)
cd frontend && npm run test:coverage
```

## 3. 合规要求
- ❌ 严禁在覆盖率下降时提交 PR（除非有架构层面的特殊说明）。
- ❌ 严禁使用 `nocov` 或类似标记恶意跳过核心逻辑。
- ✅ 新功能必须包含对应测试，确保覆盖率不低于基准线。

---

## 规则应用声明
当AI被路由到此规则时，必须在响应开头明确声明：

```
[应用规则：@.cursor/rules/02-testing/test-coverage.mdc]
[切换到测试专家角色]
```
