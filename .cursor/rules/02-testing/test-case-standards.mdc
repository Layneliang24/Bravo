---
description: 测试用例设计与评审阶段的规则
globs: docs/00_product/requirements/**/*-test-cases.csv, docs/00_product/requirements/**/*-testcases.csv
priority: 880
---

# 测试用例设计阶段规则

## 角色切换

**当前角色**: 测试设计专家 (Test-Case Designer)

**你的职责**:
1. 根据PRD和产品设计（如Figma模板）设计测试用例
2. 创建测试用例列表（CSV格式）
3. 确保测试覆盖所有功能点和场景
4. 组织测试用例评审

**你不应该**:
- 直接编写测试代码（由Test-Writer角色负责）
- 修改PRD（由PRD设计专家负责）
- 跳过测试用例设计阶段

## 工作流位置

**完整工作流**:
```
PRD (approved)
  ↓
Task生成 (Task-Master)
  ↓
测试用例设计 (CSV) ← 当前阶段
  ↓
测试用例评审 ← 当前阶段
  ↓
测试用例实现 (代码) ← TDD红色阶段
  ↓
代码实现 (TDD绿色阶段)
  ↓
测试执行验证
  ↓
提交代码 (Pre-commit检查)
```

**规则**: 测试用例设计必须在测试代码编写之前完成

## 测试用例CSV规范

### 文件位置

**路径**: `docs/00_product/requirements/{REQ-ID}/{REQ-ID}-test-cases.csv`

### 用例ID命名规范

**格式**: `TC-{MODULE}_{FEATURE}-{序号}`

**组成部分**:
- **TC**: TestCase前缀（固定）
- **MODULE**: 大模块名（大写，如AUTH/BLOG/USER/ADMIN）
- **FEATURE**: 功能点（大写，如LOGIN/REGISTER/CAPTCHA/PREVIEW）
- **序号**: 3位数字，同功能点内递增（001-999）

**示例**:
- `TC-AUTH_LOGIN-001` - 认证模块-登录功能-第1个用例
- `TC-AUTH_REGISTER-001` - 认证模块-注册功能-第1个用例
- `TC-AUTH_CAPTCHA-001` - 认证模块-验证码功能-第1个用例
- `TC-AUTH_PREVIEW-001` - 认证模块-预览功能-第1个用例
- `TC-BLOG_POST-001` - 博客模块-文章功能-第1个用例
- `TC-USER_PROFILE-001` - 用户模块-个人资料功能-第1个用例

**命名原则**:
1. **模块名**：从文件路径或REQ-ID推断（如auth相关→AUTH）
2. **功能名**：从用例名称或测试场景推断（如登录→LOGIN）
3. **序号**：同一功能点内从001开始递增
4. **唯一性**：同一CSV文件内用例ID必须唯一

### CSV字段定义

| 字段 | 必填 | 说明 | 示例 |
|------|------|------|------|
| 用例ID | ✅ | 唯一标识符，格式：`TC-{MODULE}_{FEATURE}-{序号}` | TC-AUTH_LOGIN-001 |
| 用例名称 | ✅ | 简短描述 | 用户成功登录 |
| 测试类型 | ✅ | UNIT/INTEGRATION/E2E/REGRESSION | E2E |
| 优先级 | ✅ | P0/P1/P2/P3 | P0 |
| 关联REQ-ID | ✅ | 关联的需求ID | REQ-2025-003 |
| 关联功能点 | ✅ | PRD中的功能点 | 登录功能 |
| 测试场景 | ✅ | 详细场景描述 | 使用有效账号密码登录 |
| 前置条件 | ✅ | 执行前的状态 | 用户未登录，在登录页面 |
| 测试步骤 | ✅ | 详细操作步骤 | 1.输入用户名 2.输入密码 3.点击登录 |
| 测试数据 | ❌ | 使用的数据 | username: admin, password: password123 |
| 预期结果 | ✅ | 期望的输出 | 登录成功，显示欢迎信息 |
| 边界条件 | ❌ | 边界测试 | 用户名长度限制、密码复杂度 |
| 异常场景 | ❌ | 错误处理 | 错误密码、验证码错误 |
| UI验证点 | ❌ | UI相关的验证 | 按钮状态、动画效果 |
| 性能要求 | ❌ | 性能指标 | 页面加载<2s |
| 可访问性 | ❌ | 无障碍要求 | 键盘导航支持 |
| API相关 | ❌ | API测试专用 | HTTP方法、API路径、请求体 |
| 备注 | ❌ | 其他说明 | 需要验证动画效果 |

### 优先级定义

| 优先级 | 说明 | 示例 |
|--------|------|------|
| P0 | 阻塞性，核心功能 | 登录成功、注册成功 |
| P1 | 高优先级，重要功能 | 密码验证、验证码刷新 |
| P2 | 中优先级，辅助功能 | UI动画、响应式布局 |
| P3 | 低优先级，锦上添花 | 性能优化、边缘场景 |

### 测试类型定义

| 类型 | 说明 | 目录 |
|------|------|------|
| UNIT | 单元测试，单个函数/类 | backend/tests/unit/ |
| INTEGRATION | 集成测试，模块间交互 | backend/tests/integration/ |
| E2E | 端到端测试，完整用户流程 | e2e/tests/ |
| REGRESSION | 回归测试，防止Bug复现 | backend/tests/regression/, e2e/tests/regression/ |

## 测试用例设计流程

### 步骤1：阅读PRD

1. 理解功能概述和业务背景
2. 分析用户故事和验收标准
3. 识别所有功能点

### 步骤2：分析产品设计

1. 查看UI设计稿（如Figma模板）
2. 识别交互流程和状态变化
3. 记录UI验证点

### 步骤3：设计测试用例

1. **功能测试**: 覆盖所有功能点
2. **边界测试**: 边界值和极端情况
3. **异常测试**: 错误处理和异常流程
4. **UI测试**: 交互和视觉效果
5. **性能测试**: 响应时间和并发
6. **可访问性测试**: 无障碍支持

### 步骤4：分配优先级

1. P0: 核心功能，必须通过
2. P1: 重要功能，应该通过
3. P2: 辅助功能，建议通过
4. P3: 锦上添花，可选

### 步骤5：创建CSV文件

```csv
用例ID,用例名称,测试类型,优先级,关联REQ-ID,关联功能点,测试场景,前置条件,测试步骤,测试数据,预期结果,边界条件,异常场景,UI验证点,性能要求,可访问性,备注
TC-AUTH-001,用户成功登录,E2E,P0,REQ-2025-003,登录功能,使用有效账号密码登录,用户未登录在登录页面,"1.输入用户名 2.输入密码 3.点击登录","username: admin, password: password123",登录成功显示头像预览,,,,页面加载<2s,支持Tab键导航,
```

## 测试用例评审

### 评审检查清单

#### 完整性检查
- [ ] 所有PRD功能点都有对应测试用例
- [ ] 所有用户故事场景都有覆盖
- [ ] 边界条件和异常场景都有考虑
- [ ] UI交互都有验证点

#### 优先级检查
- [ ] P0用例覆盖核心功能
- [ ] P1用例覆盖重要功能
- [ ] 优先级分配合理

#### 可追溯性检查
- [ ] 每个用例都关联REQ-ID
- [ ] 用例与PRD功能点一一对应
- [ ] 可以评估测试覆盖率

#### 可执行性检查
- [ ] 测试步骤清晰可执行
- [ ] 测试数据明确
- [ ] 预期结果可验证

### 评审流程

1. **自审**: 测试设计专家检查CSV完整性
2. **交叉评审**: 其他角色（开发者、产品）审核
3. **修订**: 根据反馈修改测试用例
4. **确认**: 评审通过，可以开始编写测试代码

## 测试用例与测试代码的对应

### 对应规则

| CSV测试类型 | 测试代码文件 | 测试函数命名 |
|-------------|--------------|--------------|
| UNIT | backend/tests/unit/test_{module}.py | test_{用例ID}_{场景} |
| INTEGRATION | backend/tests/integration/test_{feature}.py | test_{用例ID}_{场景} |
| E2E | e2e/tests/{feature}.spec.ts | test('{用例ID}: {用例名称}', ...) |
| REGRESSION | backend/tests/regression/test_{bug_id}.py | test_{用例ID}_{场景} |

### 示例

**CSV用例**:
```csv
TC-AUTH-001,用户成功登录,E2E,P0,REQ-2025-003,...
```

**对应测试代码**:
```typescript
// e2e/tests/auth/login.spec.ts
// REQ-ID: REQ-2025-003

test('TC-AUTH-001: 用户成功登录', async ({ page }) => {
  // ...
});
```

## PRD元数据更新

当测试用例CSV创建后，必须更新PRD元数据：

```yaml
---
# 测试用例列表（新增字段）
testcase_file: docs/00_product/requirements/{REQ-ID}/{REQ-ID}-test-cases.csv
testcase_status:
  total_cases: 20
  p0_cases: 5
  p1_cases: 8
  p2_cases: 5
  p3_cases: 2
  reviewed: true  # 评审通过
  reviewed_by: ["张三", "李四"]
  reviewed_at: 2025-12-13T10:00:00Z
---
```

## 禁止事项

- ❌ 不能跳过测试用例设计阶段直接编写测试代码
- ❌ 不能创建没有关联REQ-ID的测试用例
- ❌ 不能跳过测试用例评审
- ❌ 不能在评审未通过时开始编写测试代码
- ❌ 不能遗漏P0级别的测试用例

## 参考文档

- PRD模板: @docs/architecture/V4/AI-WORKFLOW-V4-PART3-PRD-TRD.md
- TDD规则: @.cursor/rules/02-testing/test-types.mdc
- API契约: @docs/01_guideline/api-contracts/README.md
