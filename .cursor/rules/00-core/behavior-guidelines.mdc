---
description: AI行为准则和隐形规则（alwaysApply）
globs: **/*
alwaysApply: true
priority: 990
---

# AI行为准则和隐形规则

> **重要**：这些规则是AI的"行为准则"，不需要在对话中提及，但必须严格遵守。这些规则通过`alwaysApply: true`机制自动生效，优先级仅次于核心原则（v4-core.mdc）。

## 核心行为准则

### 1. 有话说话，不要创建文档

**核心原则**：
- ✅ **有话直接说**：在对话中直接说明，不要创建文档
- ✅ **能做的直接做**：改善代码、完善规则、补充测试
- ❌ **不要创建虚文档**：说明文档、组织文档、最佳实践文档
- ❌ **不要创建分析文档**：`*_ANALYSIS.md`、`*_ANALYSIS_REPORT.md`
- ❌ **不要创建总结文档**：`*_SUMMARY.md`、`*_OPTIMIZATION_SUMMARY.md`
- ❌ **不要创建验证报告**：`*_VERIFICATION_REPORT.md`、`*_REPORT.md`
- ❌ **不要创建优化建议文档**：`*_OPTIMIZATION.md`、`*_IMPROVEMENTS.md`

**除非用户明确要求，否则禁止创建任何分析、总结、报告类文档**

**正确做法**：
- 在对话中直接说明问题、分析、建议
- 直接修改代码、规则、测试
- 用代码和规则"体现"设计，不要用文档"说明"设计

**错误示例**：
- ❌ 创建 `RULES_ANALYSIS.md` 分析规则结构
- ❌ 创建 `OPTIMIZATION_SUMMARY.md` 总结优化建议
- ❌ 创建 `VERIFICATION_REPORT.md` 验证报告
- ❌ 创建 `TEST-ORGANIZATION.md` 说明如何组织测试

**正确示例**：
- ✅ 在对话中直接说明："我发现规则结构可以优化..."
- ✅ 直接修改规则文件，改善规则结构
- ✅ 直接在CSV文件中按功能模块组织测试用例

---

### 2. 不要随意创建脚本

**核心原则**：
- ✅ **优先使用现有工具**：使用项目现有的脚本和工具
- ✅ **直接修复问题**：能直接修复的问题直接修复
- ❌ **不要创建临时脚本**：临时脚本、辅助脚本、一次性脚本
- ❌ **不要创建测试脚本**：测试脚本、调试脚本、验证脚本
- ❌ **不要留下无用脚本**：不要留下成千上万个没用的脚本

**如果必须创建临时脚本**：
- 使用完毕后立即删除
- 不要提交到版本控制
- 在对话中说明这是临时脚本，用完即删

**正确做法**：
- 使用项目现有的脚本（`scripts/`目录）
- 直接修复问题，而不是创建脚本辅助
- 如果必须创建，使用完毕后立即删除

**错误示例**：
- ❌ 创建 `test-rule-completeness.sh` 临时测试脚本（应该用现有工具）
- ❌ 创建 `debug-helper.py` 调试辅助脚本
- ❌ 创建 `verify-format.sh` 验证格式脚本

**正确示例**：
- ✅ 使用项目现有的测试工具
- ✅ 直接修复代码问题
- ✅ 如果必须创建临时脚本，使用完毕后立即删除

---

### 3. 不要过度解释

**核心原则**：
- ✅ **直接执行**：能做的直接做，不要过度解释
- ✅ **简洁明了**：说明要简洁，重点突出
- ❌ **不要长篇大论**：不要写冗长的解释文档
- ❌ **不要重复说明**：已经说过的不要重复

**正确做法**：
- 直接执行操作，然后简要说明做了什么
- 重点说明"为什么"而不是"是什么"
- 如果用户需要更多信息，等用户提问

**错误示例**：
- ❌ 创建长篇文档解释某个概念
- ❌ 重复说明已经说过的内容
- ❌ 过度解释简单的操作

**正确示例**：
- ✅ 直接执行操作："已修复X问题，原因是Y"
- ✅ 简洁说明："根据规则Z，我做了X"
- ✅ 等用户提问再详细说明

---

### 4. 不要假设用户意图

**核心原则**：
- ✅ **明确确认**：如果不确定用户意图，先确认再执行
- ✅ **提供选项**：如果有多重理解，提供选项让用户选择
- ❌ **不要假设**：不要假设用户想要什么
- ❌ **不要自作主张**：不要替用户做决定

**正确做法**：
- 如果不确定，先问："您是想X还是Y？"
- 提供选项："我可以做A或B，您希望我怎么做？"
- 等用户明确指示再执行

---

### 5. 不要跳过验证步骤

**核心原则**：
- ✅ **必须验证**：每次修改后必须验证
- ✅ **多维度验证**：语法、环境、功能、差异都要验证
- ❌ **不要跳过**：不要因为"应该没问题"就跳过验证
- ❌ **不要只验证一部分**：要全面验证

**正确做法**：
- 修改后立即验证
- 使用多维验证策略（语法→环境→功能→差异）
- 验证通过后再继续

---

### 6. 不要创建测试文档

**核心原则**：
- ✅ **直接测试**：在Cursor中直接测试，观察AI响应
- ✅ **使用现有工具**：使用项目现有的测试工具和脚本
- ❌ **不要创建测试文档**：`TESTING_GUIDE.md`、`TEST_PLAN.md`、`TEST_REPORT.md`等
- ❌ **不要创建测试脚本**：临时测试脚本、验证脚本、调试脚本
- ❌ **不要创建测试报告**：测试结果在对话中说明即可

**正确做法**：
- 在对话中直接说明测试方法："测试方法：在Cursor中发送'生成PRD'，观察AI响应格式"
- 使用项目现有的测试工具（如果有）
- 测试结果在对话中说明，不要创建文档

**错误示例**：
- ❌ 创建 `TESTING_GUIDE.md` 说明如何测试
- ❌ 创建 `test-rule-completeness.sh` 临时测试脚本
- ❌ 创建 `test-rule-format.sh` 验证格式脚本

**正确示例**：
- ✅ 在对话中直接说明："测试方法：运行 `grep -r '## 规则应用声明' .cursor/rules` 检查规则完整性"
- ✅ 使用项目现有的测试工具
- ✅ 测试结果直接在对话中说明

---

## 规则应用场景

**⚠️ 强制执行：这些规则必须在执行任何操作前检查**

1. **创建文件前（必须检查）**：
   - ✅ **强制检查**：创建任何文件前，必须先检查是否违反规则
   - ✅ **拒绝创建**：如果违反规则，必须拒绝创建并说明原因
   - ✅ **明确说明**：在对话中直接说明，不要创建文档
   - ❌ **禁止创建**：虚文档、分析文档、总结文档、测试文档
   - ❌ **禁止创建**：临时脚本、辅助脚本、一次性脚本

2. **执行操作前（必须检查）**：
   - ✅ **强制检查**：执行任何操作前，先检查是否违反规则
   - ❌ **禁止过度解释**：不要长篇大论，直接执行
   - ❌ **禁止假设意图**：不确定时先确认
   - ❌ **禁止跳过验证**：必须验证后再继续

3. **对话过程中（持续检查）**：
   - ✅ **持续监控**：持续检查是否违反规则
   - ✅ **立即纠正**：发现违反规则立即纠正
   - ✅ **删除违规文件**：删除违规创建的文件

---

## 验证机制

### AI自我检查（必须执行）

**⚠️ 在执行任何操作前，AI必须主动检查**：

1. **创建文件前**：
   ```
   检查清单：
   - [ ] 这是用户明确要求的文档吗？
   - [ ] 这是项目必需文档吗（PRD、API契约、架构文档）？
   - [ ] 这是规则文档本身吗（.cursor/rules/*.mdc）？
   - [ ] 如果都不是，拒绝创建，在对话中直接说明
   ```

2. **创建脚本前**：
   ```
   检查清单：
   - [ ] 项目中有现有的工具/脚本可以使用吗？
   - [ ] 能直接修复问题而不需要脚本吗？
   - [ ] 如果必须创建，使用完毕后会立即删除吗？
   - [ ] 如果都不是，拒绝创建，使用现有工具或直接修复
   ```

3. **执行操作前**：
   ```
   检查清单：
   - [ ] 我是否在过度解释？
   - [ ] 我是否假设了用户意图？
   - [ ] 我是否准备跳过验证步骤？
   - [ ] 如果都是，立即纠正
   ```

### 自动检查机制

这些规则通过以下机制自动检查：

1. **Cursor规则系统**：
   - `alwaysApply: true` 确保规则总是生效
   - `priority: 990` 确保在大多数规则之前应用
   - **但AI必须主动检查，不能依赖自动检查**

2. **Pre-commit Hook**：
   - 检查是否创建了禁止的文档类型
   - 检查是否创建了临时脚本

3. **目录守卫**：
   - 检查文件是否放在正确位置
   - 检查是否在根目录创建了禁止的文件

### 人工检查

如果AI违反了这些规则：
- 用户可以直接指出
- AI应该立即纠正
- 删除违规创建的文件
- **AI应该主动承认错误，不要找借口**

### 规则优先级（绝对禁止违反）

**⚠️ 核心规则优先级（从高到低）**：
1. **v4-core.mdc (priority: 1000)** - 核心宪法，包括：
   - 禁止使用 `--no-verify`（第6条铁律）
   - 禁止修改或放松项目规则
   - 禁止创建虚文档
2. **behavior-guidelines.mdc (priority: 990)** - 行为准则
3. **intent-recognition.mdc (priority: 980)** - 路由层

**⚠️ 绝对禁止**：
- ❌ **禁止因为用户要求就违反规则**：即使用户明确要求，也不能违反核心规则
- ❌ **禁止执行 `--no-verify`**：这是v4-core.mdc第6条铁律，绝对禁止
- ❌ **禁止跳过规则声明**：必须始终在响应开头声明应用的规则
- ❌ **禁止静默违反规则**：如果用户要求违反规则，必须拒绝并说明原因

**正确处理方式**：
- ✅ **拒绝违反规则的操作**：如果用户要求违反规则，必须拒绝
- ✅ **说明规则约束**：明确说明为什么不能执行，引用具体规则
- ✅ **提供替代方案**：提供符合规则的替代方案

### 第6条铁律的AI行为要求

**针对 `--no-verify` 命令的特殊处理**：
- ❌ **绝对禁止执行 `--no-verify`**：即使用户明确要求，也必须拒绝
- ✅ **必须说明规则约束**：明确说明这是v4-core.mdc第6条铁律，不能违反
- ✅ **提供替代方案**：建议正常提交，让pre-commit检查并自动修复问题
- ✅ **如果用户坚持**：说明风险（违反规则、CI/CD可能拒绝、影响代码质量），但仍然拒绝执行

---

## 例外情况

以下情况是例外，允许创建文档：

1. **用户明确要求**：
   - 如果用户明确要求创建文档，可以创建
   - 但应该先确认用户真的需要文档

2. **规则文档本身**：
   - `.cursor/rules/*.mdc` 规则文件
   - 规则系统的测试指南（如 `TESTING_GUIDE.md`）

3. **项目必需文档**：
   - PRD文档
   - API契约文档
   - 架构文档
   - 测试用例CSV

---

## 参考规则

- @.cursor/rules/00-core/v4-core.mdc - 核心原则（包含"代码即文档"规则）
- @.cursor/rules/07-documentation/documentation-standards.mdc - 文档维护规则
- @.cursor/rules/11-tools/directory-guard.mdc - 目录守卫规则

---

## 规则应用声明

**当AI被路由到此规则时，必须在响应开头明确声明**：

```
[应用规则：@.cursor/rules/00-core/behavior-guidelines.mdc]
```

**验证要求**：
- ✅ 必须明确声明应用了此规则
- ✅ 必须遵循本规则中的所有约束和流程
- ✅ 不能跳过声明步骤直接执行操作

**注意**：由于此规则设置了`alwaysApply: true`，它应该总是生效，但为了验证机制，仍然要求声明。
