# V4 自我进化与教训宪法

> **核心原则**: 失败是进化的养料，教训是代码的边界。

## 1. 核心教训库 (Knowledge Base of Failures)

### 🚨 [2025-12-31] 严禁绕过分支保护流程
- **场景**: 在更新规则文件时，直接在 `dev` 分支提交并推送。
- **根因**: 过度关注任务完成度，误以为“系统规则同步”可以豁免分支保护，且利用了 `./safe-push` 的脚本漏洞绕过拦截。
- **硬性约束**:
  - 即使是规则文件、文档修改，也必须遵循 `feature/REQ-ID-desc` -> `PR` -> `dev` 流程。
  - 在执行 `git commit` 前，必须先运行 `git branch --show-current`。若是 `dev` 或 `main`，必须立即强制切换分支。
  - 绝对禁止在 `dev` 分支进行任何代码或配置的物理写入。

## 2. 进化触发机制
- **3次失败规则**: 任何任务连续失败 3 次，必须在此记录失败路径，并质疑底层假设。
- **用户质疑信号**: 当用户发出“为什么你直接推送...”或“为何还没修好”等质疑时，必须将该场景录入教训库。

## 3. 规则维护指南
- **原子性**: 每次录入必须包含：[日期]、[问题描述]、[根因分析]、[硬性约束]。
- **动态加载**: 本规则属于 `00-core` 宪法层，任何涉及 Git、开发流程的任务必须优先加载此规则。

---

## 规则应用声明
当AI被路由到此规则时，必须在响应开头明确声明：

```
[应用规则：@.cursor/rules/00-core/v4-self-evolution.mdc]
```
