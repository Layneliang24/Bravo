# V4 自我进化与原子禁令宪法

> **核心原则**: 失败是进化的养料，禁令是流程的边界。

---

## 1. 原子禁令 (AI 行为红线)

### 🚫 操作红线
- **禁止宿主机操作**: 必须在容器内运行指令。
- **禁止绕过拦截**: 严禁 `--no-verify` 或使用环境变量跳过检查。
- **禁止篡改凭证**: 严禁手动创建或修改 `.passport` 验证文件。
- **禁止打地鼠**: 发现问题必须执行全局搜索 (`grep`) 确保彻底修复。

### 🚫 流程红线
- **禁止命令串联**: 禁止使用 `&&` 串联命令，必须分步执行并验证每步结果。
- **禁止截取输出**: 禁止使用 `tail` 或类似工具截取输出，必须展示完整过程日志以供审计。
- **禁止忽略输出内容**: 必须完整读取命令的所有输出（stdout 和 stderr），识别警告、错误、异常信息，即使 Exit Code 为 0 也要评估输出内容的正确性。
- **禁止任务中断**: 任务未完成前不得中断；长时间任务需定期汇报进度以保持会话激活。
- **禁止多开终端**: 禁止同时打开多个终端会话，必须使用单一主终端执行命令。
- **禁止输出会话内容**: 禁止在命令行中回复用户或输出与开发、调试无关的信息。

### 🚫 质量红线
- **禁止直接修改测试**: 修改测试前必须先检查 PRD 和测试用例 CSV，确认测试期望是否正确；禁止脱离需求直接修改测试使其通过。

---

## 2. 核心问题解决哲学 (基于 30 轮修复经验)

- **正确抽象层次优先**: 在合适的层次寻找问题根因（脚本层 vs 容器层 vs 应用层）。
- **用户反馈价值最大化**: 用户质疑往往指向真正问题，立即深入分析。
- **系统性思维而非点修复**: 发现一个问题时，系统性搜索所有相同问题。
- **自我质疑机制常态化**: 连续失败 3 次必须质疑基础假设和方法论。
- **多维验证策略**: 单一工具验证不足，需要语法 + 环境 + 功能多层验证。

---

## 3. 核心教训库 (Knowledge Base of Failures)

### 🚨 [2025-12-31] 严禁绕过分支保护流程
- **场景**: 在更新规则文件时，直接在 `dev` 分支提交并推送。
- **约束**: 任何变更必须遵循 `feature/REQ-ID` -> `PR` -> `dev` 流程。

### 🚨 [2026-01-01] 严禁预判服务器时间
- **场景**: 手动设置 PRD `updated_at` 为未来时间导致合规拦截。
- **约束**: 元数据时间戳必须设为明显过去的 UTC 时间。

### 🚨 [2026-01-01] 严禁盲目推进未验证命令
- **场景**: 在 commit 失败的情况下继续执行 PR 创建命令，导致误报成功。
- **约束**: 必须分步执行命令，检查每个环节的 Exit Code。

### 🚨 [2026-01-01] 严禁仅凭退出码判断成功
- **场景**: 命令 Exit Code 为 0 但输出中包含警告或错误信息时，误判为成功并继续执行后续步骤。
- **约束**: 必须完整读取命令输出的所有内容（stdout 和 stderr），识别并处理警告、错误、异常信息，不能仅依赖 Exit Code 判断命令执行结果。

---

## 规则应用声明
当AI被路由到此规则时，必须在响应开头明确声明：
```
[应用规则：@.cursor/rules/00-core/v4-self-evolution.mdc]
```
