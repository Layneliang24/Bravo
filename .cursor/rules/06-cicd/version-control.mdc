---
description: 版本控制规则（Git提交、推送、分支管理、PR流程）
globs: **/*
priority: 900
---

# 版本控制规则

## 1. 追溯链憲法
所有操作必须符合追溯链：`REQ-ID → Task-ID → Test → Code → Commit`。

## 2. 提交规范 (Commit)
- **消息格式**: `[REQ-ID] Task-X 简述` (推荐使用 Conventional Commits 风格)。
- **Pre-commit 必检项**:
  - 依赖冲突、本地通行证、代码质量 (Lint/Type)、V4 合规引擎审计。
- **自核清单**:
  - [ ] 所有文件包含 REQ-ID。
  - [ ] 修复了所有合规警告 (Compliance Warning)。

## 3. 推送规范 (Push)
- **黄金法则**: 推送前必须获得 **本地测试通行证** (有效性 1h)。
- **操作指令**:
  ```bash
  ./test          # 生成通行证 (完整/快速模式)
  ./safe-push     # 安全推送 (自动验证通行证)
  ```
- ❌ **绝对禁止**: 使用 `--no-verify` 或环境变量绕过推送检查。

## 4. 分支与 PR 管理
- **保护分支**: `main` 和 `dev` 严禁直接推送。
- **分支命名**: `feature/REQ-ID-desc` 或 `bugfix/REQ-ID-desc`。
- **分支清理**: PR 合并后立即执行本地与远程分支删除。
- **PR 约束**: 严禁在存在失败 Check 的情况下合并；严禁绕过审查强推。

## 5. 常用工具指令
- **Git 辅助**: `git log --oneline -10`, `git status`。
- **GitHub CLI**: `gh pr view`, `gh pr checks`, `gh run list --limit 5`。

---

## 规则应用声明
当AI被路由到此规则时，必须在响应开头明确声明：

```
[应用规则：@.cursor/rules/06-cicd/version-control.mdc]
```
