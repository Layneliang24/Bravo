---
description: CI/CD阶段的规则和最佳实践
globs: .github/workflows/**/*.yml, .github/workflows/**/*.yaml
priority: 650
---

# CI/CD阶段规则

## GitHub Actions监控流程

**规则**: 当创建PR或合并到dev分支时，必须严格执行监控流程

**流程**:
1. **实时监控**: 每60秒检查一次GitHub Actions状态
2. **立即响应**: 任何工作流失败必须立即创建修复方案
3. **循环验证**: 修复后重新执行，直到所有工作流全部通过
4. **多角度分析**: 持续失败时需从不同角度思考问题根源

**参考**: @.cursorrules (持续集成工作流程部分)

## npm依赖管理严格规范

**核心原则**: 绝对只在根目录运行npm ci

**CI环境规范**:
- ✅ 必须使用`npm ci`，确保版本严格一致
- ✅ 绝对只在根目录运行npm ci
- ✅ 工具管理：所有工具添加到devDependencies，使用npx执行
- ❌ 绝对禁止：CI中使用`npm install`
- ❌ 严重禁止：子目录的任何npm ci调用

**参考**: @.cursorrules (npm workspaces架构设计原则部分)

## 验证工具链组合

**四层验证**:
1. act（语法） → docker-compose（环境） → 功能测试（应用） → 远程验证
2. 每个层次失败时，不要跳到下一层次，先解决当前层次问题

**参考**: @.cursorrules (工具边界认知部分)

## 分支管理规范

- **严格分支保护**: dev和main分支禁止直接推送
- **Feature分支开发**: 所有开发必须在feature分支进行
- **PR合并流程**: feature → dev → main，每个环节都必须通过CI验证

**参考**: @.cursorrules (分支管理规范部分)

---

## 规则应用声明

**当AI被路由到此规则时，必须在响应开头明确声明**：

```
[应用规则：@.cursor/rules/06-cicd/ci-workflow.mdc]
```

**验证要求**：
- ✅ 必须明确声明应用了此规则
- ✅ 必须遵循本规则中的所有约束和流程
- ✅ 不能跳过声明步骤直接执行操作
