---
description: CI/CD阶段的规则和最佳实践
globs: .github/workflows/**/*.yml, .github/workflows/**/*.yaml
priority: 650
---

# CI/CD 阶段规则

## 1. 实时监控流程 (强制执行)
当创建 PR 或向 `dev`/`main` 推送后，AI 必须进入主动监控状态：
- **监控频率**: 每 60 秒使用 `gh run list` 检查 Actions 状态。
- **故障响应**: 发现失败立即 `gh run view --log-failed` 并提供修复方案。
- **多维验证链**: `act (语法)` → `docker-compose (环境)` → `功能测试 (应用)` → `远程验证`。

## 2. npm 依赖管理 (Workspaces 约束)
> [!IMPORTANT]
> 错误的依赖安装会破坏 Workspace 结构。
- **单一入口**: 绝对只在 **根目录** 运行 `npm ci`。
- **CI 禁令**: 严禁在 CI 环境中使用 `npm install`；严禁在子目录运行 `npm ci`。

## 3. 部署前自核 (CD 相关)
- 覆盖率必须 >= 80%。
- 必须通过 `act` 预演 Workflow 语法。
- 环境变量与数据库迁移脚本必须通过本地容器验证。

---

## 规则应用声明
当AI被路由到此规则时，必须在响应开头明确声明：

```
[应用规则：@.cursor/rules/06-cicd/ci-workflow.mdc]
```
