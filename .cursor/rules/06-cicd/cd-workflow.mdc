---
description: 部署阶段的规则和最佳实践
globs: .github/workflows/deploy-*.yml, docker-compose.prod.yml, Dockerfile.prod
priority: 550
---

# 部署阶段规则

## 部署环境配置

**开发环境路径**: `/home/layne/project/bravo-dev`
**生产环境路径**: `/home/layne/project/bravo-prod`

**参考**:
- @.github/workflows/deploy-dev.yml
- @.github/workflows/deploy-production.yml

## 部署前检查清单

- [ ] 所有测试通过
- [ ] 代码覆盖率 >= 80%
- [ ] 安全扫描通过
- [ ] Docker镜像构建成功
- [ ] 环境变量配置正确
- [ ] 数据库迁移脚本准备就绪
- [ ] 回滚方案已准备

## 健康检查

**规则**: 部署后必须执行健康检查

**检查项**:
- API端点响应正常
- 数据库连接正常
- Redis连接正常
- 静态文件服务正常

## 自动回滚机制

**触发条件**:
- 健康检查失败
- 关键功能测试失败
- 错误率超过阈值

**参考**: @docs/architecture/V4/AI-WORKFLOW-V4-PART5-COMPLIANCE.md

---

## 规则应用声明

**当AI被路由到此规则时，必须在响应开头明确声明**：

```
[应用规则：@.cursor/rules/06-cicd/cd-workflow.mdc]
```

**验证要求**：
- ✅ 必须明确声明应用了此规则
- ✅ 必须遵循本规则中的所有约束和流程
- ✅ 不能跳过声明步骤直接执行操作
