---
description: Task-Master生成任务阶段的规则
globs: .taskmaster/**/*.json, .taskmaster/**/*.md
priority: 800
---

# 任务生成规范

## 1. 工作流指令
1. **解析**: `task-master parse-prd <prd-file> --tag <tag-name>`。
2. **展开**: `task-master expand --all --research` (复杂度 ≥ 8 必须展开)。
3. **自核**: `task-master show <task_id>` 检查关联的 REQ-ID。

## 2. Task-0 强制任务 (自检)
每个 PRD 的第一个任务必须是 **Task-0**，其子任务固定为：
- [ ] 验证 PRD 元数据与技术细节完整性。
- [ ] 检查测试目录结构与 API 契约文件是否存在。
- [ ] 验证数据库设计是否包含索引与约束。

## 3. 任务组织原则
- **TDD 嵌入**: 每个功能任务必须包含 `[测试-红]`, `[实现-绿]`, `[重构]` 三个子任务。
- **依赖序向**: 数据库 → 后端 API → 前端 UI。
- **容器化**: 任务描述中必须指明使用的 `docker-compose exec` 命令。

## 4. 任务文件生成要求（强制）
- **每个 task 必须生成对应的 md 文件**: 所有 task 必须生成对应的 Markdown 文件，格式为 `task_{id}_REQ-{REQ-ID}.md` 或 `task-{id}.md`。
- **文件位置**: 文件应位于 `.taskmaster/tasks/{REQ-ID}/` 目录下。
- **文件用途**: md 文件用于 AI 查看任务详情（无需解析 JSON），提供人类可读的任务描述，用于项目文档和任务追踪。
- **合规检查**: 合规引擎会检查每个 task 是否有对应的 md 文件，缺失会导致合规检查失败。
- **自动生成**: 使用 `scripts/task-master/adapter.py` 或 `task-master generate` 命令可自动生成这些文件。

## 5. 任务存储结构
- **统一存储**: 所有 task 共存在 `.taskmaster/tasks/tasks.json` 文件中。
- **REQ-ID 区分**: 不同 PRD 生成的 task 以完整的 REQ-ID 作为 key 区分（如 `"REQ-2025-003-user-login"`）。
- **Task-ID 命名**: 每个 REQ-ID 下的 tasks 数组中的 task id 都从 0 开始命名：
  - Task-0: 强制性的自检任务（id: 0）
  - 后续任务: 从 id: 1 开始递增

## 6. 自动化建议
- 优先使用 `bash scripts/task-master-parse-prd.sh`，该脚本会自动生成 Task-0 并更新 PRD 状态。

---

## 规则应用声明
当AI被路由到此规则时，必须在响应开头明确声明：

```
[应用规则：@.cursor/rules/03-taskmaster/task-generation.mdc]
```
