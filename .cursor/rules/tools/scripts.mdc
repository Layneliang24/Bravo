---
description: 脚本与Shell规则
globs: scripts/**/*.sh, ops/**/*.sh
priority: 520
---

# 脚本与Shell规则

## 适用范围
- CI/运维/工具脚本：`scripts/**/*.sh`, `ops/**/*.sh`

## 基本要求
- `set -euo pipefail`，并考虑 `IFS=$'\n\t'`
- 明确的错误处理和退出码
- 变量引用加引号，避免单词拆分
- 避免在脚本中写死路径，优先相对路径或环境变量

## 安全与合规
- 禁止写入敏感信息到日志
- 避免 `curl | sh` 等未验证管道
- 如需 sudo/特权操作，注明理由并最小化权限

## 日志与可观测
- 关键步骤输出日志，便于排障
- 对外部命令失败要输出上下文

## 禁止事项
- ❌ 未设 `set -e` 或忽略错误
- ❌ 在脚本中硬编码密钥、token
- ❌ 使用无验证的下载执行
