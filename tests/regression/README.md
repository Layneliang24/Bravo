# 回归测试框架

## 概述

回归测试确保新代码变更不会破坏现有功能。本框架提供了完整的回归测试解决方案。

## 目录结构

```
tests/regression/
├── README.md                 # 本文档
├── config/                   # 配置文件
│   ├── regression.config.js  # 回归测试配置
│   └── baselines/            # 基线数据
├── api/                      # API回归测试
│   ├── auth/                 # 认证相关API
│   ├── blog/                 # 博客相关API
│   ├── user/                 # 用户相关API
│   └── common/               # 通用API测试
├── ui/                       # UI回归测试
│   ├── pages/                # 页面级测试
│   ├── components/           # 组件级测试
│   └── flows/                # 用户流程测试
├── data/                     # 测试数据
│   ├── fixtures/             # 固定测试数据
│   ├── snapshots/            # 快照数据
│   └── baselines/            # 基线数据
├── utils/                    # 工具函数
│   ├── snapshot.js           # 快照工具
│   ├── compare.js            # 对比工具
│   └── reporter.js           # 报告工具
└── reports/                  # 测试报告
    ├── html/                 # HTML报告
    ├── json/                 # JSON报告
    └── diff/                 # 差异报告
```

## 测试类型

### 1. API回归测试
- **响应结构测试**: 验证API响应的数据结构
- **响应内容测试**: 验证关键字段的值
- **性能回归测试**: 验证API响应时间
- **错误处理测试**: 验证错误场景的处理

### 2. UI回归测试
- **视觉回归测试**: 页面截图对比
- **功能回归测试**: 关键功能验证
- **交互回归测试**: 用户交互流程验证
- **响应式测试**: 不同屏幕尺寸下的表现

### 3. 数据回归测试
- **数据库状态测试**: 验证数据库操作结果
- **数据一致性测试**: 验证数据的完整性
- **数据迁移测试**: 验证数据迁移的正确性

## 使用方法

### 运行所有回归测试
```bash
npm run test:regression
```

### 运行API回归测试
```bash
npm run test:regression:api
```

### 运行UI回归测试
```bash
npm run test:regression:ui
```

### 更新基线数据
```bash
npm run test:regression:update-baseline
```

## 配置说明

### 基线管理
- 基线数据存储在 `config/baselines/` 目录
- 每次发布前需要更新基线数据
- 基线数据包括API响应、UI截图、数据库状态等

### 阈值配置
- API响应时间阈值: 500ms
- UI视觉差异阈值: 0.1%
- 数据一致性检查: 100%

## 最佳实践

1. **定期更新基线**: 每次重大功能发布后更新基线数据
2. **分层测试**: 从单元到集成再到端到端的分层回归
3. **快速反馈**: 关键路径的回归测试应在5分钟内完成
4. **自动化执行**: 集成到CI/CD流水线中自动执行
5. **详细报告**: 提供清晰的差异报告和修复建议

## 故障排除

### 常见问题
1. **基线数据过期**: 定期更新基线数据
2. **环境差异**: 确保测试环境的一致性
3. **时间敏感数据**: 使用固定时间或相对时间
4. **动态内容**: 忽略或模拟动态生成的内容

### 调试技巧
1. 使用 `--verbose` 参数查看详细日志
2. 检查 `reports/diff/` 目录中的差异报告
3. 对比 `data/snapshots/` 中的快照数据
4. 验证测试环境的配置和数据状态