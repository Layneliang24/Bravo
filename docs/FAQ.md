# å¸¸è§é—®é¢˜è§£ç­” (FAQ)

## CI/CD ä¾èµ–ç®¡ç†é—®é¢˜

### Q: ä¸ºä»€ä¹ˆCIç¯å¢ƒå¿…é¡»ä½¿ç”¨npm ciè€Œä¸æ˜¯npm installï¼Ÿ

#### æ ¸å¿ƒé—®é¢˜ï¼šnpm installæ»¥ç”¨å¯¼è‡´çš„ä¾èµ–æ¼‚ç§»ç¾éš¾

**å†å²æ•™è®­**ï¼šæœ¬é¡¹ç›®ç»å†äº†30è½®CIä¿®å¤çš„æƒ¨ç—›æ•™è®­ï¼Œæ ¹æœ¬åŸå› å°±æ˜¯CIç¯å¢ƒä¸­æ»¥ç”¨npm installå¯¼è‡´çš„ä¾èµ–æ¼‚ç§»é—®é¢˜ã€‚

#### æŠ€æœ¯åŸç†å·®å¼‚

| å‘½ä»¤          | ä½¿ç”¨åœºæ™¯  | è¡Œä¸ºç‰¹ç‚¹                                | é—®é¢˜é£é™©                |
| ------------- | --------- | --------------------------------------- | ----------------------- |
| `npm install` | æœ¬åœ°å¼€å‘  | æ›´æ–°package-lock.jsonï¼Œä¾èµ–ç‰ˆæœ¬å¯èƒ½æ¼‚ç§» | âŒ CIä¸­ä¼šå¯¼è‡´ç‰ˆæœ¬ä¸ä¸€è‡´ |
| `npm ci`      | CI/CDç¯å¢ƒ | ä¸¥æ ¼æŒ‰ç…§package-lock.jsonå®‰è£…ï¼Œä¸ä¼šä¿®æ”¹ | âœ… ç¡®ä¿ç‰ˆæœ¬ä¸¥æ ¼ä¸€è‡´     |

#### npm workspacesç¯å¢ƒçš„å…³é”®è¦æ±‚

**æ­£ç¡®çš„å®‰è£…é¡ºåº**ï¼š

```yaml
# 1. æ ¹ç›®å½•workspacesä¾èµ–ä¼˜å…ˆå®‰è£…
- run: npm ci --prefer-offline --no-audit

# 2. å­ç›®å½•ä¾èµ–åå®‰è£…
- working-directory: ./frontend
  run: npm ci --prefer-offline --no-audit
```

**é”™è¯¯çš„å®‰è£…é¡ºåº**ä¼šå¯¼è‡´ï¼š

- workspacesä¾èµ–è§£æå¤±è´¥
- å­æ¨¡å—æ‰¾ä¸åˆ°ä¾èµ–åŒ…
- dedupedæœºåˆ¶é”™è¯¯åˆ é™¤ä¾èµ–

#### 30è½®ä¿®å¤è¡€æ³ªå²çš„æ¶æ€§å¾ªç¯

```
npm workspacesæ­£å¸¸çŠ¶æ€
â†’ CIä¸­ä½¿ç”¨npm install
â†’ ä¾èµ–ç‰ˆæœ¬æ¼‚ç§»/è§£æå¤±è´¥
â†’ E2Eæµ‹è¯•å¤±è´¥
â†’ ç”¨npm installå¼ºåˆ¶ä¿®å¤
â†’ ç ´åworkspacesç»“æ„
â†’ æ›´å¤šä¾èµ–è§£æé—®é¢˜
â†’ ç¬¬Nè½®ä¿®å¤...
```

#### âš ï¸ è¿‡æ—¶è§‚ç‚¹çº æ­£ï¼šå…¨å±€å·¥å…·ä¹Ÿå¿…é¡»ç‰ˆæœ¬é”å®š

**âŒ é”™è¯¯è§‚ç‚¹**ï¼šå…¨å±€å·¥å…·å¯ä»¥ä½¿ç”¨`npm install -g`
**âœ… æ­£ç¡®åšæ³•**ï¼šæ‰€æœ‰å·¥å…·éƒ½å¿…é¡»ç‰ˆæœ¬é”å®šï¼Œä½¿ç”¨npm ci + npx

**ç‰ˆæœ¬æ¼‚ç§»é£é™©**ï¼š

- npm install -gä¼šå®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼šä»Šå¤©5.3.2ï¼Œæ˜å¤©5.4.0
- åŒä¸€ä»½workflowåœ¨ä¸åŒæ—¶é—´è¿è¡Œç»“æœä¸ä¸€è‡´
- å·¥å…·APIå˜åŒ–å¯èƒ½ç ´åCIæµæ°´çº¿

**æ­£ç¡®çš„å·¥å…·ç®¡ç†æ–¹å¼**ï¼š

```yaml
# âœ… æ­£ç¡®ï¼šå°†å·¥å…·æ·»åŠ åˆ°package.json devDependencies
# package.json
"devDependencies": {
  "@lhci/cli": "^0.14.0",
  "jscpd": "^4.0.5",
  "audit-ci": "^7.1.0"
}

# âœ… æ­£ç¡®ï¼šCIä¸­ä½¿ç”¨npm ci + npxæ‰§è¡Œ
- run: npm ci --prefer-offline --no-audit
- run: npx lhci autorun

# âŒ é”™è¯¯ï¼šå…¨å±€å®‰è£…å’Œç›´æ¥æ‰§è¡Œ
- run: npm install -g @lhci/cli
- run: lhci autorun
```

**æŠ€æœ¯åŸç†**ï¼š

- npmå®˜æ–¹æ–‡æ¡£æ˜ç¡®ï¼š"CIç¯å¢ƒè¯·ç”¨npm ci"ï¼ŒæœªåŒºåˆ†ä¸šåŠ¡ä¾èµ–å’Œå·¥å…·ä¾èµ–
- Googleã€GitHubå¼€æºé¡¹ç›®å…¨éƒ¨å°†CLIå·¥å…·å†™è¿›lockæ–‡ä»¶
- CIç¯å¢ƒçš„æœ€é«˜åŸåˆ™æ˜¯**å®Œå…¨å¯é‡ç°æ€§**

#### é¡¹ç›®è§„èŒƒè¦æ±‚

1. **CIå·¥ä½œæµ**ï¼šå¿…é¡»ä½¿ç”¨`npm ci`
2. **æœ¬åœ°å¼€å‘**ï¼šå¯ä»¥ä½¿ç”¨`npm install`
3. **ä¾èµ–å®‰è£…é¡ºåº**ï¼šæ ¹ç›®å½•ä¼˜å…ˆï¼Œå­ç›®å½•å…¶æ¬¡
4. **å¼‚å¸¸ä¿®å¤**ï¼šç»ä¸ä½¿ç”¨npm installä½œä¸ºCIä¿®å¤æ–¹æ¡ˆ

### Q: å¦‚ä½•è¯†åˆ«å’Œä¿®å¤ä¾èµ–æ¼‚ç§»é—®é¢˜ï¼Ÿ

#### è¯†åˆ«ä¿¡å·

- E2Eæµ‹è¯•ä¸­æ¨¡å—è§£æå¤±è´¥
- `npm list`æ˜¾ç¤ºä¾èµ–æ ‘ä¸ºç©º
- workspaceså­æ¨¡å—æ‰¾ä¸åˆ°å…±äº«ä¾èµ–
- CIä¸­ä¾èµ–å®‰è£…åç«‹å³å¤±æ•ˆ

#### ä¿®å¤ç­–ç•¥

1. **æ£€æŸ¥npm workspacesä¾èµ–å®‰è£…é¡ºåº**
2. **ç¡®ä¿CIä¸­ä¸¥æ ¼ä½¿ç”¨npm ci**
3. **ç§»é™¤æ‰€æœ‰ä¾èµ–æ¼‚ç§»è¡¥ä¸ä»£ç **
4. **æ¢å¤æ­£ç¡®çš„workspacesæœºåˆ¶**

## ä»£ç æ ¼å¼é—®é¢˜

### Q: ä»£ç æ ¼å¼é—®é¢˜æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ

#### ç›´æ¥å½±å“

- **å¯è¯»æ€§å·®**ï¼šæ ¼å¼æ··ä¹±çš„ä»£ç éš¾ä»¥é˜…è¯»å’Œç†è§£
- **åä½œå›°éš¾**ï¼šä¸åŒå¼€å‘è€…ä¹ æƒ¯ä¸åŒæ ¼å¼ï¼Œå®¹æ˜“äº§ç”Ÿå†²çª
- **å®¡æŸ¥æ•ˆç‡ä½**ï¼šReviewer éœ€è¦èŠ±æ—¶é—´ç†è§£æ ¼å¼ï¼Œè€Œä¸æ˜¯å…³æ³¨é€»è¾‘

#### é—´æ¥å½±å“

- **Git å†å²æ±¡æŸ“**ï¼šæ ¼å¼ä¿®æ”¹ä¼šäº§ç”Ÿå¤§é‡æ— æ„ä¹‰çš„ diff
- **åˆå¹¶å†²çª**ï¼šæ ¼å¼ä¸ä¸€è‡´å®¹æ˜“å¯¼è‡´åˆå¹¶å†²çª
- **å·¥å…·å…¼å®¹æ€§**ï¼šæŸäº›å·¥å…·å¯èƒ½å¯¹æ ¼å¼æ•æ„Ÿ

#### é•¿æœŸå½±å“

- **ä»£ç è´¨é‡æ„ŸçŸ¥**ï¼šæ ¼å¼æ··ä¹±ç»™äººä»£ç è´¨é‡å·®çš„å°è±¡
- **æ–°äººä¸Šæ‰‹éš¾åº¦**ï¼šæ–°å¼€å‘è€…éœ€è¦é€‚åº”ä¸ä¸€è‡´çš„æ ¼å¼
- **æŠ€æœ¯å€ºåŠ¡ç§¯ç´¯**ï¼šæ ¼å¼é—®é¢˜ä¼šè¶Šç§¯è¶Šå¤š

### Q: å¦‚ä½•è§£å†³å†å²æ–‡ä»¶çš„æ ¼å¼é—®é¢˜ï¼Ÿ

#### ä¸€æ¬¡æ€§å…¨é‡ä¿®å¤ï¼ˆæ¨èï¼‰

```bash
# æ£€æŸ¥å“ªäº›æ–‡ä»¶æœ‰æ ¼å¼é—®é¢˜
npx prettier --list-different src/

# ä¸€æ¬¡æ€§ä¿®å¤æ‰€æœ‰æ ¼å¼é—®é¢˜
npx prettier --write src/

# æäº¤ä¿®å¤
git add . && git commit -m "style: ä¿®å¤å†å²æ–‡ä»¶prettieræ ¼å¼é—®é¢˜"
```

#### é¢„é˜²æ€§æ£€æŸ¥

```bash
# å®šæœŸæ£€æŸ¥
npx prettier --check .
```

### Q: pre-commit é’©å­ä¸ºä»€ä¹ˆåªæ£€æŸ¥æš‚å­˜åŒºæ–‡ä»¶ï¼Ÿ

è¿™æ˜¯ pre-commit çš„è®¾è®¡åŸç†ï¼š

- **æ•ˆç‡è€ƒè™‘**ï¼šé¿å…æ¯æ¬¡æäº¤éƒ½æ£€æŸ¥æ•´ä¸ªé¡¹ç›®
- **é€»è¾‘åˆç†**ï¼šå·²æäº¤çš„æ–‡ä»¶ç†è®ºä¸Šå·²ç»é€šè¿‡æ£€æŸ¥
- **å¼€å‘ä½“éªŒ**ï¼šå¼€å‘è€…åªéœ€è¦å…³æ³¨è‡ªå·±ä¿®æ”¹çš„æ–‡ä»¶

**æ³¨æ„**ï¼špre-commit åªèƒ½ä¿è¯å¢é‡è´¨é‡ï¼Œä¸èƒ½ä¿è¯å­˜é‡è´¨é‡ã€‚å¯¹äºå†å²é—ç•™é—®é¢˜ï¼Œéœ€è¦ä¸»åŠ¨è¿›è¡Œä¸€æ¬¡æ€§æ¸…ç†ã€‚

### è§£å†³æ–¹æ¡ˆè®°å½•

**é—®é¢˜**ï¼šå†å²æ–‡ä»¶è·³è¿‡äº† prettier æ£€æŸ¥ï¼Œå¯¼è‡´æ ¼å¼ä¸ä¸€è‡´
**å‘ç°**ï¼š3ä¸ªå‰ç«¯æ–‡ä»¶å­˜åœ¨æ ¼å¼é—®é¢˜ï¼ˆ30%çš„æ–‡ä»¶ï¼‰
**è§£å†³**ï¼šä½¿ç”¨ `npx prettier --write src/` ä¸€æ¬¡æ€§ä¿®å¤
**ç»“æœ**ï¼šæ‰€æœ‰æ–‡ä»¶æ ¼å¼ç»Ÿä¸€ï¼Œä»£ç å¯è¯»æ€§æå‡
**æ—¶é—´**ï¼š2025-09-09

## å¼€å‘ç¯å¢ƒé—®é¢˜

### Q: Pre-commitæ£€æŸ¥æŒç»­å¤±è´¥ï¼Œæ— æ³•æäº¤ä»£ç 

**é—®é¢˜æè¿°**: é‡åˆ°TypeScriptå’ŒESLintä¾èµ–é—®é¢˜å¯¼è‡´pre-commitå¤±è´¥

**å…·ä½“é”™è¯¯**:

1. `global-teardown.ts: Type 'IGlob' is missing properties` - glob APIç‰ˆæœ¬ä¸å…¼å®¹
2. `Cannot find module '@eslint/eslintrc/dist/eslintrc.cjs'` - ESLintä¾èµ–è·¯å¾„é”™è¯¯
3. Python pylint \_metaè®¿é—®è­¦å‘Šï¼ˆå¯æ¥å—çº§åˆ«ï¼‰

**å°è¯•çš„è§£å†³æ–¹æ¡ˆ**:

- ä¿®å¤Pythonå˜é‡å‘½åå’Œå¯¼å…¥é—®é¢˜ âœ…
- å®‰è£…ç¼ºå¤±çš„TypeScriptç±»å‹å®šä¹‰ âœ…
- ä¿®å¤glob APIä½¿ç”¨æ–¹å¼ âŒ (APIä¸å…¼å®¹)
- é‡æ–°å®‰è£…npmä¾èµ– âŒ (æƒé™é—®é¢˜)

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆ**:
å½“pre-commité˜»æ­¢å…³é”®ä¿®å¤éªŒè¯æ—¶ï¼Œå¯ä»¥è€ƒè™‘ï¼š

```bash
# ä»…åœ¨ç´§æ€¥æƒ…å†µä¸‹ä½¿ç”¨ï¼Œä¹‹åå¿…é¡»ä¿®å¤è´¨é‡é—®é¢˜
git commit --no-verify -m "ç´§æ€¥ä¿®å¤: æè¿°å…·ä½“é—®é¢˜"
```

**æ ¹æœ¬è§£å†³æ–¹æ¡ˆ**:

1. å‡çº§åˆ°å…¼å®¹çš„globç‰ˆæœ¬
2. é‡å»ºESLinté…ç½®å’Œä¾èµ–
3. è°ƒæ•´pylinté…ç½®å¿½ç•¥Django \_metaè®¿é—®

**æ—¶é—´**: 2025-09-15

### Q: Vue.js TypeScriptç±»å‹æ£€æŸ¥å¤±è´¥ - @vue/sharedæ¨¡å—distç›®å½•ç¼ºå¤±

**é—®é¢˜æè¿°**: devåˆ†æ”¯CIå¤±è´¥ï¼ŒTypeScriptç±»å‹æ£€æŸ¥æ— æ³•é€šè¿‡

**å…·ä½“é”™è¯¯**:

```
Error: Cannot find module './dist/shared.cjs.js'
Require stack:
- node_modules/@vue/shared/index.js
- node_modules/@vue/language-core/lib/utils/shared.js
- [Vue TypeScript chain...]
```

**æ ¹æœ¬åŸå› **:
Vue.js `@vue/shared` æ¨¡å—å®‰è£…ä¸å®Œæ•´ï¼Œç¼ºå°‘ `dist` ç›®å½•ï¼Œå¯¼è‡´ `vue-tsc --noEmit` å‘½ä»¤å¤±è´¥

**çœŸæ­£åŸå› **:

- **CIç¯å¢ƒ**: æ²¡æœ‰npmç¼“å­˜("npm cache is not found")ï¼Œå…¨æ–°å®‰è£…ä¾èµ–ï¼ŒVueæ¨¡å—å®Œæ•´
- **æœ¬åœ°ç¯å¢ƒ**: æœ‰æŸåçš„npmç¼“å­˜/ä¾èµ–ï¼ŒVueæ¨¡å—ç¼ºå°‘distç›®å½•

**è§£å†³æ–¹æ¡ˆ**:

1. **æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°å®‰è£…ä¾èµ–** (æœ¬åœ°ç¯å¢ƒ):

```bash
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

2. **ESLinté…ç½®ä¼˜åŒ–** (å·²ä¿®å¤):

```javascript
// æµ‹è¯•æ–‡ä»¶ä¸­ç¦ç”¨å‘½åè§„èŒƒæ£€æŸ¥ï¼Œå…è®¸Vueç»„ä»¶kebab-caseåç§°
files: ['**/*.test.{js,ts}', '**/*.spec.{js,ts}'],
rules: {
  '@typescript-eslint/naming-convention': 'off'
}
```

3. **Dockerç¯å¢ƒå¼€å‘** (æ¨è):
   æŒ‰ç…§é¡¹ç›®è§„èŒƒä½¿ç”¨å®¹å™¨åŒ–ç¯å¢ƒï¼Œé¿å…æœ¬åœ°ä¾èµ–é—®é¢˜

**ä¿®å¤è®°å½•**:

- **PR #26**: æˆåŠŸåˆå¹¶åˆ°devåˆ†æ”¯ï¼Œä¿®å¤äº†ESLinté…ç½®
- **æ ¹å› ç¡®è®¤**: CIå¤±è´¥æ˜¯å› ä¸ºvue-tscé™é»˜å¤±è´¥ï¼Œä¸æ˜¯çœŸæ­£çš„é€šè¿‡
- **æœ¬åœ°éªŒè¯**: æ¸…é™¤ç¼“å­˜åTypeScriptæ£€æŸ¥é€šè¿‡
- **çŠ¶æ€**: é—®é¢˜å·²è§£å†³ï¼Œéœ€è¦è§¦å‘æ–°çš„CIéªŒè¯ä¿®å¤æ•ˆæœ

**æ—¶é—´**: 2025-09-15

## GitHub Actions CI/CD é—®é¢˜

### Q: Devåˆ†æ”¯Post Mergeå·¥ä½œæµå¤±è´¥åˆ†æ - Node.jsç‰ˆæœ¬å…¼å®¹æ€§ä¸å®¹å™¨ç¼–æ’é—®é¢˜

**é—®é¢˜æè¿°**: åœ¨Node.jsç‰ˆæœ¬ä»18å‡çº§åˆ°20çš„ä¿®å¤è¿‡ç¨‹ä¸­ï¼Œdevåˆ†æ”¯å‡ºç°2ä¸ªå·¥ä½œæµå¤±è´¥

**å¤±è´¥å·¥ä½œæµ**:

1. `Dev Branch - Medium Validation` (ID: 17799592275)
2. `Dev Branch - Optimized Post-Merge Validation` (ID: 17799592259)

**è¯¦ç»†åˆ†æ**:

#### 1. Node.jsç‰ˆæœ¬ä¿®å¤æˆåŠŸéªŒè¯ âœ…

**å‰ç«¯æ„å»ºæˆåŠŸ**:

```
vite v7.1.5 building for production...
âœ“ built in 7.50s
frontend-build-1 exited with code 0
```

**ç¯å¢ƒç¡®è®¤**:

- `NODE_VERSION: 20` - ç‰ˆæœ¬å‡çº§ç”Ÿæ•ˆ
- `MySQL 8.0.43` - æ•°æ®åº“æ­£å¸¸è¿è¡Œ
- `Django 4.2.7` - åç«¯æœåŠ¡æ­£å¸¸å¯åŠ¨

#### 2. å®é™…å¤±è´¥åŸå› åˆ†æ

**Medium Validationå¤±è´¥**:

- **E2Eæµ‹è¯•**: `Error: No tests found` - æµ‹è¯•æ–‡ä»¶è·¯å¾„é…ç½®é—®é¢˜
- **å›å½’æµ‹è¯•**: `django.db.utils.OperationalError: (1049, "Unknown database 'bravo_test'")` - æ•°æ®åº“åˆå§‹åŒ–æ—¶åºé—®é¢˜

**Optimized Post-Mergeå¤±è´¥**:

- **å®¹å™¨ç¼–æ’é—®é¢˜**: å‰ç«¯æ„å»ºå®Œæˆåç«‹å³é€€å‡º(æ­£å¸¸)ï¼Œä½†docker-composeè¯¯è®¤ä¸ºæœåŠ¡å¼‚å¸¸
- **æ—¶åºé—®é¢˜**: `frontend-build-1 exited with code 0`å¯¼è‡´æ‰€æœ‰å®¹å™¨è¢«ç»ˆæ­¢
- **é€»è¾‘é”™è¯¯**: å·¥ä½œæµå°†æˆåŠŸçš„æ„å»ºè§†ä¸ºå¤±è´¥

#### 3. æ ¹æœ¬åŸå› æ€»ç»“

1. **Node.jsä¿®å¤100%æˆåŠŸ** - `crypto.hash is not a function`é”™è¯¯å½»åº•è§£å†³
2. **å®¹å™¨ç¼–æ’é€»è¾‘ç¼ºé™·** - æ²¡æœ‰æ­£ç¡®å¤„ç†build-onlyå®¹å™¨çš„é€€å‡º
3. **æµ‹è¯•è·¯å¾„é…ç½®é”™è¯¯** - E2Eæµ‹è¯•æ‰¾ä¸åˆ°æµ‹è¯•æ–‡ä»¶
4. **æ•°æ®åº“åˆå§‹åŒ–ç«æ€** - æœåŠ¡å¯åŠ¨æ—¶æœºä¸åŒæ­¥

#### 4. é‡è¦å‘ç°

**æˆåŠŸçš„å·¥ä½œæµ** (åŒä¸€æ—¶é—´è¿è¡Œ):

- âœ… `Dev Branch - Post-Merge Validation` (1m22s)
- âœ… `Feature-Test Coverage Map` (3m1s)
- âœ… `Branch Protection` (7m56s)
- âœ… `Dev Branch - Optimized Post-Merge Validation` (10m1s) - å¦ä¸€ä¸ªå®ä¾‹

**å…³é”®è¯æ®**:

- æœ‰ä¸¤ä¸ªåŒåçš„"Optimized Post-Merge Validation"ï¼Œä¸€ä¸ªæˆåŠŸä¸€ä¸ªå¤±è´¥
- æˆåŠŸçš„å·¥ä½œæµä½¿ç”¨äº†ç›¸åŒçš„Node.js 20ç‰ˆæœ¬
- Feature-Test Coverage Mapç°åœ¨æˆåŠŸäº†(ä¹‹å‰åœ¨PRä¸­å¤±è´¥)

#### 5. Dry RunéªŒè¯æˆåŠŸ

ä½¿ç”¨ `act push --dryrun` æˆåŠŸè¯†åˆ«å‡ºï¼š

- å¤šä¸ªé‡å¤å·¥ä½œæµåŒæ—¶è§¦å‘
- Service container (MySQL)é…ç½®æ­£ç¡®
- Node.jsç‰ˆæœ¬å‡çº§å·²åº”ç”¨

**è§£å†³æ–¹æ¡ˆå»ºè®®**:

1. **å®¹å™¨ç¼–æ’ä¿®å¤**:

   - è°ƒæ•´docker-compose.ymlä¸­å‰ç«¯æ„å»ºæœåŠ¡çš„restartç­–ç•¥
   - æ·»åŠ depends_onå’Œå¥åº·æ£€æŸ¥é…ç½®

2. **æµ‹è¯•è·¯å¾„ä¿®å¤**:

   - æ£€æŸ¥E2Eæµ‹è¯•æ–‡ä»¶è·¯å¾„é…ç½®
   - ç»Ÿä¸€æµ‹è¯•å‘ç°æœºåˆ¶

3. **å·¥ä½œæµä¼˜åŒ–**:
   - å‡å°‘é‡å¤å·¥ä½œæµï¼Œé¿å…èµ„æºæµªè´¹
   - æ”¹è¿›çŠ¶æ€åˆ¤æ–­é€»è¾‘ï¼ŒåŒºåˆ†æ„å»ºæˆåŠŸå’ŒæœåŠ¡è¿è¡Œ

**éªŒè¯ç»“æœ**:

- âœ… Node.jsç‰ˆæœ¬é—®é¢˜å®Œå…¨è§£å†³
- âœ… ä¸»è¦åŠŸèƒ½å·¥ä½œæµé€šè¿‡
- âš ï¸ éœ€è¦ä¼˜åŒ–å®¹å™¨ç¼–æ’å’Œæµ‹è¯•é…ç½®

**æ—¶é—´**: 2025-09-17

## npm workspacesä¾èµ–é—®é¢˜

### Q: GitHub Actionsä¸­E2Eæµ‹è¯•å‡ºç°`Cannot find module '@playwright/test'`é”™è¯¯ï¼Œä½†package.jsonä¸­æœ‰è¯¥ä¾èµ–ï¼Œæœ¬åœ°ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œï¼Ÿ

#### é—®é¢˜ç°è±¡

- âœ… æ ¹ç›®å½•package.jsonä¸­åŒ…å«`@playwright/test`ä¾èµ–
- âœ… æœ¬åœ°Dockerç¯å¢ƒè¿è¡Œæ­£å¸¸
- âŒ GitHub Actionsä¸­E2Eæµ‹è¯•å¤±è´¥ï¼š`ERR_MODULE_NOT_FOUND: Cannot find package '@playwright/test'`
- âŒ `npm list @playwright/test`æ˜¾ç¤º`â””â”€â”€ (empty)`

#### æ ¹æœ¬åŸå›  (æ¶æ„çº§æ·±åº¦æ´å¯Ÿ)

**npm workspacesä¾èµ–ç®¡ç†å†²çªçš„æŠ€æœ¯æœ¬è´¨**ï¼š

è¿™æ˜¯npm workspacesçš„**å›ºæœ‰è¡Œä¸ºç‰¹æ€§**ï¼Œä¸æ˜¯é…ç½®é—®é¢˜ï¼

1. **npm workspacesè®¾è®¡åŸåˆ™**: åªåº”åœ¨æ ¹ç›®å½•è¿è¡Œä¾èµ–ç®¡ç†å‘½ä»¤
2. **ç ´åæœºåˆ¶**: ä»»ä½•å­ç›®å½•çš„`npm ci`éƒ½ä¼šé‡æ–°è¯„ä¼°æ•´ä¸ªworkspaceä¾èµ–æ ‘
3. **å…¨å±€è§†è§’å†²çª**: npmåŸºäºå½“å‰æ„ŸçŸ¥éœ€æ±‚é‡æ–°åˆ†é…ä¾èµ–ä½ç½®
4. **dedupedæœºåˆ¶ç ´å**: å¯¼è‡´å…±äº«ä¾èµ–è¢«é”™è¯¯ç§»é™¤æˆ–é‡æ–°å®šä½

#### æŠ€æœ¯åŸç† (æ·±å±‚æœºåˆ¶è§£æ)

```bash
# æ­£å¸¸çŠ¶æ€ï¼ˆæ ¹ç›®å½•npm ciåï¼‰
bravo-workspace@1.0.0
â”œâ”€â”€ @playwright/test@1.55.0          # æ ¹ç›®å½•å®‰è£…ï¼Œä¾›å…¨å±€å…±äº«
â””â”€â”¬ bravo-e2e-tests@1.0.0 -> ./e2e
  â””â”€â”€ @playwright/test@1.55.0 deduped # é€šè¿‡dedupedæœºåˆ¶å…±äº«

# frontend npm ci è§¦å‘çš„ç ´åè¿‡ç¨‹
cd frontend && npm ci               # âš ï¸ é‡æ–°è¯„ä¼°æ•´ä¸ªworkspace
# â†’ npmå‘ç°@playwright/teståªè¢«e2eéœ€è¦ï¼Œfrontendä¸éœ€è¦
# â†’ å†³å®šå°†@playwright/testä»æ ¹ç›®å½•ç§»é™¤
# â†’ ç ´åå·²å»ºç«‹çš„dedupedå…±äº«æœºåˆ¶

# ç ´ååçš„çŠ¶æ€
bravo-workspace@1.0.0
â””â”€â”€ (empty)                         # @playwright/testè¢«å®Œå…¨åˆ é™¤ï¼
cd .. && npm list @playwright/test  # âŒ æ˜¾ç¤º â””â”€â”€ (empty)
```

**ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿï¼Ÿ**

- npm workspacesä½¿ç”¨**å…¨å±€è§†è§’**ç®¡ç†æ‰€æœ‰ä¾èµ–
- å­ç›®å½•çš„`npm ci`è§¦å‘**å…¨å±€é‡æ–°è®¡ç®—**
- npmå¯èƒ½è®¤ä¸ºæŸäº›ä¾èµ–ä¸å†éœ€è¦dedupedå…±äº«
- å¯¼è‡´å…³é”®ä¾èµ–è¢«**æ„å¤–åˆ é™¤**

**å…³é”®çº¿ç´¢**ï¼š`npm list`è¾“å‡ºä¸­çš„`deduped`æ ‡è®°è¡¨ç¤ºä¾èµ–è¢«å»é‡å¤„ç†ï¼Œè¿™æ˜¯é—®é¢˜çš„æ ¹æºä¿¡å·

#### è§£å†³æ–¹æ¡ˆ (æ¶æ„çº§æ ¹æœ¬ä¿®å¤)

**âœ… æ­£ç¡®çš„æ¶æ„è®¾è®¡åŸåˆ™**ï¼š

1. **ä¸¥æ ¼éµå¾ªnpm workspacesè®¾è®¡åŸç†**ï¼š

   ```bash
   # âœ… æ­£ç¡®åšæ³•ï¼šåªåœ¨æ ¹ç›®å½•è¿è¡Œä¾èµ–ç®¡ç†
   npm ci --prefer-offline --no-audit  # å®‰è£…æ‰€æœ‰workspaceä¾èµ–

   # âœ… æ„å»ºæ—¶ä¸é‡æ–°å®‰è£…ä¾èµ–
   cd frontend && npm run build        # åªæ„å»ºï¼Œä¸å®‰è£…
   cd e2e && npm run test              # åªæµ‹è¯•ï¼Œä¸å®‰è£…
   ```

2. **CIå·¥ä½œæµä¿®å¤**ï¼š

   ```yaml
   # âŒ é”™è¯¯åšæ³•ï¼ˆä¼šç ´åworkspaceç»“æ„ï¼‰
   - name: Install Frontend Dependencies
     run: cd frontend && npm ci

   # âœ… æ­£ç¡®åšæ³•ï¼ˆä½¿ç”¨workspaceä¾èµ–ç®¡ç†ï¼‰
   - name: Install All Dependencies
     run: npm ci --prefer-offline --no-audit # æ ¹ç›®å½•ç»Ÿä¸€ç®¡ç†
   ```

3. **ä¾èµ–æ¶æ„è°ƒæ•´**ï¼š
   - ä¿æŒ@playwright/teståœ¨æ ¹ç›®å½•ï¼ˆæ­£ç¡®çš„å…±äº«ä½ç½®ï¼‰
   - å®Œå…¨ç§»é™¤æ‰€æœ‰å­ç›®å½•çš„ç‹¬ç«‹npm ciè°ƒç”¨
   - ä¾æ‰˜npm workspacesçš„è‡ªåŠ¨ä¾èµ–ç®¡ç†

**ğŸš« åºŸå¼ƒçš„ä¸´æ—¶æ–¹æ¡ˆï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰**ï¼š

```yaml
# âŒ è¿‡æ—¶çš„è¡¥ä¸ä¿®å¤
npm install @playwright/test@^1.55.0 --no-save # ä¸å†éœ€è¦æ­¤ç±»è¡¥ä¸
```

#### é¢„é˜²æªæ–½

1. **ç›‘æ§ä¾èµ–æ ‘å˜åŒ–**ï¼šåœ¨å…³é”®æ­¥éª¤åæ£€æŸ¥`npm list`è¾“å‡º
2. **æœ¬åœ°å®Œæ•´éªŒè¯**ï¼šä½¿ç”¨actå·¥å…·æ¨¡æ‹Ÿå®Œæ•´çš„GitHub Actionsæµç¨‹
3. **æ³¨æ„workspacesäº¤äº’**ï¼šç†è§£workspaceå­ç›®å½•æ“ä½œå¯¹æ ¹ç›®å½•çš„å½±å“

#### è°ƒè¯•æŠ€å·§

- **å…³é”®è¯æ•æ„Ÿåº¦**ï¼šæ³¨æ„æ—¥å¿—ä¸­çš„`deduped`ã€`empty`ç­‰å…³é”®ä¿¡æ¯
- **é€æ­¥éªŒè¯**ï¼šæ¨¡æ‹Ÿæ¯ä¸ªCIæ­¥éª¤ï¼Œæ£€æŸ¥ä¾èµ–çŠ¶æ€å˜åŒ–
- **å·¥å…·ç»„åˆ**ï¼šç»“åˆæœ¬åœ°Dockerå’Œactå·¥å…·è¿›è¡Œå¤šç»´éªŒè¯

**è§£å†³æ—¶é—´**: 13è½®ä¿®å¤åæˆåŠŸ (2025-09-22)
**æˆåŠŸç‡**: 100% (æ‰€æœ‰GitHub Actionsæµ‹è¯•é€šè¿‡)
**å…³é”®è´¡çŒ®**: ç”¨æˆ·æ•é”è§‚å¯Ÿ"deduped"å…³é”®è¯ç›´æ¥å®šä½é—®é¢˜æ ¹å› 
