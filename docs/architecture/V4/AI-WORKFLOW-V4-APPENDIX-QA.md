# APPENDIX: æ ¸å¿ƒé—®é¢˜Q&Aæ˜ å°„

> **ç‰ˆæœ¬**: V4.0
> **ä¸»é¢˜**: 26ä¸ªæ ¸å¿ƒé—®é¢˜çš„è¯¦ç»†è§£ç­”
> **å®šä½**: ç›´æ¥å›ç­”ç”¨æˆ·æå‡ºçš„æ‰€æœ‰å…³é”®é—®é¢˜ï¼Œæ˜ å°„åˆ°V4è®¾è®¡æ–¹æ¡ˆ

---

## é—®é¢˜ç´¢å¼•

### ä»»åŠ¡ç®¡ç†ç›¸å…³ (Q1-Q9)

- [Q1: Task-Masterä»»åŠ¡å‘½åè§„èŒƒ](#q1-task-masterä»»åŠ¡å‘½åè§„èŒƒ)
- [Q2: Task-Masterä»»åŠ¡ç®¡ç†çš„ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç”Ÿæˆ](#q2-task-masterä»»åŠ¡ç®¡ç†çš„ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç”Ÿæˆ)
- [Q3: æµ‹è¯•æ–‡ä»¶ç›®å½•å±‚çº§å’Œç±»å‹çš„å¼ºåˆ¶æ£€æŸ¥](#q3-æµ‹è¯•æ–‡ä»¶ç›®å½•å±‚çº§å’Œç±»å‹çš„å¼ºåˆ¶æ£€æŸ¥)
- [Q4: Task-Masterä½œä¸ºç®¡å®¶vs Cursorä½œä¸ºå·¥äºº](#q4-task-masterä½œä¸ºç®¡å®¶vs-cursorä½œä¸ºå·¥äºº)
- [Q5: Cursorç²¾åŒ–PRD vs Task-Masterè§£æPRD](#q5-cursorç²¾åŒ–prd-vs-task-masterè§£æprd)
- [Q6: ä»»åŠ¡ç»†åŒ–ä¸å­ä»»åŠ¡ç®¡ç†](#q6-ä»»åŠ¡ç»†åŒ–ä¸å­ä»»åŠ¡ç®¡ç†)
- [Q7: å¤šä¸ªPRDå¯¹åº”ä¸€ä¸ªä»£ç æ–‡ä»¶ vs åŸå­ä»£ç å®ç°](#q7-å¤šä¸ªprdå¯¹åº”ä¸€ä¸ªä»£ç æ–‡ä»¶-vs-åŸå­ä»£ç å®ç°)
- [Q8: æäº¤é¢‘ç‡ä¸ä»»åŠ¡å®Œæˆå…³è”](#q8-æäº¤é¢‘ç‡ä¸ä»»åŠ¡å®Œæˆå…³è”)
- [Q9: è·¨ç”µè„‘åä½œçš„Task-Masterä»»åŠ¡ç®¡ç†](#q9-è·¨ç”µè„‘åä½œçš„task-masterä»»åŠ¡ç®¡ç†)

### Bugä¿®å¤ä¸éœ€æ±‚å˜æ›´ (Q10-Q13)

- [Q10: Bugä¿®å¤å¦‚ä½•æ›´æ–°Task-ID](#q10-bugä¿®å¤å¦‚ä½•æ›´æ–°task-id)
- [Q11: PRDå…ƒæ•°æ®åœ¨ä»»åŠ¡åˆ›å»ºå‰å¦‚ä½•å¼ºåˆ¶æ‰§è¡Œ](#q11-prdå…ƒæ•°æ®åœ¨ä»»åŠ¡åˆ›å»ºå‰å¦‚ä½•å¼ºåˆ¶æ‰§è¡Œ)
- [Q12: PRDå†…å®¹è¦æ±‚ï¼ˆæ•°æ®åº“ã€Redisè®¾è®¡ï¼‰](#q12-prdå†…å®¹è¦æ±‚æ•°æ®åº“redisè®¾è®¡)
- [Q13: PRDå‘½åè§„èŒƒçš„å¯æ‰©å±•æ€§](#q13-prdå‘½åè§„èŒƒçš„å¯æ‰©å±•æ€§)

### æµ‹è¯•ä¸å¼€å‘ (Q14-Q20)

- [Q14: PRDå¯¹å‰ç«¯å¼€å‘çš„ç»†èŠ‚è¦æ±‚](#q14-prdå¯¹å‰ç«¯å¼€å‘çš„ç»†èŠ‚è¦æ±‚)
- [Q15: PRDã€ä»»åŠ¡åˆ—è¡¨ã€ä»»åŠ¡æ–‡ä»¶çš„åˆ é™¤ä¿æŠ¤](#q15-prdä»»åŠ¡åˆ—è¡¨ä»»åŠ¡æ–‡ä»¶çš„åˆ é™¤ä¿æŠ¤)
- [Q16: PRDä¿®æ”¹ç­–ç•¥ï¼ˆå¤šæ¬¡æäº¤ã€å¤šPRDï¼‰](#q16-prdä¿®æ”¹ç­–ç•¥å¤šæ¬¡æäº¤å¤šprd)
- [Q17: æµç¨‹ä¼˜åŒ–ä»»åŠ¡å¦‚ä½•é€‚ç”¨å·¥ä½œæµ](#q17-æµç¨‹ä¼˜åŒ–ä»»åŠ¡å¦‚ä½•é€‚ç”¨å·¥ä½œæµ)
- [Q18: Task-Masterè‡ªæ£€ä¸æµ‹è¯•æ–‡ä»¶éªŒè¯](#q18-task-masterè‡ªæ£€ä¸æµ‹è¯•æ–‡ä»¶éªŒè¯)
- [Q19: é˜²æ­¢Cursorä¿®æ”¹/è·³è¿‡æµ‹è¯•æ–‡ä»¶](#q19-é˜²æ­¢cursorä¿®æ”¹è·³è¿‡æµ‹è¯•æ–‡ä»¶)
- [Q20: APIå¥‘çº¦é©±åŠ¨å¹¶è¡Œå¼€å‘](#q20-apiå¥‘çº¦é©±åŠ¨å¹¶è¡Œå¼€å‘)

### è´¨é‡ä¿éšœ (Q21-Q26)

- [Q21: æ‹¦æˆªCursorç®€åŒ–/åˆ é™¤åŠŸèƒ½çš„ä¼ªBugä¿®å¤](#q21-æ‹¦æˆªcursorç®€åŒ–åˆ é™¤åŠŸèƒ½çš„ä¼ªbugä¿®å¤)
- [Q22: Debugä»»åŠ¡åœ¨Task-Masterä¸­çš„ç®¡ç†](#q22-debugä»»åŠ¡åœ¨task-masterä¸­çš„ç®¡ç†)
- [Q23: è‡ªåŠ¨å›æ»šæœªæˆæƒçš„åŠŸèƒ½åˆ é™¤](#q23-è‡ªåŠ¨å›æ»šæœªæˆæƒçš„åŠŸèƒ½åˆ é™¤)
- [Q24: ç¡®ä¿Cursoråœ¨Bugä¿®å¤æ—¶éµå¾ªPRDé€»è¾‘](#q24-ç¡®ä¿cursoråœ¨bugä¿®å¤æ—¶éµå¾ªprdé€»è¾‘)
- [Q25: ä»£ç æ–‡ä»¶ä¸æµ‹è¯•æ–‡ä»¶çš„TDDå…³è”](#q25-ä»£ç æ–‡ä»¶ä¸æµ‹è¯•æ–‡ä»¶çš„tddå…³è”)
- [Q26: Post-commit Hookçš„å®ç°](#q26-post-commit-hookçš„å®ç°)

---

## Q1: Task-Masterä»»åŠ¡å‘½åè§„èŒƒ

**é—®é¢˜**: Task-Masterç”Ÿæˆçš„ä»»åŠ¡å¦‚ä½•å‘½åï¼Ÿæ˜¯å¦æœ‰ç»Ÿä¸€çš„å‘½åè§„èŒƒï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **ä¸‰å±‚å‘½åä½“ç³»**

### ç¬¬ä¸€å±‚: REQ-ID

**æ ¼å¼**: `REQ-{YEAR}-{NUMBER}-{SLUG}`

- **ç¤ºä¾‹**: `REQ-2025-001-user-login`
- **å¯æ‰©å±•**: æ”¯æŒæŒ‰å¹´ä»½ã€æŒ‰æ¨¡å—å‰ç¼€ã€æŒ‰ä¼˜å…ˆçº§

### ç¬¬äºŒå±‚: Task-ID

**æ ¼å¼**: `task-{NUMBER}-{SLUG}`

- **Task-0**: å¼ºåˆ¶çš„è‡ªæ£€ä»»åŠ¡ï¼ˆ`task-0-self-check`ï¼‰
- **Task-1+**: åŠŸèƒ½ä»»åŠ¡ï¼ˆ`task-1-implement-backend-api`ï¼‰
- **è‡ªåŠ¨ç”Ÿæˆ**: é€‚é…å±‚æ ¹æ®Task-Masterè¾“å‡ºç”Ÿæˆ

### ç¬¬ä¸‰å±‚: Subtask-ID

**æ ¼å¼**: `subtask-{NUMBER}-{SLUG}`

- **ç¤ºä¾‹**: `subtask-1-create-user-model`
- **è‡ªåŠ¨æ¨æ–­**: é€‚é…å±‚æ ¹æ®ä»»åŠ¡ç±»å‹æ¨æ–­

**æ–‡æ¡£å‚è€ƒ**:

- [PART1-ç›®å½•ç»“æ„è§„èŒƒ](./AI-WORKFLOW-V4-PART1-ARCH.md#32-ç›®å½•å‘½åè§„èŒƒ)
- [PART2-ä¸‰å±‚ä»»åŠ¡ç®¡ç†](./AI-WORKFLOW-V4-PART2-TM-ADAPTER.md#3-ä¸‰å±‚ä»»åŠ¡ç®¡ç†è®¾è®¡)

---

## Q2: Task-Masterä»»åŠ¡ç®¡ç†çš„ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç”Ÿæˆ

**é—®é¢˜**: Task-Masterç”Ÿæˆtasks.jsonå’Œtask.mdï¼Œç›®å½•ç»“æ„å¦‚ä½•ç»„ç»‡ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **é€‚é…å±‚è½¬æ¢ä¸ºä¸‰å±‚ç»“æ„**

### åŸå§‹è¾“å‡ºï¼ˆTask-Masterï¼‰

```
.taskmaster/tasks/REQ-2025-001/tasks.json  # æ‰å¹³JSON
```

### é€‚é…å±‚è½¬æ¢å

```
.taskmaster/tasks/REQ-2025-001/
â”œâ”€â”€ tasks.json (å¢å¼ºç‰ˆ)
â”œâ”€â”€ task-0-self-check/
â”‚   â”œâ”€â”€ task.md
â”‚   â”œâ”€â”€ subtask-1-validate-prd.md
â”‚   â”œâ”€â”€ subtask-2-check-dirs.md
â”‚   â””â”€â”€ subtask-3-verify-api.md
â”œâ”€â”€ task-1-implement-backend-api/
â”‚   â”œâ”€â”€ task.md
â”‚   â”œâ”€â”€ subtask-1-create-models.md
â”‚   â”œâ”€â”€ subtask-2-implement-views.md
â”‚   â””â”€â”€ subtask-3-write-tests.md
â””â”€â”€ task-2-implement-frontend-ui/
    â””â”€â”€ ...
```

### æ–‡ä»¶ç”Ÿæˆæµç¨‹

1. **Task-Masterç”Ÿæˆ**: æ‰å¹³`tasks.json`
2. **é€‚é…å±‚å¤„ç†**: `python scripts/task-master/adapter.py REQ-ID`
3. **è‡ªåŠ¨ç”Ÿæˆ**:
   - Task-0è‡ªæ£€ä»»åŠ¡
   - ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºç›®å½•
   - ç”Ÿæˆ`task.md`ï¼ˆä»»åŠ¡ä¸»æ–‡ä»¶ï¼‰
   - æ¨æ–­å¹¶ç”Ÿæˆ`subtask-X.md`ï¼ˆå­ä»»åŠ¡æ–‡ä»¶ï¼‰

**æ–‡æ¡£å‚è€ƒ**:

- [PART2-é€‚é…å±‚å®ç°è¯¦è§£](./AI-WORKFLOW-V4-PART2-TM-ADAPTER.md#5-é€‚é…å±‚å®ç°è¯¦è§£)
- [PART6-Task-Masteré€‚é…å±‚å®Œæ•´å®ç°](./AI-WORKFLOW-V4-PART6-IMPL.md#4-task-masteré€‚é…å±‚å®Œæ•´å®ç°)

---

## Q3: æµ‹è¯•æ–‡ä»¶ç›®å½•å±‚çº§å’Œç±»å‹çš„å¼ºåˆ¶æ£€æŸ¥

**é—®é¢˜**: å¦‚ä½•å¼ºåˆ¶æ£€æŸ¥æµ‹è¯•æ–‡ä»¶çš„ç›®å½•å±‚çº§ï¼ˆunit/integration/e2e/regressionï¼‰ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **Pre-commit Hook + åˆè§„å¼•æ“å¼ºåˆ¶éªŒè¯**

### å¼ºåˆ¶ç›®å½•ç»“æ„

```
backend/tests/
â”œâ”€â”€ unit/           â† å•å…ƒæµ‹è¯•
â”œâ”€â”€ integration/    â† é›†æˆæµ‹è¯•
â”œâ”€â”€ regression/     â† å›å½’æµ‹è¯•
â””â”€â”€ fixtures/       â† æµ‹è¯•æ•°æ®

e2e/tests/
â”œâ”€â”€ smoke/          â† å†’çƒŸæµ‹è¯•
â”œâ”€â”€ regression/     â† å›å½’æµ‹è¯•
â””â”€â”€ performance/    â† æ€§èƒ½æµ‹è¯•
```

### æ£€æŸ¥æœºåˆ¶

**Pre-commit Hookæ£€æŸ¥**:

```python
# .compliance/checkers/test_checker.py

def check_test_directory(test_file):
    # åç«¯æµ‹è¯•å¿…é¡»åœ¨æŒ‡å®šç›®å½•
    if test_file.startswith('backend/tests/'):
        valid_dirs = ['unit/', 'integration/', 'regression/', 'fixtures/']
        parent_dir = test_file.split('/')[2] + '/'

        if parent_dir not in valid_dirs:
            raise ComplianceError(
                f"åç«¯æµ‹è¯•æ–‡ä»¶å¿…é¡»åœ¨ä»¥ä¸‹ç›®å½•ä¹‹ä¸€: {valid_dirs}"
            )

    # E2Eæµ‹è¯•å¿…é¡»åœ¨e2e/tests/
    if test_file.endswith('.spec.ts') and not test_file.startswith('e2e/tests/'):
        raise ComplianceError("E2Eæµ‹è¯•æ–‡ä»¶å¿…é¡»åœ¨ e2e/tests/ ç›®å½•")

    # å‘½åæ£€æŸ¥
    if test_file.endswith('.py') and not os.path.basename(test_file).startswith('test_'):
        raise ComplianceError("Pythonæµ‹è¯•æ–‡ä»¶å¿…é¡»ä»¥ test_ å¼€å¤´")
```

**CI/CDäºŒæ¬¡éªŒè¯**: é‡æ–°æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥ï¼Œæ— æ³•ç»•è¿‡

**æ–‡æ¡£å‚è€ƒ**:

- [PART4-æµ‹è¯•ç›®å½•å¼ºåˆ¶è§„èŒƒ](./AI-WORKFLOW-V4-PART4-TDD-TEST.md#3-æµ‹è¯•ç›®å½•å¼ºåˆ¶è§„èŒƒ)
- [PART5-Pre-commit Hook](./AI-WORKFLOW-V4-PART5-COMPLIANCE.md#3-ç¬¬ä¸€é“é˜²çº¿pre-commit-hook)

---

## Q4: Task-Masterä½œä¸ºç®¡å®¶vs Cursorä½œä¸ºå·¥äºº

**é—®é¢˜**: Task-Masterä½œä¸º"ç®¡å®¶"ï¼ŒCursorä½œä¸º"å·¥äºº"ï¼Œå¦‚ä½•ä½“ç°è¿™ç§è§’è‰²åˆ†å·¥ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **æ˜ç¡®çš„èŒè´£è¾¹ç•Œ**

### Task-Masterï¼ˆç®¡å®¶ï¼‰

**èŒè´£**:

1. **è§£æPRD**: ä»ç²¾åŒ–åçš„PRDä¸­æå–ä»»åŠ¡
2. **ç”Ÿæˆä»»åŠ¡åˆ—è¡¨**: åˆ›å»º`tasks.json`
3. **ç›‘ç£è¿›åº¦**: è·Ÿè¸ªä»»åŠ¡çŠ¶æ€ï¼ˆé€šè¿‡`sync_status.py`ï¼‰
4. **éªŒè¯å®Œæˆåº¦**: æ£€æŸ¥æµ‹è¯•ã€ä»£ç ã€æäº¤æ˜¯å¦å®Œæ•´

**ä¸åš**:

- ä¸ç›´æ¥ç¼–å†™ä»£ç 
- ä¸ç›´æ¥ç¼–å†™æµ‹è¯•
- ä¸ä¿®æ”¹PRD

### Cursorï¼ˆå·¥äººï¼‰

**èŒè´£**:

1. **ç²¾åŒ–PRD**: è¡¥å……æŠ€æœ¯ç»†èŠ‚ï¼ˆæ•°æ®åº“ã€Redisã€APIã€æµ‹è¯•ç”¨ä¾‹ï¼‰
2. **æ‰§è¡Œä»»åŠ¡**: æ ¹æ®Task-Masteråˆ†é…çš„ä»»åŠ¡ç¼–å†™ä»£ç 
3. **ç¼–å†™æµ‹è¯•**: TDDçº¢-ç»¿-é‡æ„
4. **æäº¤ä»£ç **: éµå¾ªæäº¤è§„èŒƒ

**ä¸èƒ½**:

- ä¸èƒ½ç»•è¿‡Task-Masterç›´æ¥å¼€å§‹å®ç°
- ä¸èƒ½è·³è¿‡æµ‹è¯•
- ä¸èƒ½åˆ é™¤PRDåŠŸèƒ½ï¼ˆé™¤éå…ˆä¿®æ”¹PRDï¼‰

### åä½œæµç¨‹

```
äººç±»: æå‡ºæ¨¡ç³Šéœ€æ±‚
  â†“
Cursor: ç²¾åŒ–PRDï¼ˆè¡¥å……æŠ€æœ¯ç»†èŠ‚ï¼‰
  â†“
Task-Master: è§£æPRD â†’ ç”Ÿæˆtasks.json
  â†“
é€‚é…å±‚: è½¬æ¢ä¸ºä¸‰å±‚ç»“æ„
  â†“
Cursor: æ‰§è¡ŒTask-0è‡ªæ£€
  â†“
Task-Master: éªŒè¯è‡ªæ£€é€šè¿‡
  â†“
Cursor: æ‰§è¡ŒTask-1, 2, 3...
  â†“
Task-Master: ç›‘ç£è¿›åº¦ï¼ŒéªŒè¯å®Œæˆåº¦
  â†“
æ‰€æœ‰ä»»åŠ¡å®Œæˆ â†’ æ ‡è®°PRDä¸ºcompleted
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART1-AIè§’è‰²åˆ†å·¥ä½“ç³»](./AI-WORKFLOW-V4-PART1-ARCH.md#4-aiè§’è‰²åˆ†å·¥ä½“ç³»)
- [PART2-è§’è‰²å®šä½](./AI-WORKFLOW-V4-PART2-TM-ADAPTER.md#13-è§’è‰²å®šä½)

---

## Q5: Cursorç²¾åŒ–PRD vs Task-Masterè§£æPRD

**é—®é¢˜**: ä¸ºä»€ä¹ˆä¸è®©Task-Masterç›´æ¥è§£æäººç±»çš„æ¨¡ç³Šéœ€æ±‚ï¼ŸCursorç²¾åŒ–PRDçš„èŒè´£æ˜¯ä»€ä¹ˆï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **ä¸Šä¸‹æ–‡æ„ŸçŸ¥ vs ç‹¬ç«‹è§£æ**

### Task-Masterçš„å±€é™æ€§

1. **æ— é¡¹ç›®ä¸Šä¸‹æ–‡**: Task-Masteræ˜¯ç‹¬ç«‹CLIå·¥å…·ï¼Œä¸äº†è§£é¡¹ç›®æ¶æ„ã€ç°æœ‰ä»£ç ã€ä¾èµ–å…³ç³»
2. **æ— æ„ŸçŸ¥èƒ½åŠ›**: æ— æ³•æ¨æ–­æ•°æ®åº“è®¾è®¡ã€Redisç­–ç•¥ã€APIæ¥å£
3. **é€šç”¨æ€§å¯¼å‘**: è®¾è®¡ä¸ºé€šç”¨å·¥å…·ï¼Œä¸é’ˆå¯¹ç‰¹å®šé¡¹ç›®

### Cursorç²¾åŒ–PRDçš„ä¼˜åŠ¿

1. **é¡¹ç›®ä¸Šä¸‹æ–‡**: åœ¨é¡¹ç›®ä¸­è¿è¡Œï¼Œäº†è§£ä»£ç åº“ç»“æ„
2. **æŠ€æœ¯æ¨æ–­**: å¯ä»¥æ ¹æ®ç°æœ‰ä»£ç æ¨æ–­æŠ€æœ¯æ–¹æ¡ˆ
3. **å†å²å­¦ä¹ **: åˆ†æå†å²PRDï¼Œä¼˜åŒ–æ–°PRDç»“æ„

### Cursorç²¾åŒ–çš„å…·ä½“å†…å®¹

```markdown
äººç±»åŸå§‹éœ€æ±‚:
"å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼Œæ”¯æŒé‚®ç®±å’Œå¯†ç ç™»å½•"

â†“ Cursorç²¾åŒ–å â†“

---

req_id: REQ-2025-001-user-login
test_files: # â† Cursoræ¨æ–­

- backend/tests/unit/test_user_login.py
- backend/tests/integration/test_user_authentication.py
- e2e/tests/test-user-login.spec.ts
  implementation_files: # â† Cursoræ¨æ–­
- backend/apps/users/models.py
- backend/apps/users/views.py
- frontend/src/views/LoginView.vue
  api_contract: docs/01_guideline/api-contracts/REQ-2025-001/api.yaml

---

# æ•°æ®åº“è®¾è®¡ï¼ˆCursorè¡¥å……ï¼‰

| å­—æ®µ  | ç±»å‹         | è¯´æ˜ | ç´¢å¼•    |
| ----- | ------------ | ---- | ------- |
| id    | BigInt       | ä¸»é”® | PRIMARY |
| email | VARCHAR(255) | é‚®ç®± | UNIQUE  |

...

# Redisç¼“å­˜ç­–ç•¥ï¼ˆCursorè¡¥å……ï¼‰

- Key: login:attempts:{email}
- TTL: 15åˆ†é’Ÿ
  ...

# APIæ¥å£å®šä¹‰ï¼ˆCursorè¡¥å……ï¼‰

POST /api/auth/login
Request: {email, password, remember_me}
Response: {token, user}
...

# æµ‹è¯•ç”¨ä¾‹ï¼ˆCursorè¡¥å……ï¼‰

- test_login_success
- test_login_invalid_email
- test_login_rate_limit
  ...

# å‰ç«¯UI/UXï¼ˆCursorè¡¥å……ï¼‰

- LoginView.vue
  - EmailInputç»„ä»¶
  - PasswordInputç»„ä»¶
  - RememberMeCheckboxç»„ä»¶
    ...
```

### å·¥ä½œæµ

```
äººç±»æ¨¡ç³Šéœ€æ±‚ â†’ Cursorç²¾åŒ–PRD â†’ Task-Masterè§£æç²¾åŒ–PRD â†’ ç”Ÿæˆè¯¦ç»†ä»»åŠ¡
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART1-Cursorç²¾åŒ–PRDçš„èŒè´£](./AI-WORKFLOW-V4-PART1-ARCH.md#12-task-masterä½œä¸ºä»»åŠ¡ç®¡å®¶)
- [PART1-PRDç²¾åŒ–æµç¨‹è¯¦è§£](./AI-WORKFLOW-V4-PART1-ARCH.md#52-prdç²¾åŒ–æµç¨‹è¯¦è§£)

---

## Q6: ä»»åŠ¡ç»†åŒ–ä¸å­ä»»åŠ¡ç®¡ç†

**é—®é¢˜**: å¦‚ä½•ç¡®ä¿Task-MasteræŒ‰ç…§ä¸‰å±‚ç»“æ„æ‰§è¡Œï¼Ÿå¦‚ä½•ç®¡ç†å­ä»»åŠ¡ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **Task-Master AIç”Ÿæˆå­ä»»åŠ¡ + é€‚é…å±‚å¢å¼º**

### Task-Masterçš„å­ä»»åŠ¡ç”Ÿæˆ

Task-Masteré€šè¿‡AIé©±åŠ¨çš„`expand`å‘½ä»¤è‡ªåŠ¨ç”Ÿæˆå­ä»»åŠ¡ï¼š

**æ­¥éª¤1**: è§£æPRDç”Ÿæˆä¸»ä»»åŠ¡

```bash
task-master parse-prd --input=PRD.md
```

è¾“å‡ºï¼š

```json
{
  "tasks": [
    {
      "id": 1,
      "title": "Implement backend API",
      "description": "...",
      "subtasks": []
    },
    {
      "id": 2,
      "title": "Implement frontend UI",
      "description": "...",
      "subtasks": []
    }
  ]
}
```

**æ­¥éª¤2**: AIåˆ†æå¤æ‚åº¦å¹¶å±•å¼€ä¸ºå­ä»»åŠ¡

```bash
task-master analyze-complexity --threshold=5
task-master expand --all --research
```

è¾“å‡ºï¼ˆAIè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼š

```json
{
  "tasks": [
    {
      "id": 1,
      "title": "Implement backend API",
      "subtasks": [
        {
          "id": 1,
          "title": "Create database models",
          "description": "Design User model..."
        },
        {
          "id": 2,
          "title": "Implement API views",
          "description": "Create login/logout views..."
        },
        {
          "id": 3,
          "title": "Create serializers",
          "description": "Implement validation..."
        },
        {
          "id": 4,
          "title": "Write unit tests",
          "description": "Test models and views..."
        },
        {
          "id": 5,
          "title": "Write integration tests",
          "description": "Test API endpoints..."
        }
      ]
    }
  ]
}
```

### é€‚é…å±‚çš„çœŸå®ä½œç”¨

é€‚é…å±‚**ä¸ç”Ÿæˆå­ä»»åŠ¡**ï¼Œè€Œæ˜¯ä¸ºTask-Masterç”Ÿæˆçš„å­ä»»åŠ¡æ·»åŠ é¡¹ç›®é›†æˆä¿¡æ¯ï¼š

1. **æ·»åŠ Task-0**: æ³¨å…¥è‡ªæ£€ä»»åŠ¡ï¼ˆTask-Masterä¸ä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰
2. **æ–‡ä»¶å…³è”**: ä¸ºæ¯ä¸ªå­ä»»åŠ¡å…³è”æµ‹è¯•æ–‡ä»¶å’Œä»£ç æ–‡ä»¶è·¯å¾„
3. **ç›®å½•ç»„ç»‡**: åˆ›å»ºä¸‰å±‚ç›®å½•ç»“æ„
4. **PRDé“¾æ¥**: å…³è”å­ä»»åŠ¡åˆ°PRDå…·ä½“ç« èŠ‚

**é€‚é…å±‚å¢å¼ºç¤ºä¾‹**:

```json
{
  "id": 1,
  "title": "Create database models",
  "test_files": ["backend/tests/unit/test_users_model.py"],
  "implementation_files": ["backend/apps/users/models.py"],
  "prd_section": "#database-design"
}
```

### å­ä»»åŠ¡ç®¡ç†

1. **AIç”Ÿæˆ**: Task-Masteré€šè¿‡`expand`å‘½ä»¤AIç”Ÿæˆå­ä»»åŠ¡
2. **ç‹¬ç«‹æ–‡ä»¶**: é€‚é…å±‚ä¸ºæ¯ä¸ªå­ä»»åŠ¡ç”Ÿæˆ`subtask-X.md`
3. **çŠ¶æ€è·Ÿè¸ª**: é€šè¿‡`sync_status.py`åŒå‘åŒæ­¥çŠ¶æ€
4. **å®Œæˆæ£€æµ‹**: æ‰€æœ‰å­ä»»åŠ¡å®Œæˆåï¼Œè‡ªåŠ¨æ ‡è®°Taskä¸ºcompleted

**æ–‡æ¡£å‚è€ƒ**:

- [PART2-Task-Masterå­ä»»åŠ¡ç”Ÿæˆ](./AI-WORKFLOW-V4-PART2-TM-ADAPTER.md#1-task-masteré›†æˆæ¶æ„)
- [PART2-æ–‡ä»¶å…³è”é€»è¾‘](./AI-WORKFLOW-V4-PART2-TM-ADAPTER.md#52-æ–‡ä»¶å…³è”é€»è¾‘)
- [PART2-ä»»åŠ¡çŠ¶æ€åŒæ­¥æœºåˆ¶](./AI-WORKFLOW-V4-PART2-TM-ADAPTER.md#6-ä»»åŠ¡çŠ¶æ€åŒæ­¥æœºåˆ¶)
- [Task-Masterç ”ç©¶æŠ¥å‘Š](./TASK-MASTER-RESEARCH.md)

---

## Q7: å¤šä¸ªPRDå¯¹åº”ä¸€ä¸ªä»£ç æ–‡ä»¶ vs åŸå­ä»£ç å®ç°

**é—®é¢˜**: å¦‚ä½•å¤„ç†å¤šä¸ªPRDå…±äº«ä¸€ä¸ªä»£ç æ–‡ä»¶ï¼Ÿå¦‚ä½•ä¿è¯ä»£ç çš„åŸå­æ€§ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **PRDå…ƒæ•°æ®å†—ä½™ + ä»£ç æ³¨é‡Šå…³è”**

### åœºæ™¯1: å¤šä¸ªPRDå¯¹åº”ä¸€ä¸ªä»£ç æ–‡ä»¶

**ç¤ºä¾‹**: `backend/apps/users/views.py` è¢«å¤šä¸ªPRDä½¿ç”¨

```yaml
# REQ-2025-001-user-login.md
implementation_files:
  - backend/apps/users/views.py  # å…±äº«æ–‡ä»¶

# REQ-2025-002-user-profile.md
implementation_files:
  - backend/apps/users/views.py  # å…±äº«æ–‡ä»¶
```

**ä»£ç æ–‡ä»¶ä¸­ä½¿ç”¨æ³¨é‡Šæ ‡æ³¨**:

```python
# backend/apps/users/views.py

# REQ-2025-001: ç”¨æˆ·ç™»å½•
class LoginView(APIView):
    def post(self, request):
        ...

# REQ-2025-002: ç”¨æˆ·èµ„æ–™
class ProfileView(APIView):
    def get(self, request):
        ...
```

### åœºæ™¯2: ä¸€ä¸ªPRDå¯¹åº”å¤šæ¬¡æäº¤

**é—®é¢˜**: ä¸€ä¸ªPRDçš„å®ç°éœ€è¦å¤šæ¬¡æäº¤ï¼ˆå¦‚Task-1, Task-2, Task-3ï¼‰

**è§£å†³æ–¹æ¡ˆ**: PRDçŠ¶æ€ä¿æŒ`implementing`

```yaml
# PRDå…ƒæ•°æ®ä¸­è®°å½•æ‰€æœ‰æäº¤
commits:
  - sha: abc123
    task_id: task-1
    subtask_id: subtask-2
    timestamp: 2025-10-24T10:00:00Z
  - sha: def456
    task_id: task-1
    subtask_id: subtask-3
    timestamp: 2025-10-24T11:00:00Z
  - sha: ghi789
    task_id: task-2
    subtask_id: subtask-1
    timestamp: 2025-10-24T12:00:00Z
```

**æ‰€æœ‰Taskå®Œæˆå**: è‡ªåŠ¨æ ‡è®°PRDä¸º`completed`

### åŸå­æ€§ä¿éšœ

1. **å­ä»»åŠ¡ç²’åº¦**: æ¯ä¸ªå­ä»»åŠ¡æ˜¯åŸå­çš„ï¼ˆä¸€æ¬¡æäº¤å®Œæˆï¼‰
2. **æµ‹è¯•éªŒè¯**: æ¯ä¸ªå­ä»»åŠ¡éƒ½æœ‰å¯¹åº”æµ‹è¯•
3. **å›æ»šèƒ½åŠ›**: å¯ä»¥å›æ»šå•ä¸ªå­ä»»åŠ¡çš„æäº¤

**æ–‡æ¡£å‚è€ƒ**:

- [PART3-PRDä¿®æ”¹ç­–ç•¥](./AI-WORKFLOW-V4-PART3-PRD-TRD.md#7-prdä¿®æ”¹ç­–ç•¥)
- [PART5-æµ‹è¯•æ–‡ä»¶ä¸ä»£ç æ–‡ä»¶å…³è”](./AI-WORKFLOW-V4-PART4-TDD-TEST.md#5-æµ‹è¯•æ–‡ä»¶ä¸ä»£ç æ–‡ä»¶å…³è”)

---

## Q8: æäº¤é¢‘ç‡ä¸ä»»åŠ¡å®Œæˆå…³è”

**é—®é¢˜**: å¤šä¹…æäº¤ä¸€æ¬¡ï¼Ÿå¦‚ä½•ä¸Task-Masterä»»åŠ¡å®Œæˆå…³è”ï¼ŸCommitæ¶ˆæ¯å¦‚ä½•éªŒè¯ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **å­ä»»åŠ¡å®Œæˆå³æäº¤ + å¼ºåˆ¶Commitæ¶ˆæ¯æ ¼å¼**

### æäº¤é¢‘ç‡

**åŸåˆ™**: **æ¯å®Œæˆä¸€ä¸ªå­ä»»åŠ¡å°±æäº¤**

```
Task-1: Implement backend API
  â”œâ”€â”€ Subtask-1: Create models â†’ Commit 1
  â”œâ”€â”€ Subtask-2: Implement views â†’ Commit 2
  â”œâ”€â”€ Subtask-3: Create serializers â†’ Commit 3
  â”œâ”€â”€ Subtask-4: Write unit tests â†’ Commit 4
  â””â”€â”€ Subtask-5: Write integration tests â†’ Commit 5
```

### Commitæ¶ˆæ¯æ ¼å¼

**å¼ºåˆ¶æ ¼å¼**: `[REQ-ID] Task-X Subtask-Y æè¿°`

**ç¤ºä¾‹**:

```bash
git commit -m "[REQ-2025-001-user-login] Task-1 Subtask-2 å®ç°ç™»å½•APIè§†å›¾"
```

### Commit-msg HookéªŒè¯

```bash
# .githooks/commit-msg

if echo "$COMMIT_MSG" | grep -qE '^\[REQ-[0-9]{4}-[0-9]{3}-[a-z0-9-]+\] Task-[0-9]+ Subtask-[0-9]+'; then
    # éªŒè¯REQ-IDæ˜¯å¦å­˜åœ¨
    # éªŒè¯Task-IDæ˜¯å¦å­˜åœ¨
    # éªŒè¯Subtask-IDæ˜¯å¦å­˜åœ¨
    exit 0
else
    echo "âŒ æäº¤æ¶ˆæ¯æ ¼å¼é”™è¯¯"
    exit 1
fi
```

### ä»»åŠ¡çŠ¶æ€åŒæ­¥

**Post-commit Hookè‡ªåŠ¨åŒæ­¥**:

```bash
# .githooks/post-commit

REQ_ID=$(æå–REQ-ID)
TASK_ID=$(æå–Task-ID)
SUBTASK_ID=$(æå–Subtask-ID)

python scripts/task-master/sync_status.py \
  --req-id $REQ_ID \
  --task-id $TASK_ID \
  --subtask-id $SUBTASK_ID \
  --status completed \
  --commit-sha $(git rev-parse HEAD)
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART5-Commit-msg Hook](./AI-WORKFLOW-V4-PART5-COMPLIANCE.md#4-ç¬¬äºŒé“é˜²çº¿commit-msg-hook)
- [PART2-ä»»åŠ¡çŠ¶æ€åŒæ­¥](./AI-WORKFLOW-V4-PART2-TM-ADAPTER.md#6-ä»»åŠ¡çŠ¶æ€åŒæ­¥æœºåˆ¶)

---

## Q9: è·¨ç”µè„‘åä½œçš„Task-Masterä»»åŠ¡ç®¡ç†

**é—®é¢˜**: å¦‚ä½•åœ¨å¤šå°ç”µè„‘ä¸Šåä½œTask-Masterä»»åŠ¡ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **GitåŒæ­¥.taskmasterç›®å½• + é”æœºåˆ¶**

### åä½œæµç¨‹

```
ç”µè„‘A:
1. æ‹‰å–æœ€æ–°ä»£ç 
2. æ‰§è¡ŒTask-1 Subtask-1
3. æäº¤å¹¶æ¨é€ï¼ˆåŒ…æ‹¬.taskmasterç›®å½•ï¼‰

ç”µè„‘B:
1. æ‹‰å–æœ€æ–°ä»£ç ï¼ˆåŒ…æ‹¬.taskmasterç›®å½•ï¼‰
2. çœ‹åˆ°Task-1 Subtask-1å·²å®Œæˆ
3. ç»§ç»­æ‰§è¡ŒTask-1 Subtask-2
4. æäº¤å¹¶æ¨é€
```

### å†²çªé¿å…

**åŸåˆ™**: ä¸åŒäººè´Ÿè´£ä¸åŒTask

```
ç”µè„‘A: Task-1ï¼ˆåç«¯APIï¼‰
ç”µè„‘B: Task-2ï¼ˆå‰ç«¯UIï¼‰
```

### é”æœºåˆ¶

**åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªtasks.jsonçš„å¤„ç†**:

```python
# scripts/task-master/sync_status.py

import fcntl

def sync_status_with_lock(req_id, task_id, subtask_id, status):
    lock_file = f'.taskmaster/tasks/{req_id}/.lock'

    # è·å–é”ï¼ˆæœ€å¤šé‡è¯•5æ¬¡ï¼‰
    for i in range(5):
        try:
            with open(lock_file, 'w') as lock:
                fcntl.flock(lock, fcntl.LOCK_EX | fcntl.LOCK_NB)

                # è¯»å–tasks.json
                # æ›´æ–°çŠ¶æ€
                # å†™å›tasks.json

                fcntl.flock(lock, fcntl.LOCK_UN)
                break
        except IOError:
            time.sleep(1)  # ç­‰å¾…1ç§’åé‡è¯•
```

### æœ€ä½³å®è·µ

1. **é¢‘ç¹åŒæ­¥**: æ¯å®Œæˆä¸€ä¸ªå­ä»»åŠ¡å°±æ¨é€
2. **æ¸…æ™°Commit**: `[REQ-ID] Task-X Subtask-Y å®ŒæˆXXX`
3. **é¿å…å¹¶è¡Œ**: ä¸åŒäººä¸è¦åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªTask
4. **ä½¿ç”¨åˆ†æ”¯**: æ¯ä¸ªTaskåœ¨ç‹¬ç«‹Featureåˆ†æ”¯å¼€å‘

**æ–‡æ¡£å‚è€ƒ**:

- [PART2-è·¨ç”µè„‘åä½œæ”¯æŒ](./AI-WORKFLOW-V4-PART2-TM-ADAPTER.md#7-è·¨ç”µè„‘åä½œæ”¯æŒ)

---

## Q10: Bugä¿®å¤å¦‚ä½•æ›´æ–°Task-ID

**é—®é¢˜**: å¦‚æœå‘ç°éœ€æ±‚æœ‰ç¼ºé™·ï¼ˆBugï¼‰ï¼Œå¦‚ä½•ç”Ÿæˆæ–°çš„Taskï¼Ÿå¦‚ä½•æ›´æ–°Task-IDï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **Bugä¿®å¤åˆ›å»ºå›å½’æµ‹è¯•ä»»åŠ¡**

### Bugä¿®å¤æµç¨‹

```
1. å‘ç°Bug â†’ åˆ›å»ºGitHub Issue (#123)
  â†“
2. ç¼–å†™å›å½’æµ‹è¯• (test_issue_123.py)
  â†“
3. æµ‹è¯•å¤±è´¥ï¼ˆçº¢è‰²ï¼‰
  â†“
4. ä¿®å¤Bug
  â†“
5. æµ‹è¯•é€šè¿‡ï¼ˆç»¿è‰²ï¼‰
  â†“
6. æäº¤: [BUGFIX] ä¿®å¤Issue#123 å¯†ç ç‰¹æ®Šå­—ç¬¦é—®é¢˜
```

### æ˜¯å¦æ›´æ–°PRDï¼Ÿ

**æƒ…å†µ1: Bugæ˜¯PRDç¼ºé™·**

- **ä¿®æ”¹PRD**: ä¿®æ­£PRDä¸­çš„é”™è¯¯æè¿°
- **ç‰ˆæœ¬å‡çº§**: PRD versionä»1.0å‡çº§åˆ°1.1
- **é‡æ–°ç”Ÿæˆä»»åŠ¡**: è¿è¡ŒTask-Masterç”Ÿæˆæ–°ä»»åŠ¡

**æƒ…å†µ2: Bugæ˜¯å®ç°ç¼ºé™·**

- **ä¸ä¿®æ”¹PRD**: PRDæ²¡æœ‰é”™
- **åˆ›å»ºå›å½’æµ‹è¯•**: `backend/tests/regression/test_issue_123.py`
- **Commitæ¶ˆæ¯**: `[BUGFIX] ä¿®å¤Issue#123`ï¼ˆä¸å…³è”REQ-IDï¼‰

### å›å½’æµ‹è¯•ä»»åŠ¡ç®¡ç†

**ä¸éœ€è¦Task-Masterç”Ÿæˆ**ï¼Œç›´æ¥æäº¤ï¼š

```bash
# 1. åˆ›å»ºå›å½’æµ‹è¯•
cat > backend/tests/regression/test_issue_123.py << 'EOF'
def test_issue_123_password_special_chars():
    """Bug #123: å¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦æ—¶ç™»å½•å¤±è´¥"""
    # æµ‹è¯•ä»£ç 
EOF

# 2. è¿è¡Œæµ‹è¯•ï¼ˆå¤±è´¥ï¼‰
pytest backend/tests/regression/test_issue_123.py

# 3. ä¿®å¤Bug
vim backend/apps/users/services.py

# 4. è¿è¡Œæµ‹è¯•ï¼ˆé€šè¿‡ï¼‰
pytest backend/tests/regression/test_issue_123.py

# 5. æäº¤
git commit -m "[BUGFIX] ä¿®å¤Issue#123 å¯†ç ç‰¹æ®Šå­—ç¬¦éªŒè¯å¤±è´¥"
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART4-å›å½’æµ‹è¯•æœºåˆ¶](./AI-WORKFLOW-V4-PART4-TDD-TEST.md#8-å›å½’æµ‹è¯•æœºåˆ¶)
- [PART3-PRDä¿®æ”¹ç­–ç•¥](./AI-WORKFLOW-V4-PART3-PRD-TRD.md#7-prdä¿®æ”¹ç­–ç•¥)

---

## Q11: PRDå…ƒæ•°æ®åœ¨ä»»åŠ¡åˆ›å»ºå‰å¦‚ä½•å¼ºåˆ¶æ‰§è¡Œ

**é—®é¢˜**: å¦‚ä½•ç¡®ä¿å³ä½¿åœ¨Task-Masterè¿˜æ²¡ç”Ÿæˆä»»åŠ¡æ—¶ï¼ŒPRDå…ƒæ•°æ®ä¹Ÿå¿…é¡»å¡«å†™å®Œæ•´ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **Pre-commit HookéªŒè¯PRDå®Œæ•´æ€§**

### éªŒè¯æ—¶æœº

**ç¬¬ä¸€æ¬¡æäº¤PRDæ—¶**:

```bash
# 1. åˆ›å»ºPRD
vim docs/00_product/requirements/REQ-2025-001/REQ-2025-001.md

# 2. æäº¤PRDï¼ˆPre-commitè‡ªåŠ¨éªŒè¯ï¼‰
git add docs/00_product/requirements/REQ-2025-001/REQ-2025-001.md
git commit -m "[REQ-2025-001] åˆ›å»ºPRD"

# Pre-commit HookéªŒè¯:
# âœ… YAML frontmatterå®Œæ•´æ€§
# âœ… å¿…å¡«å­—æ®µå­˜åœ¨
# âœ… test_fileséç©º
# âœ… implementation_fileséç©º
# âœ… api_contractå­˜åœ¨
```

### éªŒè¯è„šæœ¬

```python
# scripts/compliance/validate_prd.py

def validate_prd(prd_path):
    # 1. è¯»å–PRD
    with open(prd_path, 'r') as f:
        content = f.read()

    # 2. è§£æYAML frontmatter
    if not content.startswith('---'):
        raise ValidationError("PRDå¿…é¡»åŒ…å«YAML frontmatter")

    metadata = parse_yaml_frontmatter(content)

    # 3. éªŒè¯å¿…å¡«å­—æ®µ
    required_fields = [
        'req_id', 'title', 'status', 'test_files',
        'implementation_files', 'api_contract', 'deletable'
    ]

    for field in required_fields:
        if field not in metadata:
            raise ValidationError(f"ç¼ºå°‘å¿…å¡«å­—æ®µ: {field}")

    # 4. éªŒè¯test_fileséç©º
    if not metadata['test_files'] or len(metadata['test_files']) == 0:
        raise ValidationError("test_filesä¸èƒ½ä¸ºç©º")

    # 5. éªŒè¯implementation_fileséç©º
    if not metadata['implementation_files'] or len(metadata['implementation_files']) == 0:
        raise ValidationError("implementation_filesä¸èƒ½ä¸ºç©º")

    # 6. éªŒè¯å­—æ®µæ ¼å¼
    if not re.match(r'^REQ-\d{4}-\d{3}-.+$', metadata['req_id']):
        raise ValidationError("req_idæ ¼å¼é”™è¯¯")

    print("âœ… PRDéªŒè¯é€šè¿‡")
```

### Task-Masteræ‰§è¡Œå‰éªŒè¯

```bash
# Task-0 Subtask-1: éªŒè¯PRDå…ƒæ•°æ®
python scripts/compliance/validate_prd.py REQ-2025-001-user-login

# åªæœ‰éªŒè¯é€šè¿‡ï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œåç»­ä»»åŠ¡
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART3-PRDå…ƒæ•°æ®æ ‡å‡†](./AI-WORKFLOW-V4-PART3-PRD-TRD.md#3-prdå…ƒæ•°æ®æ ‡å‡†)
- [PART3-PRDéªŒè¯è§„åˆ™](./AI-WORKFLOW-V4-PART3-PRD-TRD.md#6-prdéªŒè¯è§„åˆ™)

---

## Q12: PRDå†…å®¹è¦æ±‚ï¼ˆæ•°æ®åº“ã€Redisè®¾è®¡ï¼‰

**é—®é¢˜**: PRDä¸­æ˜¯å¦å¿…é¡»åŒ…å«æ•°æ®åº“è®¾è®¡ã€Redisè®¾è®¡ï¼Ÿå¦‚ä½•éªŒè¯ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **å†…å®¹ç»“æ„æ£€æŸ¥**

### å¿…éœ€ç« èŠ‚

```yaml
# .compliance/rules/prd.yaml

content_structure_checks:
  enabled: true
  required_sections:
    - "åŠŸèƒ½æ¦‚è¿°"
    - "ç”¨æˆ·æ•…äº‹"
    - "éªŒæ”¶æ ‡å‡†"
    - "æ•°æ®åº“è®¾è®¡" # â† å¿…éœ€
    - "Redisç¼“å­˜ç­–ç•¥" # â† å¿…éœ€ï¼ˆå¦‚æœä½¿ç”¨Redisï¼‰
    - "APIæ¥å£å®šä¹‰" # â† å¿…éœ€
    - "æµ‹è¯•ç”¨ä¾‹"
    - "å‰ç«¯UI/UXç»†èŠ‚" # â† å‰ç«¯éœ€æ±‚å¿…éœ€
```

### éªŒè¯é€»è¾‘

```python
# .compliance/checkers/prd_checker.py

def check_content_structure(prd_content, rule):
    required_sections = rule['content_structure_checks']['required_sections']

    missing_sections = []
    for section in required_sections:
        # æ£€æŸ¥æ˜¯å¦åŒ…å«è¯¥ç« èŠ‚ï¼ˆä½¿ç”¨æ­£åˆ™åŒ¹é…æ ‡é¢˜ï¼‰
        pattern = rf'##\s+\d*\.?\s*{re.escape(section)}'
        if not re.search(pattern, prd_content, re.IGNORECASE):
            missing_sections.append(section)

    if missing_sections:
        if rule['content_structure_checks'].get('warn_missing_sections'):
            # è­¦å‘Šä½†ä¸é˜»æ­¢
            print(f"âš ï¸ PRDç¼ºå°‘ä»¥ä¸‹ç« èŠ‚: {', '.join(missing_sections)}")
        else:
            # é˜»æ­¢æäº¤
            raise ComplianceError(f"PRDç¼ºå°‘å¿…éœ€ç« èŠ‚: {', '.join(missing_sections)}")
```

### æ•°æ®åº“è®¾è®¡è¦æ±‚

**æœ€ä½è¦æ±‚**:

- è¡¨å
- å­—æ®µå®šä¹‰ï¼ˆåç§°ã€ç±»å‹ã€è¯´æ˜ï¼‰
- ä¸»é”®ã€å¤–é”®
- ç´¢å¼•è®¾è®¡
- è¿ç§»æ–‡ä»¶è·¯å¾„

**ç¤ºä¾‹**:

```markdown
## æ•°æ®åº“è®¾è®¡

### ç”¨æˆ·è¡¨ (users)

| å­—æ®µ  | ç±»å‹         | è¯´æ˜ | çº¦æŸ     | ç´¢å¼•    |
| ----- | ------------ | ---- | -------- | ------- |
| id    | BigInt       | ä¸»é”® | NOT NULL | PRIMARY |
| email | VARCHAR(255) | é‚®ç®± | UNIQUE   | UNIQUE  |

**è¿ç§»æ–‡ä»¶**: `backend/apps/users/migrations/0001_create_users_table.py`
```

### Redisè®¾è®¡è¦æ±‚

**æœ€ä½è¦æ±‚**:

- Keyæ ¼å¼
- æ•°æ®ç±»å‹
- TTLç­–ç•¥
- å€¼ç»“æ„

**ç¤ºä¾‹**:

```markdown
## Redisç¼“å­˜ç­–ç•¥

### ç™»å½•é™æµ

- **Key**: `login:attempts:{email}`
- **ç±»å‹**: String
- **TTL**: 900ç§’ï¼ˆ15åˆ†é’Ÿï¼‰
- **å€¼**: å°è¯•æ¬¡æ•°ï¼ˆ0-5ï¼‰
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART3-PRDæ ¸å¿ƒè§„èŒƒ](./AI-WORKFLOW-V4-PART3-PRD-TRD.md#1-prdæ ¸å¿ƒè§„èŒƒ)

---

## Q13: PRDå‘½åè§„èŒƒçš„å¯æ‰©å±•æ€§

**é—®é¢˜**: REQ-{YEAR}-{NUMBER}-{SLUG}çš„å‘½åæ˜¯å¦å¯ä»¥æ‰©å±•ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **æ”¯æŒå¤šç§æ‰©å±•æ¨¡å¼**

### åŸºç¡€æ ¼å¼

`REQ-{YEAR}-{NUMBER}-{SLUG}`

- **ç¤ºä¾‹**: `REQ-2025-001-user-login`

### æ‰©å±•æ¨¡å¼1: æŒ‰æ¨¡å—å‰ç¼€

`REQ-{YEAR}-{MODULE}-{NUMBER}-{SLUG}`

- **ç¤ºä¾‹**:
  - `REQ-2025-AUTH-001-user-login`
  - `REQ-2025-PRODUCT-001-product-catalog`
  - `REQ-2025-ORDER-001-order-management`

### æ‰©å±•æ¨¡å¼2: æŒ‰ä¼˜å…ˆçº§å‰ç¼€

`REQ-{YEAR}-{PRIORITY}-{NUMBER}-{SLUG}`

- **ç¤ºä¾‹**:
  - `REQ-2025-P1-001-critical-security-fix`
  - `REQ-2025-P2-001-important-feature`
  - `REQ-2025-P3-001-nice-to-have`

### æ‰©å±•æ¨¡å¼3: æŒ‰ç±»å‹å‰ç¼€

`REQ-{YEAR}-{TYPE}-{NUMBER}-{SLUG}`

- **ç¤ºä¾‹**:
  - `REQ-2025-FEATURE-001-user-login`
  - `REQ-2025-BUGFIX-001-password-validation`
  - `REQ-2025-REFACTOR-001-database-optimization`

### é…ç½®æ‰©å±•è§„åˆ™

```yaml
# .compliance/rules/prd.yaml

metadata_validation:
  req_id:
    # åŸºç¡€æ ¼å¼
    pattern: "^REQ-\\d{4}-\\d{3}-.+$"

    # æ‰©å±•æ ¼å¼ï¼ˆå¯é€‰ï¼‰
    extended_patterns:
      - "^REQ-\\d{4}-[A-Z]+-\\d{3}-.+$" # æ¨¡å—å‰ç¼€
      - "^REQ-\\d{4}-P[1-3]-\\d{3}-.+$" # ä¼˜å…ˆçº§å‰ç¼€
      - "^REQ-\\d{4}-(FEATURE|BUGFIX|REFACTOR)-\\d{3}-.+$" # ç±»å‹å‰ç¼€
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART1-REQ-IDå‘½åè§„èŒƒ](./AI-WORKFLOW-V4-PART1-ARCH.md#32-ç›®å½•å‘½åè§„èŒƒ)

---

## Q14: PRDå¯¹å‰ç«¯å¼€å‘çš„ç»†èŠ‚è¦æ±‚

**é—®é¢˜**: å‰ç«¯å¼€å‘ï¼ˆå¦‚æ‰“å­—ç»ƒä¹ ç½‘ç«™ï¼‰çš„PRDéœ€è¦å¤šè¯¦ç»†ï¼ŸUI/UXå…ƒç´ å¦‚ä½•æè¿°ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **åˆ†å±‚æè¿° + åŸå‹å›¾**

### å‰ç«¯PRDå¿…éœ€ç« èŠ‚

```markdown
## å‰ç«¯UI/UXç»†èŠ‚

### é¡µé¢ç»“æ„

- **è·¯ç”±**: `/typing-practice`
- **Layout**: MainLayout
- **ç»„ä»¶æ ‘**:
  - TypingPracticeView
    - TypingArea (æ‰“å­—åŒºåŸŸ)
    - StatisticsPanel (ç»Ÿè®¡é¢æ¿)
    - KeyboardHints (é”®ç›˜æç¤º)

### ç»„ä»¶è¯¦ç»†è®¾è®¡

#### TypingAreaç»„ä»¶

**åŠŸèƒ½**: æ˜¾ç¤ºå¾…è¾“å…¥æ–‡æœ¬ï¼Œé«˜äº®å·²è¾“å…¥æ–‡æœ¬
**Props**:

- `text`: string (å¾…è¾“å…¥æ–‡æœ¬)
- `userInput`: string (ç”¨æˆ·å·²è¾“å…¥)
  **Events**:
- `@input`: ç”¨æˆ·è¾“å…¥äº‹ä»¶
  **æ ·å¼**:
- å­—ä½“: Monospace 18px
- æ­£ç¡®å­—ç¬¦: ç»¿è‰²
- é”™è¯¯å­—ç¬¦: çº¢è‰²èƒŒæ™¯

#### StatisticsPanelç»„ä»¶

**åŠŸèƒ½**: æ˜¾ç¤ºå®æ—¶ç»Ÿè®¡
**æ˜¾ç¤ºå†…å®¹**:

- WPM (æ¯åˆ†é’Ÿå­—æ•°)
- å‡†ç¡®ç‡
- å·²ç”¨æ—¶é—´
- è¿›åº¦æ¡

### äº¤äº’é€»è¾‘

1. ç”¨æˆ·è¿›å…¥é¡µé¢ â†’ æ˜¾ç¤ºéšæœºæ–‡æœ¬
2. ç”¨æˆ·å¼€å§‹è¾“å…¥ â†’ å¯åŠ¨è®¡æ—¶å™¨
3. æ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦:
   - æ­£ç¡® â†’ ç»¿è‰²é«˜äº®
   - é”™è¯¯ â†’ çº¢è‰²èƒŒæ™¯ï¼Œæ’­æ”¾é”™è¯¯éŸ³æ•ˆ
4. å®Œæˆæ‰€æœ‰æ–‡æœ¬ â†’ æ˜¾ç¤ºæˆç»©ç»Ÿè®¡

### åŸå‹å›¾

![æ‰“å­—ç»ƒä¹ é¡µé¢åŸå‹](./attachments/typing-practice-mockup.png)

### æ ·å¼è§„èŒƒ

- **é…è‰²æ–¹æ¡ˆ**:
  - ä¸»è‰²: #4dabf7
  - æˆåŠŸ: #51cf66
  - é”™è¯¯: #ff6b6b
- **é—´è·**: 16pxç½‘æ ¼ç³»ç»Ÿ
- **åŠ¨ç”»**: è¾“å…¥æ—¶çš„å¹³æ»‘è¿‡æ¸¡ï¼ˆ200msï¼‰
```

### ç»„ä»¶çº§åˆ«æµ‹è¯•ç”¨ä¾‹

```markdown
### E2Eæµ‹è¯•ç”¨ä¾‹ (e2e/tests/test-typing-practice.spec.ts)

**test_user_can_start_typing**:

- è®¿é—® `/typing-practice`
- çœ‹åˆ°å¾…è¾“å…¥æ–‡æœ¬
- ç‚¹å‡»è¾“å…¥æ¡†
- è¾“å…¥ç¬¬ä¸€ä¸ªå­—ç¬¦
- éªŒè¯è®¡æ—¶å™¨å¯åŠ¨

**test_correct_input_highlights_green**:

- è¾“å…¥æ­£ç¡®å­—ç¬¦
- éªŒè¯å­—ç¬¦å˜ä¸ºç»¿è‰²

**test_incorrect_input_shows_error**:

- è¾“å…¥é”™è¯¯å­—ç¬¦
- éªŒè¯å­—ç¬¦èƒŒæ™¯å˜ä¸ºçº¢è‰²
- éªŒè¯æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART3-PRDæ ¸å¿ƒè§„èŒƒï¼ˆå‰ç«¯UI/UXç« èŠ‚ï¼‰](./AI-WORKFLOW-V4-PART3-PRD-TRD.md#9-å‰ç«¯uiuxç»†èŠ‚)

---

## Q15: PRDã€ä»»åŠ¡åˆ—è¡¨ã€ä»»åŠ¡æ–‡ä»¶çš„åˆ é™¤ä¿æŠ¤

**é—®é¢˜**: å¦‚ä½•é˜²æ­¢PRDã€Task-Masterä»»åŠ¡åˆ—è¡¨ã€ä»»åŠ¡æ–‡ä»¶è¢«è¯¯åˆ é™¤ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **å…ƒæ•°æ®æ ‡è®° + Pre-commit Hook + å®¡æ‰¹æµç¨‹**

### PRDåˆ é™¤ä¿æŠ¤

**å…ƒæ•°æ®æ ‡è®°**:

```yaml
deletable: false # é»˜è®¤ä¸å¯åˆ é™¤
delete_requires_review: true # åˆ é™¤éœ€è¦å®¡æ ¸
```

**Pre-commit Hookæ£€æŸ¥**:

```python
# .githooks/pre-commit

def check_prd_deletion(deleted_files):
    for file in deleted_files:
        if '/requirements/' in file and file.endswith('.md'):
            metadata = read_prd_metadata(file)

            if not metadata.get('deletable', False):
                print(f"âŒ ç¦æ­¢åˆ é™¤PRD: {file}")
                print("ğŸ’¡ å¦‚éœ€åˆ é™¤ï¼Œè¯·å…ˆä¿®æ”¹PRDå…ƒæ•°æ®ä¸­çš„ deletable ä¸º true")
                sys.exit(1)

            if metadata.get('delete_requires_review', True):
                print(f"âš ï¸ åˆ é™¤PRDéœ€è¦äººå·¥å®¡æ ¸")
                print("ğŸ’¡ è¯·åˆ›å»ºPRå¹¶è¯·æ±‚å®¡æ ¸")
                # å…è®¸æäº¤ï¼Œä½†éœ€è¦PRå®¡æ ¸
```

### Task-Masteræ–‡ä»¶åˆ é™¤ä¿æŠ¤

**.gitignoreæ’é™¤**ï¼ˆé˜²æ­¢è¯¯åˆ é™¤ï¼‰:

```
# .gitignore
!.taskmaster/tasks/**/*.json
!.taskmaster/tasks/**/*.md
```

**Pre-commit Hookæ£€æŸ¥**:

```bash
# æ£€æµ‹.taskmasterç›®å½•ä¸‹çš„åˆ é™¤
DELETED_TASK_FILES=$(git diff --name-status --cached | grep "^D" | grep ".taskmaster/tasks")

if [ -n "$DELETED_TASK_FILES" ]; then
    echo "âŒ ç¦æ­¢åˆ é™¤Task-Masterä»»åŠ¡æ–‡ä»¶"
    echo "ğŸ’¡ å¦‚éœ€åˆ é™¤ï¼Œè¯·å…ˆå½’æ¡£ä»»åŠ¡å¹¶åˆ›å»ºPR"
    exit 1
fi
```

### åˆ é™¤å®¡æ‰¹æµç¨‹

```mermaid
graph TB
    Request[å¼€å‘è€…è¯·æ±‚åˆ é™¤] --> UpdateMeta[ä¿®æ”¹deletable: true]
    UpdateMeta --> CreatePR[åˆ›å»ºPR]
    CreatePR --> Review{äººå·¥å®¡æ ¸}
    Review -->|æ‰¹å‡†| Merge[åˆå¹¶PR]
    Review -->|æ‹’ç»| Reject[æ‹’ç»åˆ é™¤]
    Merge --> Archive[å½’æ¡£åˆ°deleted/]
    Archive --> End[å®Œæˆ]

    style Reject fill:#ff6b6b
    style End fill:#51cf66
```

### å·²åˆ é™¤æ–‡ä»¶å½’æ¡£

```
docs/00_product/requirements/deleted/
â””â”€â”€ REQ-2025-001-user-login/
    â”œâ”€â”€ REQ-2025-001-user-login.md
    â”œâ”€â”€ REQ-2025-001-TRD.md
    â”œâ”€â”€ deleted_at.txt (2025-10-24T15:30:00Z)
    â””â”€â”€ deleted_by.txt (å¼ ä¸‰)
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART3-PRDåˆ é™¤ä¿æŠ¤](./AI-WORKFLOW-V4-PART3-PRD-TRD.md#8-prdåˆ é™¤ä¿æŠ¤)

---

## Q16: PRDä¿®æ”¹ç­–ç•¥ï¼ˆå¤šæ¬¡æäº¤ã€å¤šPRDï¼‰

**é—®é¢˜**: ä¸€ä¸ªPRDéœ€è¦å¤šæ¬¡æäº¤å¦‚ä½•å¤„ç†ï¼Ÿå¤šä¸ªPRDå¯¹åº”ä¸€ä¸ªä»£ç æ–‡ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **çŠ¶æ€ç®¡ç† + å…ƒæ•°æ®è®°å½•**

### ä¸€ä¸ªPRDå¤šæ¬¡æäº¤

**PRDçŠ¶æ€ä¿æŒ`implementing`**:

```yaml
# REQ-2025-001-user-login.md
status: implementing

commits:
  - sha: abc123
    task_id: task-1
    subtask_id: subtask-2
    message: "å®ç°ç™»å½•APIè§†å›¾"
    timestamp: 2025-10-24T10:00:00Z

  - sha: def456
    task_id: task-1
    subtask_id: subtask-3
    message: "å®ç°åºåˆ—åŒ–å™¨"
    timestamp: 2025-10-24T11:00:00Z

  - sha: ghi789
    task_id: task-2
    subtask_id: subtask-1
    message: "å®ç°å‰ç«¯ç™»å½•é¡µé¢"
    timestamp: 2025-10-24T12:00:00Z
```

**æ‰€æœ‰Taskå®Œæˆå**: è‡ªåŠ¨æ ‡è®°ä¸º`completed`

### å¤šä¸ªPRDå¯¹åº”ä¸€ä¸ªä»£ç æ–‡ä»¶

**æ¯ä¸ªPRDéƒ½è®°å½•**:

```yaml
# REQ-2025-001-user-login.md
implementation_files:
  - backend/apps/users/views.py

# REQ-2025-002-user-profile.md
implementation_files:
  - backend/apps/users/views.py  # å…±äº«
```

**ä»£ç æ–‡ä»¶ä¸­æ ‡æ³¨**:

```python
# backend/apps/users/views.py

# REQ-2025-001: ç”¨æˆ·ç™»å½•
class LoginView(APIView):
    pass

# REQ-2025-002: ç”¨æˆ·èµ„æ–™
class ProfileView(APIView):
    pass
```

### PRDç‰ˆæœ¬ç®¡ç†

**éœ€æ±‚å˜æ›´åˆ›å»ºæ–°ç‰ˆæœ¬**:

```
docs/00_product/requirements/REQ-2025-001-user-login/
â”œâ”€â”€ REQ-2025-001-user-login.md (v1.1 å½“å‰ç‰ˆæœ¬)
â””â”€â”€ history/
    â”œâ”€â”€ REQ-2025-001-user-login-v1.0.md
    â””â”€â”€ REQ-2025-001-user-login-v1.1.md
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART3-PRDä¿®æ”¹ç­–ç•¥](./AI-WORKFLOW-V4-PART3-PRD-TRD.md#7-prdä¿®æ”¹ç­–ç•¥)

---

## Q17: æµç¨‹ä¼˜åŒ–ä»»åŠ¡å¦‚ä½•é€‚ç”¨å·¥ä½œæµ

**é—®é¢˜**: å¦‚ä½•å°†å·¥ä½œæµåº”ç”¨åˆ°æµç¨‹ä¼˜åŒ–ä»»åŠ¡ï¼ˆå¦‚ä¼˜åŒ–GitHub Actionsã€AIå·¥ä½œæµï¼‰ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **æµç¨‹ä¼˜åŒ–ä¹Ÿæ˜¯éœ€æ±‚**

### åˆ›å»ºæµç¨‹ä¼˜åŒ–PRD

```yaml
---
req_id: REQ-2025-050-optimize-github-actions
title: ä¼˜åŒ–GitHub Actions CI/CDæµç¨‹
type: refactor  # â† ç±»å‹ä¸ºrefactor
priority: medium
test_files:
  - scripts/test_github_actions.py  # â† éªŒè¯è„šæœ¬
implementation_files:
  - .github/workflows/on-pr.yml
  - .github/workflows/on-push-dev.yml
---

# REQ-2025-050: ä¼˜åŒ–GitHub Actions CI/CDæµç¨‹

## ä¼˜åŒ–ç›®æ ‡
- å‡å°‘CIè¿è¡Œæ—¶é—´ä»10åˆ†é’Ÿåˆ°5åˆ†é’Ÿ
- é™ä½CIå¤±è´¥ç‡ä»20%åˆ°5%

## å½“å‰é—®é¢˜
- ä¾èµ–å®‰è£…æ…¢ï¼ˆæ¯æ¬¡éƒ½é‡æ–°å®‰è£…ï¼‰
- æµ‹è¯•è¿è¡Œæ…¢ï¼ˆæ²¡æœ‰å¹¶è¡Œï¼‰
- ç¼“å­˜æœªç”Ÿæ•ˆ

## ä¼˜åŒ–æ–¹æ¡ˆ
### 1. ä½¿ç”¨ä¾èµ–ç¼“å­˜
### 2. å¹¶è¡Œè¿è¡Œæµ‹è¯•
### 3. ä½¿ç”¨Dockerç¼“å­˜

## éªŒè¯æ ‡å‡†
- [ ] CIè¿è¡Œæ—¶é—´ < 5åˆ†é’Ÿ
- [ ] CIå¤±è´¥ç‡ < 5%
- [ ] ç¼“å­˜å‘½ä¸­ç‡ > 80%

## æµ‹è¯•æ–¹æ¡ˆ
- åˆ›å»ºæµ‹è¯•è„šæœ¬éªŒè¯å·¥ä½œæµè¯­æ³•
- ä½¿ç”¨actæœ¬åœ°æµ‹è¯•å·¥ä½œæµ
- ç›‘æ§10æ¬¡CIè¿è¡Œçš„å¹³å‡æ—¶é—´
```

### æµç¨‹ä¼˜åŒ–çš„æµ‹è¯•

**éªŒè¯è„šæœ¬**:

```python
# scripts/test_github_actions.py

def test_workflow_syntax():
    """æµ‹è¯•å·¥ä½œæµè¯­æ³•æ­£ç¡®æ€§"""
    result = subprocess.run(['act', '--dry-run'], capture_output=True)
    assert result.returncode == 0

def test_workflow_performance():
    """æµ‹è¯•å·¥ä½œæµæ€§èƒ½"""
    # æœ¬åœ°è¿è¡Œå·¥ä½œæµ
    start = time.time()
    subprocess.run(['act', '-j', 'test'])
    duration = time.time() - start

    assert duration < 300  # å°‘äº5åˆ†é’Ÿ
```

### Task-Masterç”Ÿæˆä»»åŠ¡

```json
{
  "tasks": [
    { "id": 1, "title": "Add dependency caching" },
    { "id": 2, "title": "Enable test parallelization" },
    { "id": 3, "title": "Configure Docker cache" },
    { "id": 4, "title": "Monitor and validate" }
  ]
}
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART3-PRDç±»å‹å®šä¹‰](./AI-WORKFLOW-V4-PART3-PRD-TRD.md#31-å…ƒæ•°æ®å­—æ®µå®šä¹‰)

---

## Q18: Task-Masterè‡ªæ£€ä¸æµ‹è¯•æ–‡ä»¶éªŒè¯

**é—®é¢˜**: Task-0è‡ªæ£€æ˜¯å¦åº”è¯¥ä½œä¸ºTask-Masterçš„ç¬¬ä¸€ä¸ªsubtaskï¼Ÿæµ‹è¯•æ–‡ä»¶éªŒè¯æ˜¯å¦æ˜¯åç»­taskï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **Task-0å¼ºåˆ¶ç¬¬ä¸€ä¸ªä»»åŠ¡**

### Task-0ç»“æ„

```
Task-0: Self-check and validationï¼ˆå¼ºåˆ¶ç¬¬ä¸€ä¸ªï¼‰
  â”œâ”€â”€ Subtask-1: éªŒè¯PRDå…ƒæ•°æ®
  â”œâ”€â”€ Subtask-2: æ£€æŸ¥æµ‹è¯•ç›®å½•å­˜åœ¨æ€§
  â””â”€â”€ Subtask-3: éªŒè¯APIå¥‘çº¦
```

### Subtask-1: éªŒè¯PRDå…ƒæ•°æ®

```bash
python scripts/compliance/validate_prd.py REQ-2025-001-user-login
```

**æ£€æŸ¥é¡¹**:

- [x] YAML frontmatterå®Œæ•´
- [x] å¿…å¡«å­—æ®µå­˜åœ¨
- [x] `test_files`éç©º
- [x] `implementation_files`éç©º
- [x] `api_contract`å­˜åœ¨

### Subtask-2: æ£€æŸ¥æµ‹è¯•ç›®å½•

```bash
python scripts/compliance/check_test_directories.py
```

**æ£€æŸ¥é¡¹**:

- [x] `backend/tests/unit/` å­˜åœ¨
- [x] `backend/tests/integration/` å­˜åœ¨
- [x] `backend/tests/regression/` å­˜åœ¨
- [x] `e2e/tests/` å­˜åœ¨

**ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º**

### Subtask-3: éªŒè¯APIå¥‘çº¦

```bash
python scripts/compliance/validate_api_contract.py REQ-2025-001-user-login
```

**æ£€æŸ¥é¡¹**:

- [x] APIå¥‘çº¦æ–‡ä»¶å­˜åœ¨
- [x] OpenAPIç‰ˆæœ¬3.0+
- [x] æ‰€æœ‰æ¥å£å®šä¹‰å®Œæ•´

### æµ‹è¯•æ–‡ä»¶éªŒè¯åœ¨åç»­Task

```
Task-1: Implement backend API
  â”œâ”€â”€ Subtask-1: Create models
  â”œâ”€â”€ Subtask-2: Implement views
  â”œâ”€â”€ Subtask-3: Create serializers
  â”œâ”€â”€ Subtask-4: Write unit tests  â† æµ‹è¯•æ–‡ä»¶éªŒè¯
  â””â”€â”€ Subtask-5: Write integration tests  â† æµ‹è¯•æ–‡ä»¶éªŒè¯
```

**Subtask-4æ‰§è¡Œæ—¶éªŒè¯**:

1. æµ‹è¯•æ–‡ä»¶æ˜¯å¦åˆ›å»ºï¼Ÿ
2. æµ‹è¯•æ–‡ä»¶æ˜¯å¦åœ¨æ­£ç¡®ç›®å½•ï¼Ÿ
3. æµ‹è¯•æ˜¯å¦è¿è¡Œé€šè¿‡ï¼Ÿ

**æ–‡æ¡£å‚è€ƒ**:

- [PART2-Task-0è‡ªæ£€ä»»åŠ¡](./AI-WORKFLOW-V4-PART2-TM-ADAPTER.md#4-task-0è‡ªæ£€ä»»åŠ¡)

---

## Q19: é˜²æ­¢Cursorä¿®æ”¹/è·³è¿‡æµ‹è¯•æ–‡ä»¶

**é—®é¢˜**: å¦‚ä½•é˜²æ­¢Cursoråœ¨æµ‹è¯•å¤±è´¥æ—¶ä¿®æ”¹æµ‹è¯•æˆ–è·³è¿‡æµ‹è¯•ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **Cursorè§„åˆ™ + Pre-commit Hook + Git Hooks**

### Cursorè§„åˆ™çº¦æŸ

```yaml
# .cursorrules

- name: no-skip-tests
  trigger: "æµ‹è¯•å¤±è´¥"
  system_prompt: |
    æ£€æµ‹åˆ°æµ‹è¯•å¤±è´¥ï¼Œä½ åº”è¯¥ï¼š
    1. åˆ†ææµ‹è¯•å¤±è´¥åŸå› 
    2. ä¿®å¤ä»£ç ä½¿æµ‹è¯•é€šè¿‡
    3. é‡æ–°è¿è¡Œæµ‹è¯•éªŒè¯

    ä½ ä¸åº”è¯¥ï¼š
    - åˆ é™¤å¤±è´¥çš„æµ‹è¯•
    - æ³¨é‡Šæ‰å¤±è´¥çš„æµ‹è¯•
    - ä½¿ç”¨@pytest.mark.skipè·³è¿‡æµ‹è¯•
    - ä¿®æ”¹æµ‹è¯•æœŸæœ›å€¼ä½¿å…¶é€šè¿‡ï¼ˆé™¤éæµ‹è¯•æœ¬èº«æœ‰Bugï¼‰

    å¦‚æœæµ‹è¯•æœ¬èº«æœ‰Bugï¼Œè¯·å…ˆç¡®è®¤PRDä¸­çš„æµ‹è¯•ç”¨ä¾‹æ˜¯å¦æ­£ç¡®ã€‚

- name: no-modify-tests-without-reason
  trigger: "ä¿®æ”¹æµ‹è¯•æ–‡ä»¶"
  system_prompt: |
    ä½ æ­£åœ¨ä¿®æ”¹æµ‹è¯•æ–‡ä»¶ï¼Œè¯·ç¡®è®¤ï¼š
    1. æ˜¯å¦æ˜¯å› ä¸ºPRDéœ€æ±‚å˜æ›´ï¼Ÿ
    2. æ˜¯å¦æ˜¯å› ä¸ºæµ‹è¯•æœ¬èº«æœ‰Bugï¼Ÿ
    3. æ˜¯å¦æœ‰å……åˆ†ç†ç”±ä¿®æ”¹æµ‹è¯•ï¼Ÿ

    å¦‚æœåªæ˜¯å› ä¸ºä»£ç æ— æ³•é€šè¿‡æµ‹è¯•ï¼Œåº”è¯¥ä¿®æ”¹ä»£ç è€Œä¸æ˜¯æµ‹è¯•ã€‚
```

### Pre-commit Hookæ£€æµ‹

```python
# scripts/compliance/check_test_modifications.py

def check_test_modifications():
    # è·å–ä¿®æ”¹çš„æµ‹è¯•æ–‡ä»¶
    modified_tests = git diff --cached --name-only | grep test_

    for test_file in modified_tests:
        # æ£€æŸ¥æ˜¯å¦åˆ é™¤äº†æµ‹è¯•ç”¨ä¾‹
        deleted_tests = git diff --cached test_file | grep "^-def test_"

        if deleted_tests:
            print(f"âš ï¸ æ£€æµ‹åˆ°åˆ é™¤æµ‹è¯•ç”¨ä¾‹: {test_file}")
            print("ğŸ’¡ è¯·ç¡®è®¤æ˜¯å¦æœ‰å……åˆ†ç†ç”±åˆ é™¤æµ‹è¯•")
            print("ğŸ’¡ å¦‚æœæ˜¯PRDå˜æ›´ï¼Œè¯·å…ˆæ›´æ–°PRD")

            # è¦æ±‚æä¾›ç†ç”±ï¼ˆé€šè¿‡Commitæ¶ˆæ¯ï¼‰
            if "[TEST-DELETION]" not in commit_message:
                print("âŒ åˆ é™¤æµ‹è¯•éœ€è¦åœ¨Commitæ¶ˆæ¯ä¸­æ·»åŠ [TEST-DELETION]æ ‡è®°")
                sys.exit(1)
```

### Git Diffå®¡è®¡

**Post-commit Hookè®°å½•æµ‹è¯•ä¿®æ”¹**:

```bash
# .githooks/post-commit

# æ£€æŸ¥æ˜¯å¦ä¿®æ”¹äº†æµ‹è¯•æ–‡ä»¶
MODIFIED_TESTS=$(git diff --name-only HEAD~1 HEAD | grep -E "test_|test-")

if [ -n "$MODIFIED_TESTS" ]; then
    echo "âš ï¸ æ£€æµ‹åˆ°æµ‹è¯•æ–‡ä»¶ä¿®æ”¹:"
    echo "$MODIFIED_TESTS"

    # è®°å½•åˆ°å®¡è®¡æ—¥å¿—
    python scripts/compliance/log_test_modification.py \
        --commit-sha $(git rev-parse HEAD) \
        --files "$MODIFIED_TESTS"
fi
```

### CI/CDéªŒè¯

**GitHub Actionsæ£€æŸ¥**:

```yaml
- name: Check test modifications
  run: |
    # æ£€æŸ¥æ˜¯å¦æœ‰æµ‹è¯•è¢«åˆ é™¤æˆ–è·³è¿‡
    python scripts/compliance/detect_skipped_tests.py
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART4-æµ‹è¯•å¤±è´¥å¤„ç†](./AI-WORKFLOW-V4-PART4-TDD-TEST.md#7-æµ‹è¯•å¤±è´¥å¤„ç†)
- [PART5-Cursorè¡Œä¸ºçº¦æŸ](./AI-WORKFLOW-V4-PART5-COMPLIANCE.md#72-cursorè¡Œä¸ºçº¦æŸ)

---

## Q20: APIå¥‘çº¦é©±åŠ¨å¹¶è¡Œå¼€å‘

**é—®é¢˜**: å¦‚ä½•å¼•å…¥APIå¥‘çº¦æ¦‚å¿µï¼Œå®ç°å‰åç«¯å¹¶è¡Œå¼€å‘ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **OpenAPIå¥‘çº¦ + Mock Server**

### APIå¥‘çº¦æµç¨‹

```
1. æ¶æ„å¸ˆè®¾è®¡APIå¥‘çº¦ï¼ˆOpenAPI 3.0ï¼‰
  â†“
2. å‰ç«¯åŸºäºMock Serverå¼€å‘
  â†“
3. åç«¯ç‹¬ç«‹å®ç°API
  â†“
4. å¥‘çº¦æµ‹è¯•éªŒè¯å‰åç«¯ä¸€è‡´æ€§
```

### OpenAPIå¥‘çº¦ç¤ºä¾‹

**æ–‡ä»¶**: `docs/01_guideline/api-contracts/REQ-2025-001/api.yaml`

```yaml
openapi: 3.0.0
info:
  title: ç”¨æˆ·ç™»å½•API
  version: 1.0.0

paths:
  /api/auth/login:
    post:
      summary: ç”¨æˆ·ç™»å½•
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
      responses:
        "200":
          description: ç™»å½•æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  user:
                    type: object
```

### Mock Serverï¼ˆå‰ç«¯ä½¿ç”¨ï¼‰

```bash
# å®‰è£…Mock Server
npm install -g @stoplight/prism-cli

# å¯åŠ¨Mock Server
prism mock docs/01_guideline/api-contracts/REQ-2025-001/api.yaml
```

**å‰ç«¯è°ƒç”¨Mock API**:

```typescript
// frontend/src/api/auth.ts

// å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨Mock Server
const BASE_URL =
  process.env.NODE_ENV === "development"
    ? "http://localhost:4010" // Mock Server
    : "http://localhost:8000"; // çœŸå®åç«¯

export const login = async (email: string, password: string) => {
  const response = await axios.post(`${BASE_URL}/api/auth/login`, {
    email,
    password,
  });
  return response.data;
};
```

### å¥‘çº¦æµ‹è¯•ï¼ˆéªŒè¯ä¸€è‡´æ€§ï¼‰

**å·¥å…·**: Dredd

```bash
# å®‰è£…Dredd
npm install -g dredd

# è¿è¡Œå¥‘çº¦æµ‹è¯•
dredd docs/01_guideline/api-contracts/REQ-2025-001/api.yaml http://localhost:8000
```

**CI/CDé›†æˆ**:

```yaml
# .github/workflows/contract-test.yml

- name: Run contract tests
  run: |
    # å¯åŠ¨åç«¯
    docker-compose up -d backend

    # ç­‰å¾…åç«¯å°±ç»ª
    sleep 10

    # è¿è¡Œå¥‘çº¦æµ‹è¯•
    dredd docs/01_guideline/api-contracts/**/api.yaml http://localhost:8000
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART3-APIå¥‘çº¦æ ‡å‡†](./AI-WORKFLOW-V4-PART3-PRD-TRD.md#5-apiå¥‘çº¦æ ‡å‡†)

---

## Q21: æ‹¦æˆªCursorç®€åŒ–/åˆ é™¤åŠŸèƒ½çš„ä¼ªBugä¿®å¤

**é—®é¢˜**: å¦‚ä½•æ‹¦æˆªCursoråœ¨Bugä¿®å¤åä¹‰ä¸‹åˆ é™¤/ç®€åŒ–å·²å¼€å‘åŠŸèƒ½ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **Pre-commitæ£€æµ‹ + PRDä½œä¸ºç¬¬ä¸€åŸåˆ™**

### æ£€æµ‹é€»è¾‘

```python
# scripts/compliance/check_feature_deletion.py

def detect_feature_deletion():
    # 1. è·å–åˆ é™¤çš„ä»£ç è¡Œ
    deleted_lines = get_deleted_lines()

    # 2. åˆ¤æ–­æ˜¯å¦æ˜¯PRDå®šä¹‰çš„åŠŸèƒ½
    for line in deleted_lines:
        if is_prd_feature(line):
            # 3. æ£€æŸ¥æäº¤æ¶ˆæ¯æ˜¯å¦æœ‰[BUGFIX]æ ‡è®°
            if has_bugfix_tag():
                # 4. æç¤ºä¿®æ”¹PRD
                show_prd_prompt(line)

                # 5. è¦æ±‚ç”¨æˆ·é€‰æ‹©
                choice = ask_user_choice()

                if choice == "ä¿®æ”¹PRD":
                    return "update_prd"
                else:
                    # æ‹’ç»æäº¤
                    raise ComplianceError("æœªç»æˆæƒåˆ é™¤PRDåŠŸèƒ½")
            else:
                # æ²¡æœ‰[BUGFIX]æ ‡è®°ï¼Œç›´æ¥æ‹’ç»
                raise ComplianceError("åˆ é™¤åŠŸèƒ½å¿…é¡»å…ˆä¿®æ”¹PRDæˆ–æ·»åŠ [BUGFIX]æ ‡è®°")
```

### äº¤äº’æµç¨‹

```mermaid
graph TB
    Commit[Cursoræäº¤ä»£ç ] --> Detect{æ£€æµ‹åˆ°åŠŸèƒ½åˆ é™¤?}

    Detect -->|å¦| Allow[âœ… å…è®¸æäº¤]
    Detect -->|æ˜¯| CheckTag{æœ‰[BUGFIX]æ ‡è®°?}

    CheckTag -->|å¦| Block1[âŒ æ‹’ç»æäº¤ æç¤ºä¿®æ”¹PRD]
    CheckTag -->|æ˜¯| ShowPRD[æ˜¾ç¤ºç›¸å…³PRDç« èŠ‚]

    ShowPRD --> Prompt[ğŸ’¬ æç¤º: æ£€æµ‹åˆ°åˆ é™¤PRDåŠŸèƒ½ è¯·å…ˆä¿®æ”¹PRD]
    Prompt --> Choice{Cursoré€‰æ‹©}

    Choice -->|ä¿®æ”¹PRD| UpdatePRD[æ›´æ–°PRD]
    Choice -->|åšæŒåˆ é™¤| Block2[âŒ æ‹’ç»æäº¤ è®°å½•å®¡è®¡æ—¥å¿—]

    UpdatePRD --> Verify{éªŒè¯PRDä¿®æ”¹}
    Verify -->|é€šè¿‡| Allow
    Verify -->|å¤±è´¥| Block2

    style Block1 fill:#ff6b6b
    style Block2 fill:#ff6b6b
    style Allow fill:#51cf66
```

### Cursorè§„åˆ™å¼ºåŒ–

```yaml
# .cursorrules

- name: prd-first-principle
  trigger: "Bugä¿®å¤"
  system_prompt: |
    åœ¨ä¿®å¤Bugæ—¶ï¼ŒPRDæ˜¯ç¬¬ä¸€åŸåˆ™ã€‚

    å¦‚æœBugä¿®å¤éœ€è¦åˆ é™¤/ç®€åŒ–åŠŸèƒ½ï¼š
    1. å…ˆæ£€æŸ¥PRDä¸­æ˜¯å¦å®šä¹‰äº†è¯¥åŠŸèƒ½
    2. å¦‚æœå®šä¹‰äº†ï¼Œå¿…é¡»å…ˆä¿®æ”¹PRD
    3. åœ¨PRDä¸­è¯´æ˜ä¸ºä»€ä¹ˆè¦åˆ é™¤/ç®€åŒ–è¯¥åŠŸèƒ½
    4. ç„¶åå†ä¿®æ”¹ä»£ç 

    ä½ ä¸èƒ½åœ¨Bugä¿®å¤çš„åä¹‰ä¸‹åˆ é™¤PRDå®šä¹‰çš„åŠŸèƒ½ã€‚
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART5-åŠŸèƒ½åˆ é™¤æ£€æŸ¥](./AI-WORKFLOW-V4-PART5-COMPLIANCE.md#33-åŠŸèƒ½åˆ é™¤æ£€æŸ¥è„šæœ¬)

---

## Q22: Debugä»»åŠ¡åœ¨Task-Masterä¸­çš„ç®¡ç†

**é—®é¢˜**: Debugä»»åŠ¡å¦‚ä½•åœ¨Task-Masterçš„ç›®å½•ç»“æ„ä¸­ç®¡ç†ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **å›å½’æµ‹è¯•ä»»åŠ¡ vs ç‹¬ç«‹Debugç›®å½•**

### æ–¹æ¡ˆ1: å›å½’æµ‹è¯•ä»»åŠ¡ï¼ˆæ¨èï¼‰

**é€‚ç”¨**: Bugä¿®å¤

```
backend/tests/regression/
â”œâ”€â”€ test_issue_123.py  # â† å›å½’æµ‹è¯•ï¼ˆé˜²æ­¢Bugå¤ç°ï¼‰
â”œâ”€â”€ test_issue_456.py
â””â”€â”€ test_issue_789.py
```

**Commitæ¶ˆæ¯**:

```bash
git commit -m "[BUGFIX] ä¿®å¤Issue#123 å¯†ç ç‰¹æ®Šå­—ç¬¦éªŒè¯å¤±è´¥"
```

**ä¸éœ€è¦Task-Masterä»»åŠ¡**ï¼Œç›´æ¥æäº¤

### æ–¹æ¡ˆ2: Debugä»»åŠ¡ç›®å½•ï¼ˆå¤æ‚Bugï¼‰

**é€‚ç”¨**: å¤æ‚Bugéœ€è¦å¤šæ­¥éª¤è°ƒè¯•

```
.taskmaster/tasks/DEBUG-2025-001-login-performance/
â”œâ”€â”€ tasks.json
â”œâ”€â”€ task-1-profile-performance/
â”‚   â”œâ”€â”€ task.md
â”‚   â”œâ”€â”€ subtask-1-collect-metrics.md
â”‚   â””â”€â”€ subtask-2-identify-bottleneck.md
â”œâ”€â”€ task-2-optimize-queries/
â”‚   â””â”€â”€ ...
â””â”€â”€ task-3-add-caching/
    â””â”€â”€ ...
```

**åˆ›å»ºDebug PRD**:

```yaml
---
req_id: DEBUG-2025-001-login-performance
title: ä¼˜åŒ–ç™»å½•æ€§èƒ½
type: bugfix
priority: high
related_req: REQ-2025-001-user-login # â† å…³è”åŸå§‹éœ€æ±‚
---
```

### é€‰æ‹©æ ‡å‡†

| Bugå¤æ‚åº¦ | ä¿®å¤æ—¶é—´ | æ–¹æ¡ˆ                          |
| --------- | -------- | ----------------------------- |
| ç®€å•Bug   | < 2å°æ—¶  | å›å½’æµ‹è¯•ï¼ˆä¸éœ€è¦Task-Masterï¼‰ |
| å¤æ‚Bug   | > 2å°æ—¶  | Debugä»»åŠ¡ï¼ˆä½¿ç”¨Task-Masterï¼‰  |

**æ–‡æ¡£å‚è€ƒ**:

- [PART4-å›å½’æµ‹è¯•æœºåˆ¶](./AI-WORKFLOW-V4-PART4-TDD-TEST.md#8-å›å½’æµ‹è¯•æœºåˆ¶)

---

## Q23: è‡ªåŠ¨å›æ»šæœªæˆæƒçš„åŠŸèƒ½åˆ é™¤

**é—®é¢˜**: å¦‚æœCursoråˆ é™¤/ç®€åŒ–äº†å·²å®ç°çš„åŠŸèƒ½ï¼ˆæ— PRDå®¡æŸ¥ï¼‰ï¼Œå¦‚ä½•è‡ªåŠ¨å›æ»šï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **Post-merge Hookè‡ªåŠ¨æ£€æµ‹å¹¶å›æ»š**

### è§¦å‘æ¡ä»¶

1. **æ£€æµ‹åˆ°åŠŸèƒ½åˆ é™¤**: åˆ é™¤çš„å‡½æ•°/ç±»è¶…è¿‡é˜ˆå€¼
2. **æ— PRDæˆæƒ**: PRDä¸­æœªæ ‡è®°è¯¥åŠŸèƒ½ä¸ºåˆ é™¤
3. **éBUGFIXæäº¤**: Commitæ¶ˆæ¯æ— `[BUGFIX]`æ ‡è®°

### Post-merge Hookå®ç°

```bash
# .githooks/post-merge

MERGE_COMMIT=$(git rev-parse HEAD)
PREV_COMMIT=$(git rev-parse HEAD~1)

# æ£€æµ‹åŠŸèƒ½åˆ é™¤
DELETED_FUNCTIONS=$(git diff $PREV_COMMIT $MERGE_COMMIT | \
    grep -E '^-\s*(def|class|function)' | wc -l)

if [ "$DELETED_FUNCTIONS" -gt 5 ]; then
    # å¤§é‡åŠŸèƒ½åˆ é™¤
    AUTHORIZED=$(python scripts/compliance/check_merge_authorized.py "$MERGE_COMMIT")

    if [ "$AUTHORIZED" != "true" ]; then
        echo "âŒ æ£€æµ‹åˆ°æœªæˆæƒçš„å¤§é‡åŠŸèƒ½åˆ é™¤ï¼ˆ$DELETED_FUNCTIONSä¸ªï¼‰"

        # è®°å½•å®¡è®¡æ—¥å¿—
        python scripts/compliance/log_unauthorized_deletion.py \
            --commit-sha "$MERGE_COMMIT" \
            --count "$DELETED_FUNCTIONS"

        # è‡ªåŠ¨å›æ»š
        git revert HEAD --no-edit
        git push origin $(git rev-parse --abbrev-ref HEAD)

        # å‘é€é€šçŸ¥
        python scripts/notifications/send_slack.py \
            --message "âš ï¸ æ£€æµ‹åˆ°æœªæˆæƒåˆ é™¤ï¼Œå·²è‡ªåŠ¨å›æ»šæäº¤ $MERGE_COMMIT"

        exit 1
    fi
fi
```

### æˆæƒæ£€æŸ¥é€»è¾‘

```python
# scripts/compliance/check_merge_authorized.py

def check_merge_authorized(commit_sha):
    # 1. æå–Commitæ¶ˆæ¯
    commit_msg = get_commit_message(commit_sha)

    # 2. å¦‚æœæœ‰[BUGFIX]æ ‡è®°ï¼Œæ£€æŸ¥æ˜¯å¦åœ¨PRDä¸­æˆæƒ
    if "[BUGFIX]" in commit_msg:
        # æå–REQ-ID
        req_id = extract_req_id(commit_msg)

        # è¯»å–PRD
        prd = read_prd(req_id)

        # æ£€æŸ¥PRDæ˜¯å¦æˆæƒåˆ é™¤
        if "åˆ é™¤" in prd.content or "ç§»é™¤" in prd.content:
            return True

    # 3. å¦åˆ™æ£€æµ‹ä¸ºæœªæˆæƒ
    return False
```

### é€šçŸ¥ç¤ºä¾‹

**Slacké€šçŸ¥**:

```
âš ï¸ è‡ªåŠ¨å›æ»šè­¦æŠ¥

æ£€æµ‹åˆ°æœªæˆæƒçš„åŠŸèƒ½åˆ é™¤ï¼Œå·²è‡ªåŠ¨å›æ»šï¼š

æäº¤: abc123def
ä½œè€…: @Cursor
åˆ†æ”¯: feature/user-login
åˆ é™¤: 15ä¸ªå‡½æ•°/ç±»

åŸå› : PRDæœªæˆæƒåˆ é™¤

å·²å›æ»šåˆ°: def456abc

è¯·ä¿®æ”¹PRDåé‡æ–°æäº¤ã€‚
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART5-ç¬¬äº”é“é˜²çº¿è‡ªåŠ¨å›æ»š](./AI-WORKFLOW-V4-PART5-COMPLIANCE.md#7-ç¬¬äº”é“é˜²çº¿è‡ªåŠ¨å›æ»šæœºåˆ¶)

---

## Q24: ç¡®ä¿Cursoråœ¨Bugä¿®å¤æ—¶éµå¾ªPRDé€»è¾‘

**é—®é¢˜**: å¦‚ä½•ç¡®ä¿Cursoråœ¨Bugä¿®å¤å’Œæ–°åŠŸèƒ½å¼€å‘æ—¶ä¸€è‡´éµå¾ªPRDé€»è¾‘ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **PRDä½œä¸ºå”¯ä¸€çœŸç†æ¥æº**

### æ ¸å¿ƒåŸåˆ™

```
PRD = å”¯ä¸€çœŸç†æ¥æº (Single Source of Truth)
æ‰€æœ‰ä»£ç å˜æ›´ï¼ˆBugä¿®å¤ã€æ–°åŠŸèƒ½ã€é‡æ„ï¼‰éƒ½å¿…é¡»ç¬¦åˆPRD
```

### Bugä¿®å¤æµç¨‹

```mermaid
graph TB
    Bug[å‘ç°Bug] --> Analysis{BugåŸå› }

    Analysis -->|PRDå®šä¹‰é”™è¯¯| FixPRD[ä¿®æ”¹PRD]
    Analysis -->|å®ç°é”™è¯¯| FixCode[ä¿®æ”¹ä»£ç ]

    FixPRD --> UpdateVersion[PRDç‰ˆæœ¬+1]
    UpdateVersion --> Regenerate[é‡æ–°ç”ŸæˆTask-Masterä»»åŠ¡]
    Regenerate --> FixCode

    FixCode --> WriteTest[ç¼–å†™å›å½’æµ‹è¯•]
    WriteTest --> RunTest{æµ‹è¯•é€šè¿‡?}
    RunTest -->|å¦| FixCode
    RunTest -->|æ˜¯| VerifyPRD{ç¬¦åˆPRDé€»è¾‘?}

    VerifyPRD -->|å¦| RevertCode[å›é€€ä»£ç ]
    RevertCode --> FixCode
    VerifyPRD -->|æ˜¯| Commit[æäº¤ä»£ç ]

    style RevertCode fill:#ff6b6b
    style Commit fill:#51cf66
```

### Pre-commité€»è¾‘éªŒè¯

```python
# scripts/compliance/verify_prd_logic.py

def verify_code_matches_prd(req_id, modified_files):
    """éªŒè¯ä»£ç ä¿®æ”¹æ˜¯å¦ç¬¦åˆPRDé€»è¾‘"""

    # 1. è¯»å–PRD
    prd = read_prd(req_id)

    # 2. æå–PRDä¸­çš„ä¸šåŠ¡é€»è¾‘
    business_rules = extract_business_rules(prd)

    # 3. åˆ†æä»£ç ä¿®æ”¹
    code_changes = analyze_code_changes(modified_files)

    # 4. éªŒè¯æ˜¯å¦è¿åä¸šåŠ¡è§„åˆ™
    violations = []
    for rule in business_rules:
        if violates_rule(code_changes, rule):
            violations.append(rule)

    if violations:
        print("âŒ ä»£ç ä¿®æ”¹è¿åPRDä¸šåŠ¡é€»è¾‘:")
        for violation in violations:
            print(f"   â€¢ {violation}")
        print("\nğŸ’¡ è¯·ä¿®æ”¹ä»£ç æˆ–æ›´æ–°PRD")
        return False

    return True
```

### Cursorè§„åˆ™å¼ºåŒ–

```yaml
# .cursorrules

- name: always-follow-prd
  trigger: "æ‰€æœ‰ä»£ç ä¿®æ”¹"
  system_prompt: |
    åœ¨ä¿®æ”¹ä»£ç æ—¶ï¼ˆæ— è®ºæ˜¯æ–°åŠŸèƒ½ã€Bugä¿®å¤è¿˜æ˜¯é‡æ„ï¼‰ï¼Œä½ å¿…é¡»ï¼š

    1. å…ˆé˜…è¯»å¯¹åº”çš„PRD
    2. ç¡®è®¤ä½ çš„ä¿®æ”¹ç¬¦åˆPRDä¸­çš„ä¸šåŠ¡é€»è¾‘
    3. å¦‚æœPRDæœ‰é”™è¯¯ï¼Œå…ˆä¿®æ”¹PRD
    4. å¦‚æœPRDç¼ºå°‘ç»†èŠ‚ï¼Œå…ˆå®Œå–„PRD

    PRDæ˜¯å”¯ä¸€çš„çœŸç†æ¥æºï¼Œä»»ä½•ä»£ç ä¿®æ”¹éƒ½ä¸èƒ½è¿åPRDã€‚
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART1-éœ€æ±‚ç¬¬ä¸€åŸåˆ™](./AI-WORKFLOW-V4-PART1-ARCH.md#11-éœ€æ±‚ç¬¬ä¸€åŸåˆ™-requirement-first)

---

## Q25: ä»£ç æ–‡ä»¶ä¸æµ‹è¯•æ–‡ä»¶çš„TDDå…³è”

**é—®é¢˜**: å¦‚ä½•å…³è”ä»£ç æ–‡ä»¶ä¸æµ‹è¯•æ–‡ä»¶ï¼Œç¡®ä¿TDDæ‰§è¡Œï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **PRDå…ƒæ•°æ® + Pre-commitéªŒè¯**

### PRDå…ƒæ•°æ®å…³è”

```yaml
# REQ-2025-001-user-login.md

test_files:
  - backend/tests/unit/test_user_login.py
  - backend/tests/integration/test_user_authentication.py
  - e2e/tests/test-user-login.spec.ts

implementation_files:
  - backend/apps/users/models.py
  - backend/apps/users/views.py
  - backend/apps/users/serializers.py
```

### Pre-commitéªŒè¯æµç¨‹

```python
# scripts/compliance/check_test_files.py

def check_test_files(modified_files):
    """æ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”çš„æµ‹è¯•æ–‡ä»¶"""

    code_files = [f for f in modified_files if is_code_file(f)]

    for code_file in code_files:
        # 1. æŸ¥æ‰¾å…³è”çš„PRD
        prd = find_prd_for_file(code_file)

        if not prd:
            print(f"âŒ ä»£ç æ–‡ä»¶æœªå…³è”åˆ°PRD: {code_file}")
            return False

        # 2. è·å–PRDä¸­å®šä¹‰çš„æµ‹è¯•æ–‡ä»¶
        test_files = prd.metadata['test_files']

        # 3. æ£€æŸ¥æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        missing_tests = [f for f in test_files if not os.path.exists(f)]

        if missing_tests:
            print(f"âŒ ç¼ºå°‘æµ‹è¯•æ–‡ä»¶: {', '.join(missing_tests)}")
            print(f"ğŸ’¡ PRDå®šä¹‰äº†æµ‹è¯•æ–‡ä»¶ï¼Œä½†æ–‡ä»¶ä¸å­˜åœ¨")
            return False

    return True
```

### TDDå·¥ä½œæµå¼ºåˆ¶æ‰§è¡Œ

```
1. Cursorç¼–å†™æµ‹è¯•æ–‡ä»¶ (backend/tests/unit/test_user_login.py)
  â†“
2. è¿è¡Œæµ‹è¯•ï¼Œç¡®è®¤å¤±è´¥ï¼ˆçº¢è‰²ï¼‰
  â†“
3. Cursorç¼–å†™ä»£ç æ–‡ä»¶ (backend/apps/users/views.py)
  â†“
4. è¿è¡Œæµ‹è¯•ï¼Œç¡®è®¤é€šè¿‡ï¼ˆç»¿è‰²ï¼‰
  â†“
5. Pre-commitéªŒè¯:
   âœ… æµ‹è¯•æ–‡ä»¶å­˜åœ¨
   âœ… ä»£ç æ–‡ä»¶å­˜åœ¨
   âœ… æµ‹è¯•é€šè¿‡
  â†“
6. å…è®¸æäº¤
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART4-TDDå·¥ä½œæµ](./AI-WORKFLOW-V4-PART4-TDD-TEST.md#4-tddå·¥ä½œæµ)
- [PART4-æµ‹è¯•æ–‡ä»¶ä¸ä»£ç æ–‡ä»¶å…³è”](./AI-WORKFLOW-V4-PART4-TDD-TEST.md#5-æµ‹è¯•æ–‡ä»¶ä¸ä»£ç æ–‡ä»¶å…³è”)

---

## Q26: Post-commit Hookçš„å®ç°

**é—®é¢˜**: Post-commit Hookåº”è¯¥åšä»€ä¹ˆï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: **å®¡è®¡æ—¥å¿— + çŠ¶æ€åŒæ­¥ + æ£€æµ‹è¿è§„**

### Post-commit HookèŒè´£

1. **è®°å½•å®¡è®¡æ—¥å¿—**: æ‰€æœ‰æäº¤éƒ½è®°å½•
2. **åŒæ­¥ä»»åŠ¡çŠ¶æ€**: æ›´æ–°Task-Masterä»»åŠ¡çŠ¶æ€
3. **æ›´æ–°PRDå…ƒæ•°æ®**: è®°å½•æäº¤åˆ°PRD
4. **æ£€æµ‹è¿è§„æ“ä½œ**: æµ‹è¯•æ–‡ä»¶åˆ é™¤ã€åŠŸèƒ½åˆ é™¤

### å®Œæ•´å®ç°

```bash
# .githooks/post-commit

#!/bin/bash

COMMIT_SHA=$(git rev-parse HEAD)
COMMIT_MSG=$(git log -1 --pretty=%B)
COMMIT_AUTHOR=$(git log -1 --pretty=%an)
COMMIT_DATE=$(git log -1 --pretty=%ci)

echo "ğŸ“ æ‰§è¡ŒPost-commitæ“ä½œ..."

# 1. è®°å½•å®¡è®¡æ—¥å¿—
echo "1/4 è®°å½•å®¡è®¡æ—¥å¿—..."
python scripts/compliance/log_commit.py \
    --commit-sha "$COMMIT_SHA" \
    --commit-msg "$COMMIT_MSG" \
    --author "$COMMIT_AUTHOR" \
    --date "$COMMIT_DATE"

# 2. åŒæ­¥ä»»åŠ¡çŠ¶æ€
echo "2/4 åŒæ­¥ä»»åŠ¡çŠ¶æ€..."
if echo "$COMMIT_MSG" | grep -qE '^\[REQ-'; then
    REQ_ID=$(echo "$COMMIT_MSG" | sed -E 's/^\[([^]]+)\].*/\1/')
    TASK_ID=$(echo "$COMMIT_MSG" | sed -E 's/.*Task-([0-9]+).*/\1/')
    SUBTASK_ID=$(echo "$COMMIT_MSG" | sed -E 's/.*Subtask-([0-9]+).*/\1/')

    if [ -n "$SUBTASK_ID" ]; then
        python scripts/task-master/sync_status.py \
            --req-id "$REQ_ID" \
            --task-id "task-$TASK_ID" \
            --subtask-id "subtask-$SUBTASK_ID" \
            --status completed \
            --commit-sha "$COMMIT_SHA"
    fi
fi

# 3. æ£€æŸ¥æµ‹è¯•æ–‡ä»¶åˆ é™¤
echo "3/4 æ£€æŸ¥æµ‹è¯•æ–‡ä»¶åˆ é™¤..."
DELETED_TESTS=$(git diff --name-status HEAD~1 HEAD | grep "^D" | grep -E "test_|test-")

if [ -n "$DELETED_TESTS" ]; then
    echo "âš ï¸ æ£€æµ‹åˆ°åˆ é™¤æµ‹è¯•æ–‡ä»¶:"
    echo "$DELETED_TESTS"

    # æ£€æŸ¥æˆæƒ
    for test_file in $DELETED_TESTS; do
        AUTHORIZED=$(python scripts/compliance/check_test_deletion_authorized.py "$test_file" "$REQ_ID")

        if [ "$AUTHORIZED" != "true" ]; then
            echo "âŒ æœªç»æˆæƒåˆ é™¤æµ‹è¯•æ–‡ä»¶: $test_file"

            # è®°å½•åˆ°å®¡è®¡æ—¥å¿—
            python scripts/compliance/log_unauthorized_deletion.py \
                --file "$test_file" \
                --commit-sha "$COMMIT_SHA" \
                --type "test"
        fi
    done
fi

# 4. æ›´æ–°PRDå…ƒæ•°æ®
echo "4/4 æ›´æ–°PRDå…ƒæ•°æ®..."
if echo "$COMMIT_MSG" | grep -qE '^\[REQ-'; then
    python scripts/compliance/update_prd_commits.py \
        --req-id "$REQ_ID" \
        --commit-sha "$COMMIT_SHA"
fi

echo "âœ… Post-commitæ“ä½œå®Œæˆ"
exit 0
```

### å®¡è®¡æ—¥å¿—æ ¼å¼

```json
{
  "timestamp": "2025-10-24T15:30:00Z",
  "commit_sha": "abc123def",
  "commit_msg": "[REQ-2025-001-user-login] Task-1 Subtask-2 å®ç°ç™»å½•API",
  "author": "Cursor",
  "req_id": "REQ-2025-001-user-login",
  "task_id": "task-1",
  "subtask_id": "subtask-2",
  "type": "commit"
}
```

**æ–‡æ¡£å‚è€ƒ**:

- [PART5-ç¬¬ä¸‰é“é˜²çº¿Post-commit Hook](./AI-WORKFLOW-V4-PART5-COMPLIANCE.md#5-ç¬¬ä¸‰é“é˜²çº¿post-commit-hook)

---

## æ€»ç»“

æœ¬é™„å½•è¯¦ç»†è§£ç­”äº†26ä¸ªæ ¸å¿ƒé—®é¢˜ï¼Œæ¶µç›–ï¼š

1. **ä»»åŠ¡ç®¡ç†**: Task-Masterå‘½åã€ç›®å½•ç»“æ„ã€è§’è‰²åˆ†å·¥ã€è·¨ç”µè„‘åä½œ
2. **éœ€æ±‚ç®¡ç†**: PRDç²¾åŒ–ã€å…ƒæ•°æ®å¼ºåˆ¶ã€å†…å®¹è¦æ±‚ã€åˆ é™¤ä¿æŠ¤ã€ä¿®æ”¹ç­–ç•¥
3. **æµ‹è¯•é©±åŠ¨**: ç›®å½•å¼ºåˆ¶ã€TDDå·¥ä½œæµã€æµ‹è¯•éªŒè¯ã€é˜²æ­¢è·³è¿‡æµ‹è¯•
4. **è´¨é‡ä¿éšœ**: åŠŸèƒ½åˆ é™¤æ‹¦æˆªã€è‡ªåŠ¨å›æ»šã€PRDé€»è¾‘éªŒè¯ã€å¥‘çº¦æµ‹è¯•
5. **å·¥å…·é›†æˆ**: Commit Hookå®ç°ã€å®¡è®¡æ—¥å¿—ã€çŠ¶æ€åŒæ­¥ã€CI/CDéªŒè¯

**æ‰€æœ‰é—®é¢˜çš„è§£å†³æ–¹æ¡ˆéƒ½å·²åœ¨V4æ¶æ„ä¸­å®Œæ•´å®ç°ï¼Œå…·æœ‰å¯è½åœ°æ€§å’Œå¯æ“ä½œæ€§ã€‚**

**å®Œæ•´æ–‡æ¡£**: è¯·å‚é˜… [AI-WORKFLOW-V4-README.md](./AI-WORKFLOW-V4-README.md) å¼€å§‹ä½¿ç”¨ã€‚

---

**ğŸ“ æ¨¡å‹ä¿¡æ¯**: æœ¬æ–‡æ¡£ç”± **Claude Sonnet 4.5** ç”Ÿæˆï¼Œç¡®ä¿é«˜è´¨é‡å’Œè¯¦ç»†æ€§ã€‚
