# Bravo 项目数据库命名约定

## 概述

本文档定义了 Bravo 项目中数据库相关的命名规范，包括表名、字段名、索引、约束等的命名规则，确保数据库结构的一致性和可维护性。

## 1. 通用原则

### 1.1 基本规则

- 全部使用小写字母
- 使用下划线 `_` 分隔单词
- 避免使用保留字和特殊字符
- 保持名称简洁且具有描述性
- 使用英文单词，避免拼音或缩写

### 1.2 长度限制

- 表名：不超过 63 个字符（PostgreSQL 限制）
- 字段名：不超过 63 个字符
- 索引名：不超过 63 个字符
- 约束名：不超过 63 个字符

## 2. 表命名规范

### 2.1 基本命名规则

- 使用复数形式表示集合
- 避免使用前缀或后缀（除非必要）
- 使用业务领域词汇

**示例：**

```sql
-- 正确示例
users                    -- 用户表
blog_posts              -- 博客文章表
categories              -- 分类表
tags                    -- 标签表
user_profiles           -- 用户档案表

-- 错误示例
user                    -- 应该是复数
blogPost                -- 应该使用下划线分隔
tbl_users               -- 不需要 tbl_ 前缀
users_table             -- 不需要 _table 后缀
```

### 2.2 关联表命名

- 使用连接两个表名的方式
- 按字母顺序排列表名
- 使用下划线连接

**示例：**

```sql
-- 正确示例
blog_post_tags          -- 博客文章和标签的关联表
user_roles              -- 用户和角色的关联表
product_categories      -- 产品和分类的关联表

-- 错误示例
tags_blog_posts         -- 顺序错误
userRole                -- 格式错误
product_category        -- 应该是复数形式
```

### 2.3 历史表和日志表

- 历史表：在表名后加 `_history`
- 日志表：在表名后加 `_logs`
- 审计表：在表名后加 `_audit`

**示例：**

```sql
users_history           -- 用户历史记录表
blog_posts_logs         -- 博客文章操作日志表
user_actions_audit      -- 用户行为审计表
```

## 3. 字段命名规范

### 3.1 基本字段命名

- 使用小写加下划线
- 避免使用数据类型作为后缀
- 布尔字段使用 `is_`、`has_`、`can_` 前缀

**示例：**

```sql
-- 正确示例
first_name              -- 名字
created_at              -- 创建时间
is_active               -- 是否激活
has_permission          -- 是否有权限
can_edit                -- 是否可以编辑

-- 错误示例
firstName               -- 应该使用下划线
createdAt               -- 应该使用下划线
active                  -- 布尔值应该使用前缀
permission              -- 布尔值应该使用前缀
```

### 3.2 外键字段命名

- 使用 `表名单数_id` 的格式
- 保持与关联表名的一致性

**示例：**

```sql
-- 正确示例
user_id                 -- 关联到 users 表
category_id             -- 关联到 categories 表
parent_id               -- 自关联的父级 ID

-- 错误示例
userid                  -- 缺少下划线
userId                  -- 应该使用下划线
user_ref                -- 应该使用 _id 后缀
```

### 3.3 时间字段命名

- 创建时间：`created_at`
- 更新时间：`updated_at`
- 删除时间：`deleted_at`（软删除）
- 开始时间：`started_at`
- 结束时间：`ended_at`

### 3.4 状态字段命名

- 状态：`status`
- 类型：`type`
- 优先级：`priority`
- 排序：`sort_order`

## 4. 索引命名规范

### 4.1 索引命名格式

- 主键索引：`pk_表名`
- 唯一索引：`uq_表名_字段名`
- 普通索引：`idx_表名_字段名`
- 复合索引：`idx_表名_字段1_字段2`

**示例：**

```sql
-- 主键索引
pk_users                -- users 表的主键索引
pk_blog_posts           -- blog_posts 表的主键索引

-- 唯一索引
uq_users_email          -- users 表 email 字段的唯一索引
uq_blog_posts_slug      -- blog_posts 表 slug 字段的唯一索引

-- 普通索引
idx_users_created_at    -- users 表 created_at 字段的索引
idx_blog_posts_status   -- blog_posts 表 status 字段的索引

-- 复合索引
idx_blog_posts_status_created_at  -- blog_posts 表 status 和 created_at 的复合索引
idx_users_status_role   -- users 表 status 和 role 的复合索引
```

## 5. 约束命名规范

### 5.1 约束命名格式

- 主键约束：`pk_表名`
- 唯一约束：`uq_表名_字段名`
- 外键约束：`fk_表名_关联表名`
- 检查约束：`ck_表名_条件`

**示例：**

```sql
-- 主键约束
pk_users                -- users 表的主键约束

-- 唯一约束
uq_users_email          -- users 表 email 字段的唯一约束

-- 外键约束
fk_blog_posts_user_id   -- blog_posts 表 user_id 字段的外键约束
fk_user_roles_role_id   -- user_roles 表 role_id 字段的外键约束

-- 检查约束
ck_users_status         -- users 表 status 字段的检查约束
ck_blog_posts_publish_date -- blog_posts 表 publish_date 字段的检查约束
```

## 6. 序列命名规范

### 6.1 序列命名格式

- 使用 `表名_字段名_seq` 的格式

**示例：**

```sql
users_id_seq            -- users 表 id 字段的序列
blog_posts_id_seq       -- blog_posts 表 id 字段的序列
```

## 7. 视图命名规范

### 7.1 视图命名格式

- 使用 `vw_前缀` 或业务描述
- 使用复数形式

**示例：**

```sql
vw_active_users         -- 活跃用户视图
vw_published_blog_posts -- 已发布博客文章视图
vw_user_statistics      -- 用户统计视图
```

## 8. 存储过程和函数命名

### 8.1 存储过程命名

- 使用 `sp_前缀` 加动词和描述
- 使用小写加下划线

**示例：**

```sql
sp_calculate_user_score   -- 计算用户积分
sp_update_blog_stats      -- 更新博客统计信息
```

### 8.2 函数命名

- 使用 `fn_前缀` 加描述
- 使用小写加下划线

**示例：**

```sql
fn_get_user_full_name     -- 获取用户全名
fn_check_user_permission  -- 检查用户权限
```

## 9. 触发器命名规范

### 9.1 触发器命名格式

- 使用 `trg_前缀` 加表名和操作类型

**示例：**

```sql
trg_users_insert          -- users 表插入触发器
trg_blog_posts_update     -- blog_posts 表更新触发器
trg_users_delete          -- users 表删除触发器
```

## 10. Django 特定约定

### 10.1 模型字段命名

- 遵循 Django ORM 的命名规范
- 使用 verbose_name 提供中文描述

**示例：**

```python
class User(models.Model):
    first_name = models.CharField(max_length=50, verbose_name='名字')
    last_name = models.CharField(max_length=50, verbose_name='姓氏')
    email = models.EmailField(unique=True, verbose_name='邮箱')
    is_active = models.BooleanField(default=True, verbose_name='是否激活')
    created_at = models.DateTimeField(auto_now_add=True, verbose_name='创建时间')
    updated_at = models.DateTimeField(auto_now=True, verbose_name='更新时间')
```

### 10.2 模型 Meta 类

- 使用 verbose_name 和 verbose_name_plural 提供中文描述

**示例：**

```python
class BlogPost(models.Model):
    # 字段定义...

    class Meta:
        db_table = 'blog_posts'
        verbose_name = '博客文章'
        verbose_name_plural = '博客文章'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['status', 'created_at'], name='idx_blog_posts_status_created'),
            models.Index(fields=['author', 'status'], name='idx_blog_posts_author_status'),
        ]
```

## 11. 迁移文件命名

### 11.1 迁移文件命名

- Django 自动生成，遵循时间戳格式
- 手动创建的迁移文件使用描述性名称

## 12. 检查工具配置

### 12.1 Django 检查

- 使用 `python manage.py check` 检查模型定义
- 使用 `python manage.py makemigrations --check` 检查迁移文件

### 12.2 数据库检查

- 使用 `python manage.py dbshell` 检查数据库结构
- 使用 `python manage.py showmigrations` 检查迁移状态

## 13. 实施指南

### 13.1 开发流程

1. 设计数据库结构时遵循本规范
2. 创建模型时按照命名规范定义字段
3. 运行 `python manage.py makemigrations` 生成迁移文件
4. 运行 `python manage.py migrate` 应用迁移
5. 使用 `python manage.py dbshell` 验证数据库结构

### 13.2 代码审查

- 检查表名和字段名是否符合规范
- 检查索引和约束命名是否正确
- 检查 Django 模型定义是否符合规范

### 13.3 自动化检查

- 在 CI/CD 流程中添加数据库结构检查
- 使用 Django 的 system checks 验证模型定义
- 使用数据库工具验证命名规范

## 14. 常见错误示例

### 14.1 表名错误

```sql
-- 错误
User                    -- 应该使用复数
user                    -- 应该使用复数
TblUser                 -- 不需要前缀
UsersTable              -- 不需要后缀

-- 正确
users
```

### 14.2 字段名错误

```sql
-- 错误
FirstName               -- 应该使用下划线
firstName               -- 应该使用下划线
userNameString          -- 不需要数据类型后缀
isActiveFlag            -- 不需要 flag 后缀

-- 正确
first_name
user_name
is_active
```

### 14.3 索引名错误

```sql
-- 错误
index_users_email       -- 应该使用 idx_ 前缀
users_email_index       -- 应该使用 idx_ 前缀
email_index             -- 缺少表名

-- 正确
idx_users_email
```

## 15. 参考文档

- [PostgreSQL Naming Conventions](https://www.postgresql.org/docs/current/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS)
- [Django Model Field Reference](https://docs.djangoproject.com/en/stable/ref/models/fields/)
- [PEP 8 - Style Guide for Python Code](https://peps.python.org/pep-0008/)
- [Database Naming Conventions Best Practices](https://launchbylunch.com/posts/2014/Feb/16/sql-naming-conventions/)
