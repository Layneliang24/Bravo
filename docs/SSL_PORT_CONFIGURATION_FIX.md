# SSLå’Œç«¯å£é…ç½®é—®é¢˜ä¿®å¤æŠ¥å‘Š

## ğŸ” é—®é¢˜å‘ç°

### ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜

1. **å¼€å‘devç¯å¢ƒç½‘ç«™æ€»æ˜¯æç¤ºä¸å®‰å…¨**
2. **è®¿é—®å¼€å‘devç½‘ç«™æ˜¯å¦éœ€è¦å¸¦ç«¯å£8443ï¼Ÿ**
3. **ç”Ÿäº§å’Œå¼€å‘ç½‘ç«™çš„è·¯ç”±è·³è½¬æ˜¯å¦æ­£å¸¸ï¼Ÿ**

---

## ğŸ› æ ¹æœ¬åŸå› åˆ†æ

### é—®é¢˜è¯Šæ–­è¿‡ç¨‹

#### 1. åˆæ­¥æ£€æŸ¥

- âœ… å®¹å™¨è¿è¡Œæ­£å¸¸
- âœ… SSLè¯ä¹¦å­˜åœ¨ä¸”æœ‰æ•ˆï¼ˆLet's Encryptè¯ä¹¦ï¼‰
- âœ… è¯ä¹¦æ–‡ä»¶æƒé™æ­£ç¡®
- âœ… Nginxé…ç½®è¯­æ³•æ­£ç¡®

#### 2. è®¿é—®æµ‹è¯•

- âœ… å®¹å™¨å†…éƒ¨è®¿é—® `https://127.0.0.1:8443` - **æˆåŠŸ**
- âŒ æœåŠ¡å™¨æœ¬åœ°è®¿é—® `https://localhost:8443` - **SSLæ¡æ‰‹å¤±è´¥**
- âŒ å¤–éƒ¨è®¿é—® `https://dev.layneliang.com:8443` - **è¿æ¥è¢«æ‹’ç»**
- âŒ IPç›´æ¥è®¿é—® `https://8.129.16.190:8443` - **SSLæ¡æ‰‹å¤±è´¥**

#### 3. ç«¯å£é…ç½®æ£€æŸ¥

**Dockerç«¯å£æ˜ å°„**ï¼š

```bash
80/tcp -> 0.0.0.0:8080    # å®¹å™¨å†…80ç«¯å£ â†’ å®¿ä¸»æœº8080ç«¯å£
443/tcp -> 0.0.0.0:8443   # å®¹å™¨å†…443ç«¯å£ â†’ å®¿ä¸»æœº8443ç«¯å£
```

**å®¹å™¨å†…Nginxå®é™…ç›‘å¬**ï¼š

```bash
tcp  0.0.0.0:8080   LISTEN  nginx    # âŒ é”™è¯¯ï¼ç›‘å¬8080
tcp  0.0.0.0:8443   LISTEN  nginx    # âŒ é”™è¯¯ï¼ç›‘å¬8443
```

**Nginxé…ç½®æ–‡ä»¶**ï¼š

```nginx
listen 8080;   # âŒ é”™è¯¯ï¼åº”è¯¥ç›‘å¬80
listen 8443 ssl http2;  # âŒ é”™è¯¯ï¼åº”è¯¥ç›‘å¬443
```

### ğŸ¯ æ ¹æœ¬åŸå› 

**ç«¯å£æ˜ å°„ä¸åŒ¹é…**ï¼š

- Dockerå°†å®¹å™¨å†…çš„**80ç«¯å£**æ˜ å°„åˆ°å®¿ä¸»æœº8080
- Dockerå°†å®¹å™¨å†…çš„**443ç«¯å£**æ˜ å°„åˆ°å®¿ä¸»æœº8443
- ä½†Nginxé…ç½®ç›‘å¬å®¹å™¨å†…çš„**8080å’Œ8443ç«¯å£**ï¼ˆæœªè¢«æ˜ å°„ï¼‰
- å¯¼è‡´å®¿ä¸»æœºçš„8080å’Œ8443ç«¯å£æ— æ³•è¿æ¥åˆ°Nginx

```
âŒ é”™è¯¯çš„é…ç½®æµç¨‹ï¼š
ç”¨æˆ·è®¿é—® 8.129.16.190:8443
  â†“ Dockeræ˜ å°„
å®¹å™¨å†… 443 ç«¯å£ï¼ˆæ— æœåŠ¡ç›‘å¬ï¼‰
  â†“
è¿æ¥å¤±è´¥

Nginxå®é™…ç›‘å¬å®¹å™¨å†…8443ç«¯å£ï¼ˆæœªæ˜ å°„åˆ°å®¿ä¸»æœºï¼‰
```

```
âœ… æ­£ç¡®çš„é…ç½®æµç¨‹ï¼š
ç”¨æˆ·è®¿é—® 8.129.16.190:8443
  â†“ Dockeræ˜ å°„
å®¹å™¨å†… 443 ç«¯å£
  â†“
Nginxç›‘å¬ 443 ç«¯å£
  â†“
æœåŠ¡å“åº”
```

---

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹çš„æ–‡ä»¶

- `frontend/nginx.domain-dev.conf` - å¼€å‘ç¯å¢ƒNginxé…ç½®

### ä¿®å¤å†…å®¹

#### å¼€å‘ç¯å¢ƒ (dev.layneliang.com)

**ä¿®æ”¹å‰**ï¼š

```nginx
server {
    listen 8080;  # âŒ é”™è¯¯
    server_name dev.layneliang.com;
    location / {
        return 301 https://$server_name$request_uri;
    }
}

server {
    listen 8443 ssl http2;  # âŒ é”™è¯¯
    server_name dev.layneliang.com;
    # ...
}
```

**ä¿®æ”¹å**ï¼š

```nginx
server {
    listen 80;   # âœ… æ­£ç¡® - å®¹å™¨å†…80ç«¯å£
    server_name dev.layneliang.com;
    location / {
        return 301 https://$server_name:8443$request_uri;  # é‡å®šå‘æ—¶å¸¦ç«¯å£å·
    }
}

server {
    listen 443 ssl http2;  # âœ… æ­£ç¡® - å®¹å™¨å†…443ç«¯å£
    server_name dev.layneliang.com;
    # ...
}
```

---

## ğŸ“ è®¿é—®æ–¹å¼è¯´æ˜

### å¼€å‘ç¯å¢ƒ (Dev)

**æ­£ç¡®çš„è®¿é—®æ–¹å¼**ï¼š

- ğŸŒ HTTP: `http://dev.layneliang.com:8080` â†’ è‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
- ğŸ” HTTPS: `https://dev.layneliang.com:8443` â† **æ¨èä½¿ç”¨**

**ä¸ºä»€ä¹ˆéœ€è¦å¸¦ç«¯å£ï¼Ÿ**

- å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒå…±ç”¨åŒä¸€æœåŠ¡å™¨
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ ‡å‡†ç«¯å£ï¼ˆ80/443ï¼‰
- å¼€å‘ç¯å¢ƒä½¿ç”¨éæ ‡å‡†ç«¯å£ï¼ˆ8080/8443ï¼‰é¿å…å†²çª

### ç”Ÿäº§ç¯å¢ƒ (Prod)

**æ­£ç¡®çš„è®¿é—®æ–¹å¼**ï¼š

- ğŸŒ HTTP: `http://layneliang.com` â†’ è‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
- ğŸ” HTTPS: `https://layneliang.com` â† **æ¨èä½¿ç”¨**

**ä¸éœ€è¦å¸¦ç«¯å£**ï¼š

- ä½¿ç”¨æ ‡å‡†HTTPSç«¯å£443
- æµè§ˆå™¨é»˜è®¤ä½¿ç”¨443ç«¯å£

---

## âœ… éªŒè¯æ­¥éª¤

### éƒ¨ç½²åéªŒè¯

1. **æ£€æŸ¥å®¹å™¨å†…ç›‘å¬ç«¯å£**ï¼š

   ```bash
   docker exec bravo-dev-frontend netstat -tlnp | grep nginx
   # åº”è¯¥çœ‹åˆ°ç›‘å¬80å’Œ443ç«¯å£
   ```

2. **æµ‹è¯•HTTPè®¿é—®ï¼ˆåº”è‡ªåŠ¨é‡å®šå‘ï¼‰**ï¼š

   ```bash
   curl -I http://dev.layneliang.com:8080
   # åº”è¯¥è¿”å› 301 é‡å®šå‘åˆ° https://dev.layneliang.com:8443
   ```

3. **æµ‹è¯•HTTPSè®¿é—®**ï¼š

   ```bash
   curl -I https://dev.layneliang.com:8443
   # åº”è¯¥è¿”å› 200 OK
   ```

4. **æµè§ˆå™¨æµ‹è¯•**ï¼š
   - è®¿é—® `https://dev.layneliang.com:8443`
   - âœ… åº”è¯¥æ˜¾ç¤ºå®‰å…¨è¿æ¥ï¼ˆç»¿è‰²é”å›¾æ ‡ï¼‰
   - âœ… è¯ä¹¦åº”è¯¥æ˜¯Let's Encrypté¢å‘
   - âœ… é¡µé¢æ­£å¸¸åŠ è½½

---

## ğŸ“ ç»éªŒæ€»ç»“

### Dockerå®¹å™¨ç«¯å£æ˜ å°„åŸåˆ™

1. **å®¹å™¨å†…åº”ä½¿ç”¨æ ‡å‡†ç«¯å£**ï¼š

   - WebæœåŠ¡ï¼š80 (HTTP), 443 (HTTPS)
   - æ•°æ®åº“ï¼š3306 (MySQL), 6379 (Redis)

2. **é€šè¿‡Dockeræ˜ å°„æ”¹å˜å¤–éƒ¨ç«¯å£**ï¼š

   ```yaml
   ports:
     - "8080:80" # å®¿ä¸»æœº8080 â†’ å®¹å™¨80
     - "8443:443" # å®¿ä¸»æœº8443 â†’ å®¹å™¨443
   ```

3. **Nginxé…ç½®åº”ç›‘å¬å®¹å™¨å†…æ ‡å‡†ç«¯å£**ï¼š
   ```nginx
   listen 80;      # ä¸æ˜¯ listen 8080;
   listen 443 ssl; # ä¸æ˜¯ listen 8443 ssl;
   ```

### SSLè¯ä¹¦é…ç½®è¦ç‚¹

1. âœ… è¯ä¹¦æ–‡ä»¶å¿…é¡»æŒ‚è½½åˆ°å®¹å™¨
2. âœ… è¯ä¹¦è·¯å¾„å¿…é¡»åœ¨Nginxé…ç½®ä¸­æ­£ç¡®
3. âœ… ç§é’¥æƒé™å¿…é¡»æ­£ç¡®ï¼ˆ600æˆ–644ï¼‰
4. âœ… Nginxè¿›ç¨‹å¿…é¡»æœ‰æƒé™è¯»å–è¯ä¹¦

### HTTPåˆ°HTTPSé‡å®šå‘

**å¼€å‘ç¯å¢ƒï¼ˆéæ ‡å‡†ç«¯å£ï¼‰**ï¼š

```nginx
return 301 https://$server_name:8443$request_uri;  # éœ€è¦å¸¦ç«¯å£å·
```

**ç”Ÿäº§ç¯å¢ƒï¼ˆæ ‡å‡†ç«¯å£ï¼‰**ï¼š

```nginx
return 301 https://$server_name$request_uri;  # ä¸éœ€è¦ç«¯å£å·
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åŸŸåé…ç½®å¿«é€Ÿå¼€å§‹](./DOMAIN_QUICK_START.md)
- [åŸŸåé…ç½®å®Œæ•´æŒ‡å—](./DOMAIN_SETUP_GUIDE.md)
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md)

---

**ä¿®å¤æ—¥æœŸ**: 2025-10-19
**ä¿®å¤è€…**: AI Assistant (Claude Sonnet 4.5)
**GitHub Issue**: #[å¾…å¡«å†™]
