name: Setup Fast Environment
description: "Quick environment setup for fast checks"

runs:
  using: "composite"
  steps:
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: "20"

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    - name: Create and Setup Virtual Environment
      shell: bash
      working-directory: ./backend
      run: |
        echo "âš¡ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–..."

        # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        if [ ! -d ".venv" ]; then
          echo "ğŸ“¦ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ..."
          python -m venv .venv
        else
          echo "âœ… è™šæ‹Ÿç¯å¢ƒå·²å­˜åœ¨"
        fi

          # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–
          source .venv/bin/activate
          echo "ğŸ“¥ å®‰è£…å¿…è¦çš„Pythonä¾èµ–..."
          pip install --upgrade pip wheel

          # ğŸ”§ ä¿®å¤ç¼–ç é—®é¢˜ï¼šå¼ºåˆ¶ä½¿ç”¨UTF-8ç¼–ç 
          export PYTHONIOENCODING=utf-8
          export LC_ALL=C.UTF-8
          export LANG=C.UTF-8

          # å°è¯•ä»requirementsæ–‡ä»¶å®‰è£…ï¼Œå¦‚æœå¤±è´¥åˆ™ç›´æ¥å®‰è£…å…³é”®åŒ…
          if pip install -r requirements/test.txt; then
            echo "âœ… ä»requirementsæ–‡ä»¶å®‰è£…æˆåŠŸ"
          else
            echo "âš ï¸ requirementsæ–‡ä»¶å®‰è£…å¤±è´¥ï¼Œç›´æ¥å®‰è£…å…³é”®åŒ…..."
            pip install flake8==6.0.0 django-debug-toolbar==4.2.0 django-extensions==3.2.3 celery==5.3.4 Django==4.2.13 mysqlclient || echo "éƒ¨åˆ†ä¾èµ–å®‰è£…å¤±è´¥ï¼Œç»§ç»­æ‰§è¡Œ"
          fi

        echo "âœ… è™šæ‹Ÿç¯å¢ƒè®¾ç½®å®Œæˆ"
