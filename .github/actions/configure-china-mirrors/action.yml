name: 'Configure China Mirrors'
description: 'é…ç½®å›½å†…é•œåƒæºåŠ é€Ÿï¼ŒåŒ…æ‹¬npmã€pipã€aptã€Dockerç­‰'
runs:
  using: 'composite'
  steps:
    - name: Configure npm China Mirrors and Performance
      shell: bash
      run: |
        echo "ğŸ“¦ é…ç½®npmå›½å†…æºå’Œæ€§èƒ½ä¼˜åŒ–..."
        npm config set registry https://registry.npmmirror.com
        npm config set maxsockets 10
        npm config set network-concurrency 8
        # è®¾ç½®å„ç§å·¥å…·é•œåƒæºï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡æ›¿ä»£åºŸå¼ƒçš„npm configé€‰é¡¹ï¼‰
        echo "NODEJS_ORG_MIRROR=https://npmmirror.com/mirrors/node" >> $GITHUB_ENV
        echo "ELECTRON_MIRROR=https://npmmirror.com/mirrors/electron/" >> $GITHUB_ENV
        echo "PLAYWRIGHT_DOWNLOAD_HOST=https://npmmirror.com/mirrors/playwright/" >> $GITHUB_ENV
        echo "SASS_BINARY_SITE=https://npmmirror.com/mirrors/node-sass/" >> $GITHUB_ENV
        echo "PHANTOMJS_CDNURL=https://npmmirror.com/mirrors/phantomjs/" >> $GITHUB_ENV
        echo "PUPPETEER_DOWNLOAD_HOST=https://npmmirror.com/mirrors" >> $GITHUB_ENV
        echo "PUPPETEER_CHROMIUM_REVISION=119.0.6045.105" >> $GITHUB_ENV
        echo "CHROME_BIN=/usr/bin/google-chrome-stable" >> $GITHUB_ENV
        echo "FIREFOX_BIN=/usr/bin/firefox" >> $GITHUB_ENV

    - name: Configure pip China Mirrors
      shell: bash
      run: |
        echo "ğŸ é…ç½®pipå›½å†…æº..."
        pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple/
        pip config set global.trusted-host pypi.tuna.tsinghua.edu.cn

    - name: Configure apt China Mirrors (safe mode)
      shell: bash
      run: |
        echo "ğŸ“¦ é…ç½®aptå›½å†…æºï¼ˆå®‰å…¨æ¨¡å¼ï¼‰..."
        # åªé…ç½®æºï¼Œä¸ç«‹å³æ›´æ–°ï¼Œé¿å…å¹²æ‰°MySQLæœåŠ¡å¯åŠ¨
        sudo sed -i 's/archive.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list
        sudo sed -i 's/security.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list
        echo "âœ… aptæºå·²é…ç½®ï¼Œå°†åœ¨MySQLå¯åŠ¨åæ›´æ–°"

    - name: Configure Docker China Mirrors
      shell: bash
      run: |
        echo "ğŸ³ é…ç½®Dockerå›½å†…é•œåƒåŠ é€Ÿå™¨..."
        echo "âš ï¸  è·³è¿‡Dockeré‡å¯ä»¥é¿å…æ€æ­»MySQLå®¹å™¨"
        sudo mkdir -p /etc/docker
        echo '{
          "registry-mirrors": [
            "https://registry.docker-cn.com",
            "https://docker.mirrors.ustc.edu.cn",
            "https://hub-mirror.c.163.com"
          ]
        }' | sudo tee /etc/docker/daemon.json > /dev/null
        echo "âœ… Dockeré•œåƒé…ç½®å·²ä¿å­˜ï¼ˆæ— éœ€é‡å¯ï¼‰"

    - name: Complete Configuration
      shell: bash
      run: |
        echo "âœ… å›½å†…é•œåƒæºé…ç½®å®Œæˆ"
        echo "ğŸ“Š é…ç½®æ‘˜è¦:"
        echo "  - npm registry: $(npm config get registry)"
        echo "  - pip index: $(pip config get global.index-url)"
        echo "  - Node.js mirror: $NODEJS_ORG_MIRROR"
        echo "  - Electron mirror: $ELECTRON_MIRROR"
        echo "  - Playwright mirror: $PLAYWRIGHT_DOWNLOAD_HOST"
