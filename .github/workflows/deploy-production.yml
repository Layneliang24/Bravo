name: Deploy to Production

on:
  # åœ¨é•œåƒæ„å»ºå®Œæˆåè‡ªåŠ¨è§¦å‘
  workflow_run:
    workflows: ["ğŸ³ Build and Push Docker Images"]
    types:
      - completed
    branches: [main]
  # ä¿ç•™æ‰‹åŠ¨è§¦å‘é€‰é¡¹
  workflow_dispatch:
    inputs:
      force_deploy:
        description: "å¼ºåˆ¶éƒ¨ç½²"
        required: false
        default: "false"

# ç¡®ä¿åªæœ‰ä¸€ä¸ªéƒ¨ç½²åœ¨è¿è¡Œ
concurrency:
  group: production-deploy
  cancel-in-progress: false

jobs:
  # éƒ¨ç½²å‰æ£€æŸ¥
  pre-deploy:
    name: Pre-deployment Checks
    runs-on: ubuntu-latest
    # åªæœ‰åœ¨é•œåƒæ„å»ºæˆåŠŸæˆ–æ‰‹åŠ¨è§¦å‘æ—¶æ‰æ‰§è¡Œ
    if: ${{ github.event_name == 'workflow_dispatch' || github.event.workflow_run.conclusion == 'success' }}
    outputs:
      should-deploy: ${{ steps.check.outputs.should-deploy }}
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Check if should deploy
        id: check
        run: |
          if [[ "${{ github.event.inputs.force_deploy }}" == "true" ]]; then
            echo "should-deploy=true" >> $GITHUB_OUTPUT
            echo "ğŸš€ å¼ºåˆ¶éƒ¨ç½²è§¦å‘"
          elif [[ "${{ github.event_name }}" == "push" ]]; then
            # æ£€æŸ¥æ˜¯å¦æœ‰å®è´¨æ€§å˜æ›´
            if git diff --quiet HEAD~1 HEAD -- '*.py' '*.js' '*.vue' '*.ts' '*.tsx' 'docker-compose.prod.yml' 'Dockerfile*'; then
              echo "should-deploy=false" >> $GITHUB_OUTPUT
              echo "â„¹ï¸ æ²¡æœ‰å®è´¨æ€§ä»£ç å˜æ›´ï¼Œè·³è¿‡éƒ¨ç½²"
            else
              echo "should-deploy=true" >> $GITHUB_OUTPUT
              echo "âœ… æ£€æµ‹åˆ°ä»£ç å˜æ›´ï¼Œå‡†å¤‡éƒ¨ç½²"
            fi
          else
            echo "should-deploy=false" >> $GITHUB_OUTPUT
          fi

  # ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
  deploy:
    name: Deploy to Production Server
    runs-on: ubuntu-latest
    needs: pre-deploy
    if: needs.pre-deploy.outputs.should-deploy == 'true'
    environment:
      name: production
      url: http://8.129.16.190

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup SSH
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.ALIYUN_SSH_KEY }}

      - name: Get Current Deployment Info
        id: current-version
        env:
          HOST: ${{ secrets.ALIYUN_HOST }}
          USER: ${{ secrets.ALIYUN_USER }}
        run: |
          echo "ğŸ“‹ è·å–å½“å‰éƒ¨ç½²ä¿¡æ¯..."
          CURRENT_INFO=$(ssh -o StrictHostKeyChecking=no $USER@$HOST \
            "cd /home/layne/project/bravo-prod && \
             if [ -f .deployment-current ]; then cat .deployment-current; else echo 'FIRST_DEPLOY=true'; fi" || echo "FIRST_DEPLOY=true")

          echo "å½“å‰éƒ¨ç½²ä¿¡æ¯:"
          echo "$CURRENT_INFO"
          echo "current_info<<EOF" >> $GITHUB_OUTPUT
          echo "$CURRENT_INFO" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Deploy to production server
        id: deploy
        env:
          HOST: ${{ secrets.ALIYUN_HOST }}
          USER: ${{ secrets.ALIYUN_USER }}
          REGISTRY_USERNAME: ${{ secrets.ALIYUN_REGISTRY_USERNAME }}
          REGISTRY_PASSWORD: ${{ secrets.ALIYUN_REGISTRY_PASSWORD }}
        run: |
          ssh -o StrictHostKeyChecking=no \
              -o ServerAliveInterval=30 \
              -o ServerAliveCountMax=30 \
              $USER@$HOST bash -s << 'ENDSSH' "$REGISTRY_USERNAME" "$REGISTRY_PASSWORD"
            set -e

            # æ¥æ”¶å‚æ•°
            REGISTRY_USERNAME="$1"
            REGISTRY_PASSWORD="$2"

          echo "ğŸ“ è¿›å…¥é¡¹ç›®ç›®å½•..."
          cd /home/layne/project/bravo-prod

          # å¤‡ä»½å½“å‰ç‰ˆæœ¬ä¿¡æ¯
          echo "ğŸ’¾ å¤‡ä»½å½“å‰éƒ¨ç½²ä¿¡æ¯..."
          if [ -f .deployment-current ]; then
            # å°†å½“å‰ç‰ˆæœ¬ä¿å­˜ä¸ºä¸Šä¸€ä¸ªç‰ˆæœ¬
            cp .deployment-current .deployment-previous

            # è¯»å–å½“å‰ç‰ˆæœ¬å¹¶å¤‡ä»½é•œåƒ
            CURRENT_BACKEND_IMAGE=$(docker inspect bravo-prod-backend --format='{{.Config.Image}}' 2>/dev/null || echo "none")
            CURRENT_FRONTEND_IMAGE=$(docker inspect bravo-prod-frontend --format='{{.Config.Image}}' 2>/dev/null || echo "none")

            echo "ğŸ“‹ å½“å‰è¿è¡Œç‰ˆæœ¬:"
            echo "  Backend:  $CURRENT_BACKEND_IMAGE"
            echo "  Frontend: $CURRENT_FRONTEND_IMAGE"

            # ç»™å½“å‰é•œåƒæ‰“backupæ ‡ç­¾ï¼ˆæœ¬åœ°ä¿ç•™ï¼‰
            if [ "$CURRENT_BACKEND_IMAGE" != "none" ]; then
              docker tag "$CURRENT_BACKEND_IMAGE" bravo-backend-backup:latest || true
              docker tag "$CURRENT_FRONTEND_IMAGE" bravo-frontend-backup:latest || true
              echo "âœ… å·²ä¸ºå½“å‰é•œåƒæ‰“ä¸Šbackupæ ‡ç­¾"
            fi
          else
            echo "â„¹ï¸  é¦–æ¬¡éƒ¨ç½²ï¼Œæ— éœ€å¤‡ä»½"
          fi

          echo "ğŸ”„ æ‹‰å–æœ€æ–°ä»£ç ..."
          if [ -d ".git" ]; then
            # å…ˆæ¸…ç†æ‰€æœ‰æœªæäº¤çš„æ”¹åŠ¨å’Œæœªè·Ÿè¸ªæ–‡ä»¶
            git reset --hard HEAD
            git clean -fdx
            # å¼ºåˆ¶æ›´æ–°è¿œç¨‹åˆ†æ”¯ä¿¡æ¯
            git fetch --force --prune origin
            git reset --hard origin/main
          else
            git clone -b main https://github.com/Layneliang24/Bravo.git .
          fi

          echo "â¹ï¸  åœæ­¢æ—§å®¹å™¨..."
          COMPOSE_PROJECT_NAME=bravo-prod docker-compose -f docker-compose.prod.yml down || true

          echo "ğŸ” ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“..."
          echo "${REGISTRY_PASSWORD}" | docker login crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com --username "${REGISTRY_USERNAME}" --password-stdin

          echo "ğŸ“¦ æ‹‰å–æœ€æ–°é•œåƒ..."
          COMPOSE_PROJECT_NAME=bravo-prod IMAGE_TAG=latest docker-compose -f docker-compose.prod.yml pull

          # è®°å½•æ–°ç‰ˆæœ¬ä¿¡æ¯
          echo "ğŸ“ è®°å½•æ–°ç‰ˆæœ¬ä¿¡æ¯..."
          NEW_BACKEND_DIGEST=$(docker inspect crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/backend:latest --format='{{index .RepoDigests 0}}' 2>/dev/null || echo "unknown")
          NEW_VERSION=$(date +%Y-%m-%d_%H:%M:%S)

          {
            echo "DEPLOY_TIME=$NEW_VERSION"
            echo "BACKEND_IMAGE=crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/backend:latest"
            echo "FRONTEND_IMAGE=crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/frontend:latest"
            echo "BACKEND_DIGEST=$NEW_BACKEND_DIGEST"
            echo "GITHUB_SHA=${{ github.sha }}"
            echo "GITHUB_RUN_ID=${{ github.run_id }}"
            echo "GITHUB_ACTOR=${{ github.actor }}"
          } > .deployment-current

          echo "ğŸš€ å¯åŠ¨æœåŠ¡..."
          # æ£€æŸ¥æ˜¯å¦é…ç½®äº†SSLè¯ä¹¦ï¼ˆåŸŸåæ¨¡å¼ï¼‰
          if [ -d "/etc/letsencrypt/live/layneliang.com" ]; then
            echo "æ£€æµ‹åˆ°SSLè¯ä¹¦ï¼Œä½¿ç”¨åŸŸåé…ç½®..."
            # å¤åˆ¶åŸŸåé…ç½®åˆ°å®¹å™¨
            if [ -f "frontend/nginx.domain-production.conf" ]; then
              cp frontend/nginx.domain-production.conf frontend/nginx.conf.tmp
              # ä¸´æ—¶æ›¿æ¢Dockerfileä¸­çš„nginxé…ç½®
              echo "ä½¿ç”¨åŸŸåNginxé…ç½®"
            fi
            USE_DOMAIN=true
            DOMAIN_NAME=layneliang.com
          else
            echo "æœªæ£€æµ‹åˆ°SSLè¯ä¹¦ï¼Œä½¿ç”¨IPé…ç½®..."
            USE_DOMAIN=false
            DOMAIN_NAME=""
          fi

          # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨é»˜è®¤ç«¯å£
          COMPOSE_PROJECT_NAME=bravo-prod \
          IMAGE_TAG=latest \
          USE_DOMAIN=$USE_DOMAIN \
          DOMAIN_NAME=$DOMAIN_NAME \
          DJANGO_SECRET_KEY="${DJANGO_SECRET_KEY:-prod-secret-please-change-$(date +%s)}" \
          docker-compose -f docker-compose.prod.yml up -d

          echo "â³ ç­‰å¾…æœåŠ¡å°±ç»ª..."
          sleep 10

          echo "ğŸ”§ é…ç½®Nginx SSL..."
          # å¤åˆ¶ç”Ÿäº§ç¯å¢ƒSSLé…ç½®åˆ°å®¹å™¨
          if [ -f "frontend/nginx.domain-production.conf" ]; then
            docker cp frontend/nginx.domain-production.conf bravo-prod-frontend:/etc/nginx/conf.d/default.conf
            docker exec bravo-prod-frontend nginx -t && docker exec bravo-prod-frontend nginx -s reload
            echo "âœ… ç”Ÿäº§ç¯å¢ƒSSLé…ç½®å·²åº”ç”¨ï¼ˆlayneliang.comï¼‰"
          else
            echo "âš ï¸  æœªæ‰¾åˆ°nginx.domain-production.confï¼Œè·³è¿‡SSLé…ç½®"
          fi

          echo "ğŸ“Š æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
          COMPOSE_PROJECT_NAME=bravo-prod docker-compose -f docker-compose.prod.yml ps

          echo "ğŸ” éªŒè¯Nginxç«¯å£..."
          docker exec bravo-prod-frontend netstat -tlnp | grep -E '(:80|:443)' || echo "Nginxç«¯å£æ£€æŸ¥å®Œæˆ"

          echo "âœ… éƒ¨ç½²æ­¥éª¤å®Œæˆï¼Œç­‰å¾…å¥åº·æ£€æŸ¥..."
          ENDSSH

      - name: Enhanced Health Check with Auto Rollback
        id: health-check
        if: always()
        env:
          HOST: ${{ secrets.ALIYUN_HOST }}
          USER: ${{ secrets.ALIYUN_USER }}
          REGISTRY_USERNAME: ${{ secrets.ALIYUN_REGISTRY_USERNAME }}
          REGISTRY_PASSWORD: ${{ secrets.ALIYUN_REGISTRY_PASSWORD }}
        run: |
          ssh -o StrictHostKeyChecking=no $USER@$HOST bash -s << 'ENDSSH' "$REGISTRY_USERNAME" "$REGISTRY_PASSWORD"
            set -e

            REGISTRY_USERNAME="$1"
            REGISTRY_PASSWORD="$2"

            echo "ğŸ¥ å¼€å§‹å¢å¼ºå¥åº·æ£€æŸ¥..."
            cd /home/layne/project/bravo-prod

            # å¥åº·æ£€æŸ¥å‡½æ•°
            check_health() {
              local retry=0
              local max_retry=5

              while [ $retry -lt $max_retry ]; do
                echo "ğŸ” å¥åº·æ£€æŸ¥ ($((retry+1))/$max_retry)..."

                # æ£€æŸ¥å®¹å™¨çŠ¶æ€
                if ! docker ps | grep -q bravo-prod-backend; then
                  echo "âŒ Backendå®¹å™¨æœªè¿è¡Œ"
                  retry=$((retry+1))
                  sleep 10
                  continue
                fi

                if ! docker ps | grep -q bravo-prod-frontend; then
                  echo "âŒ Frontendå®¹å™¨æœªè¿è¡Œ"
                  retry=$((retry+1))
                  sleep 10
                  continue
                fi

                # æ£€æŸ¥å‰ç«¯ï¼ˆæ£€æŸ¥HTTPçŠ¶æ€ç ï¼‰
                FRONTEND_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost/ || echo "000")
                if [ "$FRONTEND_STATUS" != "200" ]; then
                  echo "âš ï¸ å‰ç«¯å¥åº·æ£€æŸ¥å¤±è´¥ (çŠ¶æ€ç : $FRONTEND_STATUS)"
                  retry=$((retry+1))
                  sleep 10
                  continue
                fi

                # æ£€æŸ¥åç«¯API
                BACKEND_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8000/api/ || echo "000")
                if [ "$BACKEND_STATUS" != "200" ]; then
                  echo "âš ï¸ åç«¯APIå¥åº·æ£€æŸ¥å¤±è´¥ (çŠ¶æ€ç : $BACKEND_STATUS)"
                  retry=$((retry+1))
                  sleep 10
                  continue
                fi

                # æ‰€æœ‰æ£€æŸ¥é€šè¿‡
                echo "âœ… å¥åº·æ£€æŸ¥é€šè¿‡"
                echo "  - Frontend: $FRONTEND_STATUS"
                echo "  - Backend API: $BACKEND_STATUS"
                return 0
              done

              echo "âŒ å¥åº·æ£€æŸ¥å¤±è´¥ï¼ˆé‡è¯•${max_retry}æ¬¡ï¼‰"
              return 1
            }

            # æ‰§è¡Œå¥åº·æ£€æŸ¥
            if check_health; then
              echo "ğŸ‰ æ–°ç‰ˆæœ¬éƒ¨ç½²æˆåŠŸï¼"

              # ç™»å½•é•œåƒä»“åº“ä»¥æ›´æ–°stableæ ‡ç­¾
              echo "${REGISTRY_PASSWORD}" | docker login crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com --username "${REGISTRY_USERNAME}" --password-stdin

              # æ›´æ–°stableæ ‡ç­¾ï¼ˆæ ‡è®°ä¸ºç¨³å®šç‰ˆæœ¬ï¼‰
              echo "ğŸ·ï¸  æ›´æ–°prod-stableæ ‡ç­¾..."
              docker tag crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/backend:latest \
                         crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/backend:prod-stable || true
              docker tag crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/frontend:latest \
                         crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/frontend:prod-stable || true

              # æ¨é€stableæ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“ï¼ˆå¯é€‰ï¼Œç”¨äºè¿œç¨‹å›æ»šï¼‰
              docker push crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/backend:prod-stable || echo "âš ï¸ æ¨é€backend stableæ ‡ç­¾å¤±è´¥"
              docker push crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/frontend:prod-stable || echo "âš ï¸ æ¨é€frontend stableæ ‡ç­¾å¤±è´¥"

              # è®°å½•åˆ°éƒ¨ç½²å†å²
              echo "[$(date '+%Y-%m-%d %H:%M:%S')] éƒ¨ç½²æˆåŠŸ - GitHub SHA: ${{ github.sha }} - Run ID: ${{ github.run_id }}" >> .deployment-history

              exit 0
            else
              echo "ğŸš¨ å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œå¼€å§‹è‡ªåŠ¨å›æ»š..."

              # æ£€æŸ¥æ˜¯å¦æœ‰å¤‡ä»½å¯ä»¥å›æ»š
              if [ ! -f .deployment-previous ]; then
                echo "âŒ æ²¡æœ‰å¯å›æ»šçš„ç‰ˆæœ¬ï¼ˆé¦–æ¬¡éƒ¨ç½²å¤±è´¥ï¼‰"
                echo "[$(date '+%Y-%m-%d %H:%M:%S')] é¦–æ¬¡éƒ¨ç½²å¤±è´¥ - æ— æ³•å›æ»š - GitHub SHA: ${{ github.sha }}" >> .deployment-history
                exit 1
              fi

              echo "ğŸ“‹ è¯»å–ä¸Šä¸€ä¸ªç‰ˆæœ¬ä¿¡æ¯..."
              if [ -f .deployment-previous ]; then
                cat .deployment-previous
              fi

              echo "â¹ï¸  åœæ­¢å¤±è´¥çš„å®¹å™¨..."
              COMPOSE_PROJECT_NAME=bravo-prod docker-compose -f docker-compose.prod.yml down

              echo "ğŸ”„ ä½¿ç”¨å¤‡ä»½é•œåƒå›æ»š..."
              # ä½¿ç”¨backupæ ‡ç­¾ï¼ˆæœ¬åœ°å¤‡ä»½ï¼‰
              if docker images | grep -q bravo-backend-backup; then
                docker tag bravo-backend-backup:latest crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/backend:latest
                docker tag bravo-frontend-backup:latest crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/frontend:latest
                echo "âœ… ä½¿ç”¨æœ¬åœ°å¤‡ä»½é•œåƒ"
              else
                # ä»é•œåƒä»“åº“æ‹‰å–stableç‰ˆæœ¬
                echo "â¬‡ï¸ ä»é•œåƒä»“åº“æ‹‰å–stableç‰ˆæœ¬..."
                echo "${REGISTRY_PASSWORD}" | docker login crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com --username "${REGISTRY_USERNAME}" --password-stdin
                docker pull crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/backend:prod-stable || echo "âš ï¸ æ‹‰å–backend stableå¤±è´¥"
                docker pull crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/frontend:prod-stable || echo "âš ï¸ æ‹‰å–frontend stableå¤±è´¥"
                docker tag crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/backend:prod-stable \
                           crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/backend:latest
                docker tag crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/frontend:prod-stable \
                           crpi-noqbdktswju6cuew.cn-shenzhen.personal.cr.aliyuncs.com/bravo-project/frontend:latest
                echo "âœ… ä½¿ç”¨é•œåƒä»“åº“stableç‰ˆæœ¬"
              fi

              echo "ğŸš€ é‡æ–°å¯åŠ¨æ—§ç‰ˆæœ¬..."
              COMPOSE_PROJECT_NAME=bravo-prod IMAGE_TAG=latest docker-compose -f docker-compose.prod.yml up -d

              sleep 30

              # éªŒè¯å›æ»šæ˜¯å¦æˆåŠŸ
              if check_health; then
                echo "âœ… å›æ»šæˆåŠŸï¼ŒæœåŠ¡å·²æ¢å¤åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬"
                echo "[$(date '+%Y-%m-%d %H:%M:%S')] éƒ¨ç½²å¤±è´¥ï¼Œå·²è‡ªåŠ¨å›æ»š - GitHub SHA: ${{ github.sha }}" >> .deployment-history

                # æ¢å¤.deployment-current
                cp .deployment-previous .deployment-current
              else
                echo "ğŸš¨ğŸš¨ğŸš¨ ä¸¥é‡é”™è¯¯ï¼šå›æ»šä¹Ÿå¤±è´¥äº†ï¼"
                echo "è¯·ç«‹å³æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€å¹¶äººå·¥ä»‹å…¥ï¼"
                echo "[$(date '+%Y-%m-%d %H:%M:%S')] éƒ¨ç½²å¤±è´¥ä¸”å›æ»šå¤±è´¥ - éœ€è¦äººå·¥ä»‹å…¥ - GitHub SHA: ${{ github.sha }}" >> .deployment-history
              fi

              exit 1
            fi
          ENDSSH

  # éƒ¨ç½²åæµ‹è¯•
  post-deploy-tests:
    name: Post-deployment Tests
    runs-on: ubuntu-latest
    needs: deploy
    if: always() && needs.deploy.result == 'success'

    steps:
      - name: API Health Check
        env:
          HOST: ${{ secrets.ALIYUN_HOST }}
        run: |
          curl -f http://$HOST/api/ || exit 1
          curl -f http://$HOST/admin/ || exit 1

      - name: Frontend Check
        env:
          HOST: ${{ secrets.ALIYUN_HOST }}
        run: |
          curl -f http://$HOST/ || exit 1

      - name: Create deployment summary
        env:
          HOST: ${{ secrets.ALIYUN_HOST }}
        run: |
          echo "## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**éƒ¨ç½²æ—¶é—´:** $(date)" >> $GITHUB_STEP_SUMMARY
          echo "**éƒ¨ç½²åˆ†æ”¯:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "**æäº¤SHA:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "**éƒ¨ç½²çŠ¶æ€:** âœ… æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“ æœåŠ¡åœ°å€" >> $GITHUB_STEP_SUMMARY
          echo "- **å‰ç«¯:** http://$HOST" >> $GITHUB_STEP_SUMMARY
          echo "- **åç«¯API:** http://$HOST/api" >> $GITHUB_STEP_SUMMARY
          echo "- **ç®¡ç†åå°:** http://$HOST/admin" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… å¥åº·æ£€æŸ¥" >> $GITHUB_STEP_SUMMARY
          echo "- å‰ç«¯æœåŠ¡: æ­£å¸¸" >> $GITHUB_STEP_SUMMARY
          echo "- åç«¯æœåŠ¡: æ­£å¸¸" >> $GITHUB_STEP_SUMMARY
          echo "- æ•°æ®åº“: æ­£å¸¸" >> $GITHUB_STEP_SUMMARY
