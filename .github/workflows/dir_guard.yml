name: Directory Guard
on: [pull_request]

jobs:
  guard:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Block root clutter
        run: |
          # ç¦æ­¢æ ¹æ–°å¢æŒ‡å®šç±»å‹ï¼ˆå…è®¸åˆ é™¤ï¼‰
          # ä½¿ç”¨ --diff-filter=A åªæ£€æµ‹æ–°å¢æ–‡ä»¶
          # ä½¿ç”¨ PR çš„ base åˆ†æ”¯è¿›è¡Œæ¯”è¾ƒ
          BASE_REF="${{ github.event.pull_request.base.ref || 'main' }}"
          echo "ğŸ“‹ æ¯”è¾ƒåŸºå‡†åˆ†æ”¯: origin/$BASE_REF"

          forbidden_files=$(git diff --name-only --diff-filter=A origin/$BASE_REF...HEAD | grep -E '^[^/]+\.(md|txt|test_.*\.py|.*_test\.py|\.keep|\.example)$' || true)
          if [ -n "$forbidden_files" ]; then
            echo "::error::æ£€æµ‹åˆ°æ ¹ç›®å½•æ–°å¢æ–‡æ¡£/æµ‹è¯•ï¼Œè¯·ç§»è‡³ docs/ æˆ–åŒç›®å½•æµ‹è¯•"
            echo "è¿è§„æ–‡ä»¶:"
            echo "$forbidden_files"
            exit 1
          fi

          # åˆ é™¤æ ¹ç›®å½•è¿è§„æ–‡ä»¶æ˜¯é¼“åŠ±çš„
          deleted_files=$(git diff --name-only --diff-filter=D origin/$BASE_REF...HEAD | grep -E '^[^/]+\.(md|txt|test_.*\.py|.*_test\.py|\.keep|\.example)$' || true)
          if [ -n "$deleted_files" ]; then
            echo "âœ… æ£€æµ‹åˆ°åˆ é™¤æ ¹ç›®å½•è¿è§„æ–‡ä»¶ï¼ˆé¼“åŠ±ï¼‰:"
            echo "$deleted_files"
          fi

          echo "âœ… ç›®å½•æ£€æŸ¥é€šè¿‡"
