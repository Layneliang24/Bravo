name: Scheduled Regression Tests

# å®šæ—¶å›å½’æµ‹è¯• - ç¡®ä¿æ ¸å¿ƒåŠŸèƒ½é•¿æœŸç¨³å®šæ€§
on:
  # æ¯å¤©å‡Œæ™¨2ç‚¹è¿è¡Œå›å½’æµ‹è¯•
  schedule:
    - cron: "0 2 * * *"
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      test-scope:
        description: "Test scope"
        type: choice
        options:
          - all
          - backend
          - frontend
          - e2e
        default: all

jobs:
  # åç«¯å›å½’æµ‹è¯•
  backend-regression:
    name: ğŸ”’ Backend Regression
    if: inputs.test-scope == 'all' || inputs.test-scope == 'backend' || github.event_name == 'schedule'
    uses: ./.github/workflows/test-backend.yml
    with:
      test-type: "regression"

  # å‰ç«¯å›å½’æµ‹è¯•
  frontend-regression:
    name: ğŸ”’ Frontend Regression
    if: inputs.test-scope == 'all' || inputs.test-scope == 'frontend' || github.event_name == 'schedule'
    uses: ./.github/workflows/test-frontend.yml
    with:
      test-type: "all"

  # E2Eå›å½’æµ‹è¯•
  e2e-regression:
    name: ğŸ”’ E2E Regression
    if: inputs.test-scope == 'all' || inputs.test-scope == 'e2e' || github.event_name == 'schedule'
    needs: [backend-regression, frontend-regression]
    uses: ./.github/workflows/test-e2e.yml
    with:
      test-type: "regression"
      browser: "chromium"

  # å›å½’æµ‹è¯•æŠ¥å‘Š
  regression-summary:
    name: ğŸ“‹ Regression Summary
    runs-on: ubuntu-latest
    needs: [backend-regression, frontend-regression, e2e-regression]
    if: always()
    steps:
      - name: Generate regression report
        run: |
          echo "ğŸ” Regression Test Results:"
          echo "Backend: ${{ needs.backend-regression.result }}"
          echo "Frontend: ${{ needs.frontend-regression.result }}"
          echo "E2E: ${{ needs.e2e-regression.result }}"

          if [[ "${{ needs.backend-regression.result }}" == "success" && \
                "${{ needs.frontend-regression.result }}" == "success" && \
                "${{ needs.e2e-regression.result }}" == "success" ]]; then
            echo "âœ… All regression tests passed!"
          else
            echo "âŒ Some regression tests failed!"
            echo "ğŸš¨ Critical: Core functionality may be compromised!"
            exit 1
          fi

      # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é€šçŸ¥é€»è¾‘ï¼Œå¦‚å‘é€é‚®ä»¶æˆ–Slackæ¶ˆæ¯
