#!/bin/sh

# 提交信息格式检查
commit_regex='^(feat|fix|docs|style|refactor|test|chore|ci|build|perf|revert)(\(.+\))?: .{1,50}'

# 读取提交信息
commit_msg=$(cat "$1")

# 检查格式
if ! echo "$commit_msg" | grep -qE "$commit_regex"; then
    echo "❌ 提交信息格式错误！"
    echo ""
    echo "📋 正确格式: type(scope): description"
    echo "🎯 类型说明:"
    echo "  feat     - 新功能"
    echo "  fix      - 修复bug"
    echo "  docs     - 文档更新"
    echo "  style    - 代码格式调整"
    echo "  refactor - 代码重构"
    echo "  test     - 测试相关"
    echo "  chore    - 构建/工具相关"
    echo "  ci       - CI/CD相关"
    echo "  build    - 构建相关"
    echo "  perf     - 性能优化"
    echo "  revert   - 回滚提交"
    echo ""
    echo "💡 示例:"
    echo "  feat(auth): add user login functionality"
    echo "  fix(api): resolve authentication timeout issue"
    echo "  docs(readme): update installation instructions"
    echo ""
    echo "🔍 当前提交信息: $commit_msg"
    exit 1
fi

# 检查长度
if [ ${#commit_msg} -gt 500 ]; then
    echo "❌ 提交信息过长，请控制在500字符以内"
    echo "🔍 当前长度: ${#commit_msg} 字符"
    echo "📝 当前信息: $commit_msg"
    exit 1
fi

echo "✅ 提交信息格式检查通过"
