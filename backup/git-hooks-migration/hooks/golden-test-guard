#!/bin/bash
# ğŸ”’ é»„é‡‘æµ‹è¯•ä¿æŠ¤é’©å­
# æ­¤é’©å­é˜»æ­¢å¯¹tests-goldenç›®å½•çš„ä»»ä½•ä¿®æ”¹

echo "ğŸ” æ£€æŸ¥é»„é‡‘æµ‹è¯•ä¿æŠ¤..."

# æ£€æŸ¥æ˜¯å¦æœ‰å¯¹tests-goldenç›®å½•çš„ä¿®æ”¹
if git diff --cached --name-only | grep -q "^tests-golden/"; then
    echo "âŒ é”™è¯¯ï¼šæ£€æµ‹åˆ°å¯¹é»„é‡‘æµ‹è¯•ç›®å½•çš„ä¿®æ”¹ï¼"
    echo ""
    echo "ğŸ”’ é»„é‡‘æµ‹è¯•ç›®å½• (tests-golden/) å—åˆ°ä¿æŠ¤ï¼Œä¸å…è®¸ä¿®æ”¹ã€‚"
    echo ""
    echo "è¢«ä¿®æ”¹çš„æ–‡ä»¶ï¼š"
    git diff --cached --name-only | grep "^tests-golden/" | sed 's/^/  - /'
    echo ""
    echo "å¦‚æœæ‚¨éœ€è¦ä¿®æ”¹é»„é‡‘æµ‹è¯•ï¼Œè¯·ï¼š"
    echo "1. ç¡®ä¿è¿™æ˜¯å¿…è¦çš„ä¸šåŠ¡é€»è¾‘å˜æ›´"
    echo "2. é€šè¿‡ PR æµç¨‹è¿›è¡Œä»£ç å®¡æŸ¥"
    echo "3. ä½¿ç”¨ --no-verify æ ‡å¿—ç»•è¿‡æ­¤æ£€æŸ¥ï¼ˆä»…é™ç´§æ€¥æƒ…å†µï¼‰"
    echo ""
    echo "å‘½ä»¤ç¤ºä¾‹ï¼šgit commit --no-verify -m \"ç´§æ€¥ä¿®å¤é»„é‡‘æµ‹è¯•\""
    echo ""
    exit 1
fi

# æ£€æŸ¥æ˜¯å¦æœ‰å¯¹é»„é‡‘æµ‹è¯•é…ç½®æ–‡ä»¶çš„ä¿®æ”¹
if git diff --cached --name-only | grep -E "(playwright\.config\.ts|vitest\.config\.ts|pytest\.ini)" | grep -q "tests-golden"; then
    echo "âš ï¸  è­¦å‘Šï¼šæ£€æµ‹åˆ°å¯¹é»„é‡‘æµ‹è¯•é…ç½®æ–‡ä»¶çš„ä¿®æ”¹"
    echo "è¯·ç¡®ä¿è¿™äº›ä¿®æ”¹æ˜¯å¿…è¦çš„ï¼Œå¹¶é€šè¿‡ä»£ç å®¡æŸ¥ã€‚"
fi

# æ£€æŸ¥æ˜¯å¦æœ‰åˆ é™¤é»„é‡‘æµ‹è¯•çš„æ“ä½œ
if git diff --cached --diff-filter=D --name-only | grep -q "^tests-golden/"; then
    echo "âŒ é”™è¯¯ï¼šæ£€æµ‹åˆ°åˆ é™¤é»„é‡‘æµ‹è¯•æ–‡ä»¶çš„æ“ä½œï¼"
    echo ""
    echo "è¢«åˆ é™¤çš„æ–‡ä»¶ï¼š"
    git diff --cached --diff-filter=D --name-only | grep "^tests-golden/" | sed 's/^/  - /'
    echo ""
    echo "åˆ é™¤é»„é‡‘æµ‹è¯•éœ€è¦ç‰¹åˆ«å®¡æ‰¹ï¼Œè¯·é€šè¿‡ PR æµç¨‹å¤„ç†ã€‚"
    echo ""
    exit 1
fi

echo "âœ… é»„é‡‘æµ‹è¯•ä¿æŠ¤æ£€æŸ¥é€šè¿‡"
exit 0
